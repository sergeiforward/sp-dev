<?php return array (
  '6eb13a19b8cf051c48f5b301b6245fc4' => 
  array (
    'criteria' => 
    array (
      'name' => 'shopkeeper3',
    ),
    'object' => 
    array (
      'name' => 'shopkeeper3',
      'path' => '{core_path}components/shopkeeper3/',
      'assets_path' => '{assets_path}components/shopkeeper3/',
    ),
  ),
  'd9161ee94dcf14f8263e8b87daba3b36' => 
  array (
    'criteria' => 
    array (
      'text' => 'shopkeeper3',
    ),
    'object' => 
    array (
      'text' => 'shopkeeper3',
      'parent' => 'components',
      'action' => 'index',
      'description' => 'shk3.menu_desc',
      'icon' => '',
      'menuindex' => 0,
      'params' => '',
      'handler' => '',
      'permissions' => '',
      'namespace' => 'shopkeeper3',
    ),
  ),
  '086d7c9571d1c2707e42b6e3a89f5084' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.property_sets',
    ),
    'object' => 
    array (
      'key' => 'shk3.property_sets',
      'value' => 'cart_catalog,cart_order_page',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'dbeee873801a3d1d96ea6131b7cbe445' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.currency',
    ),
    'object' => 
    array (
      'key' => 'shk3.currency',
      'value' => 'руб.',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'a0634389afa775bc82385fa414693743' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.currency_default',
    ),
    'object' => 
    array (
      'key' => 'shk3.currency_default',
      'value' => '1',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'bac3dac093e129d57f2d318c78f33693' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.mail_order_data_tpl',
    ),
    'object' => 
    array (
      'key' => 'shk3.mail_order_data_tpl',
      'value' => 'orderDataOuter',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '367259f0fc41801f5ac7ed41d0b71095' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.mail_order_data_row_tpl',
    ),
    'object' => 
    array (
      'key' => 'shk3.mail_order_data_row_tpl',
      'value' => 'orderDataRow',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'ce6f1e4c60d94dc0107b800b9aaecaa7' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.mail_contacts_row_tpl',
    ),
    'object' => 
    array (
      'key' => 'shk3.mail_contacts_row_tpl',
      'value' => 'mailContactsRow',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  '63f2b47b851d6632ccde61ecb3f7193f' => 
  array (
    'criteria' => 
    array (
      'key' => 'shk3.first_status',
    ),
    'object' => 
    array (
      'key' => 'shk3.first_status',
      'value' => '1',
      'xtype' => 'textfield',
      'namespace' => 'shopkeeper3',
      'area' => '',
      'editedon' => '0000-00-00 00:00:00',
    ),
  ),
  'ef7921bdb3ef591a22e5d05df318e4c2' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKaddProduct',
    ),
    'object' => 
    array (
      'name' => 'OnSHKaddProduct',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '2532b8e2f11622e7b882715187e0fa5d' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKgetProductPrice',
    ),
    'object' => 
    array (
      'name' => 'OnSHKgetProductPrice',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'd3ee72eae9fb0ab54a11c7354e50b46e' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKcalcTotalPrice',
    ),
    'object' => 
    array (
      'name' => 'OnSHKcalcTotalPrice',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '367cc7a4e9416f89abcfc1fe1cac74b7' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKcartLoad',
    ),
    'object' => 
    array (
      'name' => 'OnSHKcartLoad',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'cef2b6113466af91677226fe9717ac03' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKChangeStatus',
    ),
    'object' => 
    array (
      'name' => 'OnSHKChangeStatus',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'f35defed06b6e3eb1210f82a438c7554' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKsaveOrder',
    ),
    'object' => 
    array (
      'name' => 'OnSHKsaveOrder',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '5d22a2d40517e4f6918acf8174481348' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKbeforeCartLoad',
    ),
    'object' => 
    array (
      'name' => 'OnSHKbeforeCartLoad',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'de2700dbe1a3265314935afcb93f3c54' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKScriptsLoad',
    ),
    'object' => 
    array (
      'name' => 'OnSHKScriptsLoad',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '3a392435b18e2de97886584be3090cc2' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKsendOrderMail',
    ),
    'object' => 
    array (
      'name' => 'OnSHKsendOrderMail',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '995b076dace2240791a0b8f718f879f8' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKAfterAddProduct',
    ),
    'object' => 
    array (
      'name' => 'OnSHKAfterAddProduct',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '8ce5edc27130615c2ca54c646e6b5f3c' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKgetProductAdditParams',
    ),
    'object' => 
    array (
      'name' => 'OnSHKgetProductAdditParams',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '10c5c0c34bdbd7c4d173dcce913593d9' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKcalcTotaQuantity',
    ),
    'object' => 
    array (
      'name' => 'OnSHKcalcTotaQuantity',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'e4a3eadbd952832ec21a87e2d96bed0a' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKgetProductAdditParamPrice',
    ),
    'object' => 
    array (
      'name' => 'OnSHKgetProductAdditParamPrice',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '47088fbc5542b047feb00f0e74ae4ea5' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKprintOrderData',
    ),
    'object' => 
    array (
      'name' => 'OnSHKprintOrderData',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '2265463a1fea7602edcda377bffe4234' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKgetDeliveryPrice',
    ),
    'object' => 
    array (
      'name' => 'OnSHKgetDeliveryPrice',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '9d81613e73aeeb79c7b28877f2341306' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKafterAddProduct',
    ),
    'object' => 
    array (
      'name' => 'OnSHKAfterAddProduct',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '72845fd1c08df7aae6223cabae5b87fe' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKAfterRemoveProduct',
    ),
    'object' => 
    array (
      'name' => 'OnSHKAfterRemoveProduct',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  'caedc5ebb29bd2b7f95686ade394be39' => 
  array (
    'criteria' => 
    array (
      'name' => 'OnSHKAfterClearCart',
    ),
    'object' => 
    array (
      'name' => 'OnSHKAfterClearCart',
      'service' => 6,
      'groupname' => 'Shopkeeper3',
    ),
  ),
  '90162c6e2a8edf9261094525fceb5070' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk3.widget_name',
    ),
    'object' => 
    array (
      'id' => 6,
      'name' => 'shk3.widget_name',
      'description' => 'shk3.widget_desc',
      'type' => 'file',
      'content' => '[[++core_path]]components/shopkeeper3/elements/widgets/widget.shk_stat.php',
      'namespace' => 'shopkeeper3',
      'lexicon' => 'shopkeeper3:manager',
      'size' => 'full',
      'name_trans' => 'Статистика заказов',
      'description_trans' => 'Статистика заказов в интернет-магазине',
    ),
  ),
  '0ae2fe8f407d699d3e6a08edeaabbe62' => 
  array (
    'criteria' => 
    array (
      'category' => 'Shopkeeper3',
    ),
    'object' => 
    array (
      'id' => 9,
      'parent' => 0,
      'category' => 'Shopkeeper3',
    ),
  ),
  'f8b55b2d082f0cfc2aed048aa9331fdf' => 
  array (
    'criteria' => 
    array (
      'name' => 'shopCartRow',
    ),
    'object' => 
    array (
      'id' => 21,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shopCartRow',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<tr class="cart-order">
    <td align="left"><b><a href="[[+url]]">[[+name]]</a></b> [[+addit_data]]</td>
    <td>[[+price]] [[+currency]]</td>
    <td>
        <input class="shk-count" type="text" size="2" name="count[]" maxlength="3" title="изменить количество" value="[[+count]]" />
    </td>
    <td align="right">
        <a href="[[+url_del_item]]" title="Удалить" class="shk-del"><img src="assets/components/shopkeeper3/web/css/default/delete.gif" width="17" height="17" alt="Удалить" /></a>
    </td>
</tr>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<tr class="cart-order">
    <td align="left"><b><a href="[[+url]]">[[+name]]</a></b> [[+addit_data]]</td>
    <td>[[+price]] [[+currency]]</td>
    <td>
        <input class="shk-count" type="text" size="2" name="count[]" maxlength="3" title="изменить количество" value="[[+count]]" />
    </td>
    <td align="right">
        <a href="[[+url_del_item]]" title="Удалить" class="shk-del"><img src="assets/components/shopkeeper3/web/css/default/delete.gif" width="17" height="17" alt="Удалить" /></a>
    </td>
</tr>',
    ),
  ),
  '1437a5bebe964ff75454bb2c8620838c' => 
  array (
    'criteria' => 
    array (
      'name' => 'shopCart',
    ),
    'object' => 
    array (
      'id' => 22,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shopCart',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<div class="shop-cart" data-shopcart="2">
    <div class="shop-cart-head"><b>Корзина</b></div>
    <div class="empty">
        <div class="shop-cart-empty">Пусто</div>
    </div>
</div>
<!--tpl_separator-->
<div class="shop-cart" data-shopcart="2">
    <div class="shop-cart-head"><a name="shopCart"></a><b>Корзина</b></div>
    <div class="full">
        <form action="[[+this_page_url]]#shopCart" method="post">
        <fieldset>
            <div  style="text-align:right;">
                <a href="[[+empty_url]]" id="shk_butEmptyCart">Очистить корзину</a>
            </div>
            <table width="100%">
                <colgroup>
                    <col width="40%" />
                    <col width="25%" />
                    <col width="25%" />
                    <col width="10%" />
                </colgroup>
                <tbody>
                    [[+inner]]
                </tbody>
            </table>
            <div  style="text-align:right;">
                Доставка: [[+delivery_name]] ([[+delivery_price]] [[+currency]])
            </div>
            <div  style="text-align:right;">
                Общая сумма: <b>[[+price_total]]</b> [[+currency]]
            </div>
            <noscript>
                <div><input type="submit" name="shk_recount" value="Пересчитать" /></div>
            </noscript>
            <div class="cart-order">
                <a href="[[+order_page_url]]" id="shk_butOrder">Оформить заказ</a>
            </div>
        </fieldset>
        </form>
    </div>
</div>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<div class="shop-cart" data-shopcart="2">
    <div class="shop-cart-head"><b>Корзина</b></div>
    <div class="empty">
        <div class="shop-cart-empty">Пусто</div>
    </div>
</div>
<!--tpl_separator-->
<div class="shop-cart" data-shopcart="2">
    <div class="shop-cart-head"><a name="shopCart"></a><b>Корзина</b></div>
    <div class="full">
        <form action="[[+this_page_url]]#shopCart" method="post">
        <fieldset>
            <div  style="text-align:right;">
                <a href="[[+empty_url]]" id="shk_butEmptyCart">Очистить корзину</a>
            </div>
            <table width="100%">
                <colgroup>
                    <col width="40%" />
                    <col width="25%" />
                    <col width="25%" />
                    <col width="10%" />
                </colgroup>
                <tbody>
                    [[+inner]]
                </tbody>
            </table>
            <div  style="text-align:right;">
                Доставка: [[+delivery_name]] ([[+delivery_price]] [[+currency]])
            </div>
            <div  style="text-align:right;">
                Общая сумма: <b>[[+price_total]]</b> [[+currency]]
            </div>
            <noscript>
                <div><input type="submit" name="shk_recount" value="Пересчитать" /></div>
            </noscript>
            <div class="cart-order">
                <a href="[[+order_page_url]]" id="shk_butOrder">Оформить заказ</a>
            </div>
        </fieldset>
        </form>
    </div>
</div>',
    ),
  ),
  'bdbd9f8d1d056592ac83c925d5c50694' => 
  array (
    'criteria' => 
    array (
      'name' => 'shopOrderForm',
    ),
    'object' => 
    array (
      'id' => 23,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shopOrderForm',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '[[!shkOptions?
&get=`delivery,payments`
&post_name=`shk_delivery,payment`
&toPlaceholders=`1`
&pl_prefix=`shkopt_`
&tpl=`select_option`
]]

<p class="error">[[!+fi.error.error_message]]</p>
<br />

<form method="post" action="[[~[[*id]]]]" id="shopOrderForm">

<fieldset>

<input type="text" name="nospam:blank" value="" style="display:none;" />
<input type="hidden" name="order" value="1" />

<table cellpadding="3">
    <tr>
        <td>Ф.И.О.*:</td>
        <td>
            <input name="fullname" size="30" class="textfield" type="text" value="[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.fullname]]</div>
        </td>
    </tr>
    <tr>
        <td>Адрес*:</td>
        <td>
              <input name="address" size="30" class="textfield" type="text" value="[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]" />
              <div>[[!+fi.error.address]]</div>
        </td>
    </tr>
    <tr>
        <td>E-mail*:</td>
        <td>
            <input name="email" size="30" class="textfield" type="text" value="[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.email]]</div>
        </td>
    </tr>
    <tr>
        <td>Телефон*:</td>
        <td>
            <input name="phone" size="30" class="textfield" type="text" value="[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.phone]]</div>
        </td>
    </tr>
    <tr>
        <td>Способ доставки*:</td>
        <td>
            <select name="shk_delivery" style="width:200px;">
                <option value=""></option>
                [[!+shkopt_delivery]]
            </select>
            <div>[[!+fi.error.shk_delivery]]</div>
        </td>
    </tr>
    <tr>
        <td>Способ оплаты*:</td>
        <td>
            <select name="payment" style="width:200px;">
                <option value=""></option>
                [[!+shkopt_payments]]
            </select>
            <div>[[!+fi.error.payment]]</div>
        </td>
    </tr>
    <tr>
        <td>Комментарий:</td>
        <td>
            <textarea name="message" class="textfield" rows="4" cols="30">[[!+fi.message]]</textarea>
        </td>
    </tr>
    <tr>
        <td></td>
        <td><input type="submit" name="submit_button" class="button" value="Отправить" /></td>
    </tr>
</table>

</fieldset>

</form>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '[[!shkOptions?
&get=`delivery,payments`
&post_name=`shk_delivery,payment`
&toPlaceholders=`1`
&pl_prefix=`shkopt_`
&tpl=`select_option`
]]

<p class="error">[[!+fi.error.error_message]]</p>
<br />

<form method="post" action="[[~[[*id]]]]" id="shopOrderForm">

<fieldset>

<input type="text" name="nospam:blank" value="" style="display:none;" />
<input type="hidden" name="order" value="1" />

<table cellpadding="3">
    <tr>
        <td>Ф.И.О.*:</td>
        <td>
            <input name="fullname" size="30" class="textfield" type="text" value="[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.fullname]]</div>
        </td>
    </tr>
    <tr>
        <td>Адрес*:</td>
        <td>
              <input name="address" size="30" class="textfield" type="text" value="[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]" />
              <div>[[!+fi.error.address]]</div>
        </td>
    </tr>
    <tr>
        <td>E-mail*:</td>
        <td>
            <input name="email" size="30" class="textfield" type="text" value="[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.email]]</div>
        </td>
    </tr>
    <tr>
        <td>Телефон*:</td>
        <td>
            <input name="phone" size="30" class="textfield" type="text" value="[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]" />
            <div>[[!+fi.error.phone]]</div>
        </td>
    </tr>
    <tr>
        <td>Способ доставки*:</td>
        <td>
            <select name="shk_delivery" style="width:200px;">
                <option value=""></option>
                [[!+shkopt_delivery]]
            </select>
            <div>[[!+fi.error.shk_delivery]]</div>
        </td>
    </tr>
    <tr>
        <td>Способ оплаты*:</td>
        <td>
            <select name="payment" style="width:200px;">
                <option value=""></option>
                [[!+shkopt_payments]]
            </select>
            <div>[[!+fi.error.payment]]</div>
        </td>
    </tr>
    <tr>
        <td>Комментарий:</td>
        <td>
            <textarea name="message" class="textfield" rows="4" cols="30">[[!+fi.message]]</textarea>
        </td>
    </tr>
    <tr>
        <td></td>
        <td><input type="submit" name="submit_button" class="button" value="Отправить" /></td>
    </tr>
</table>

</fieldset>

</form>',
    ),
  ),
  '58bd69f60cd1009394f0982b3250d47d' => 
  array (
    'criteria' => 
    array (
      'name' => 'shopOrderReport',
    ),
    'object' => 
    array (
      'id' => 24,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shopOrderReport',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<!DOCTYPE html>
<html>

<head>
<style type="text/css">
body{background-color:#fff;}
table {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}
table td {padding:5px; border:1px solid #BCBCBC;}
</style>
</head>

<body>

<p><b>[[++site_name]]</b></p>

<p>В интернет-магазине сделан заказ.</p>

<div style="padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;">

    <p>Номер заказа: [[+orderID]]</p>
    
    <p>Дата: [[+orderDate]].</p>
    
    [[+orderOutputData]]

</div>

<a href="[[++site_url]]" target="_blank">[[++site_url]]</a>

<br /><br />

</body>
</html>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<!DOCTYPE html>
<html>

<head>
<style type="text/css">
body{background-color:#fff;}
table {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}
table td {padding:5px; border:1px solid #BCBCBC;}
</style>
</head>

<body>

<p><b>[[++site_name]]</b></p>

<p>В интернет-магазине сделан заказ.</p>

<div style="padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;">

    <p>Номер заказа: [[+orderID]]</p>
    
    <p>Дата: [[+orderDate]].</p>
    
    [[+orderOutputData]]

</div>

<a href="[[++site_url]]" target="_blank">[[++site_url]]</a>

<br /><br />

</body>
</html>',
    ),
  ),
  '9a450c9c050d0e68ccf08fd736afbb6f' => 
  array (
    'criteria' => 
    array (
      'name' => 'orderDataOuter',
    ),
    'object' => 
    array (
      'id' => 50,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'orderDataOuter',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<p><b>Состав заказа</b></p>

<table>
    <thead>
        <tr class="active">
            <th>Наименование</th>
            <th>Параметры</th>
            <th>Кол-во, шт.</th>
            <th>Цена, [[+currency]]</th>
        </tr>
    </thead>
    <tbody>
        [[+purchases]]
    </tbody>
    <tfoot>
        <tr class="cart-order">
            <td colspan="3" style="text-align: right;">
                [[+delivery]]
            </td>
            <td>
                <b>[[+delivery_price:num_format]]</b>
            </td>
        </tr>
        <tr class="cart-order">
            <td colspan="3" style="text-align: right;">
                <b>Итого:</b>
            </td>
            <td>
                <b>[[+price:num_format]]</b>
            </td>
        </tr>
    </tfoot>
</table>

<p><b>Контактные данные</b></p>

<table>
    <colgroup>
        <col width="50%" span="2">
    </colgroup>
    <tbody>
        [[+contacts]]
    </tbody>
</table>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<p><b>Состав заказа</b></p>

<table>
    <thead>
        <tr class="active">
            <th>Наименование</th>
            <th>Параметры</th>
            <th>Кол-во, шт.</th>
            <th>Цена, [[+currency]]</th>
        </tr>
    </thead>
    <tbody>
        [[+purchases]]
    </tbody>
    <tfoot>
        <tr class="cart-order">
            <td colspan="3" style="text-align: right;">
                [[+delivery]]
            </td>
            <td>
                <b>[[+delivery_price:num_format]]</b>
            </td>
        </tr>
        <tr class="cart-order">
            <td colspan="3" style="text-align: right;">
                <b>Итого:</b>
            </td>
            <td>
                <b>[[+price:num_format]]</b>
            </td>
        </tr>
    </tfoot>
</table>

<p><b>Контактные данные</b></p>

<table>
    <colgroup>
        <col width="50%" span="2">
    </colgroup>
    <tbody>
        [[+contacts]]
    </tbody>
</table>',
    ),
  ),
  '0cfbc003672e3b76fd4a68c21b11422f' => 
  array (
    'criteria' => 
    array (
      'name' => 'orderDataRow',
    ),
    'object' => 
    array (
      'id' => 51,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'orderDataRow',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<tr class="cart-order">
    <td>
        <b>[[+name]]</b>
    </td>
    <td>
        [[+addit_data:default=`&mdash;`]]
    </td>
    <td>
        [[+count]] шт.
    </td>
    <td>
        [[+price]] [[+currency]]
    </td>
</tr>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<tr class="cart-order">
    <td>
        <b>[[+name]]</b>
    </td>
    <td>
        [[+addit_data:default=`&mdash;`]]
    </td>
    <td>
        [[+count]] шт.
    </td>
    <td>
        [[+price]] [[+currency]]
    </td>
</tr>',
    ),
  ),
  'a1857c94160d03004785732e013961a7' => 
  array (
    'criteria' => 
    array (
      'name' => 'mailContactsRow',
    ),
    'object' => 
    array (
      'id' => 25,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'mailContactsRow',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<tr>
    <td>[[+label]]:</td>
    <td>[[+value]]</td>
</tr>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<tr>
    <td>[[+label]]:</td>
    <td>[[+value]]</td>
</tr>',
    ),
  ),
  'aa99c4130cdb8f349386d301df2e32e6' => 
  array (
    'criteria' => 
    array (
      'name' => 'select_option',
    ),
    'object' => 
    array (
      'id' => 52,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'select_option',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<option value="[[+value]]" [[+selected]]>[[+label]]</option>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<option value="[[+value]]" [[+selected]]>[[+label]]</option>',
    ),
  ),
  'fd9d32f5037d696d1ee48305eba02fe7' => 
  array (
    'criteria' => 
    array (
      'name' => 'userMail',
    ),
    'object' => 
    array (
      'id' => 53,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'userMail',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '<!DOCTYPE html>
<html>

<head>
<style type="text/css">
body{background-color:#fff;}
table {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}
table td {padding:5px; border:1px solid #BCBCBC;}
</style>
</head>

<body>

<p><b>[[++site_name]]</b></p>

<p>Изменен статус заказа.</p>

<div style="padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;">

    <p>Номер заказа: [[+orderID]]</p>
    
    <p>Дата: [[+orderDate]].</p>
    
    <p>Ваш заказ переведен в статус: <b>[[+statusName]]</b>.</p>
    
    [[+orderOutputData]]

</div>

<a href="[[++site_url]]" target="_blank">[[++site_url]]</a>

<br /><br />

</body>
</html>',
      'locked' => 0,
      'properties' => NULL,
      'static' => 0,
      'static_file' => '',
      'content' => '<!DOCTYPE html>
<html>

<head>
<style type="text/css">
body{background-color:#fff;}
table {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}
table td {padding:5px; border:1px solid #BCBCBC;}
</style>
</head>

<body>

<p><b>[[++site_name]]</b></p>

<p>Изменен статус заказа.</p>

<div style="padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;">

    <p>Номер заказа: [[+orderID]]</p>
    
    <p>Дата: [[+orderDate]].</p>
    
    <p>Ваш заказ переведен в статус: <b>[[+statusName]]</b>.</p>
    
    [[+orderOutputData]]

</div>

<a href="[[++site_url]]" target="_blank">[[++site_url]]</a>

<br /><br />

</body>
</html>',
    ),
  ),
  '4d1ac4fa83ad8fbf5ac885ea216342af' => 
  array (
    'criteria' => 
    array (
      'name' => 'Shopkeeper3',
    ),
    'object' => 
    array (
      'id' => 31,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'Shopkeeper3',
      'description' => 'Shopping cart',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/**
 * Shopkeeper
 * 
 * Shopping cart for MODx Revolution
 *
 * @package shopkeeper3
 * @category 	   snippet
 * @version 	   3.x
 * @license 	   http://www.gnu.org/copyleft/gpl.html GNU Public License (GPL)
 * @internal	   @properties
 * @internal	   @modx_category Shop
 */

if(isset($hideOn) && preg_match(\'/(^|\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)/\',$hideOn)) return \'\';

$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;
$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];
if( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . "components/shopkeeper3/" );

$output = \'\';

require_once $modx->getOption(\'core_path\') . "components/shopkeeper3/model/shopkeeper.class.php";

$shopCart = new Shopkeeper($modx, $scriptProperties);

if( $SHK_callCount === 1 ){
    
    if( !empty( $scriptProperties[\'style\'] ) ){
        $modx->regClientCSS( SHOPKEEPER_URL . "web/css/".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . "/style.css" );
    }
    
    if( !$modx->getOption( \'noJavaScript\', $scriptProperties, false ) ){
        
        if(!$modx->getOption( \'noJQuery\', $scriptProperties, false ) ){
            $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/jquery-1.11.1.min.js" );
        }
        
        $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/lang/" . $modx->getOption( \'lang\', $scriptProperties, \'ru\' ) . ".js?v=" . $shopCart->getVersion() );
        $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/shopkeeper.js?v=" . $shopCart->getVersion() );
        
        $shk_opts = array(
            \'prodCont\' => $modx->getOption( \'prodCont\', $scriptProperties, \'div.shk-item\' ),
            \'site_base_url\' => $modx->config[\'base_url\'],
            \'counterField\' => $modx->getOption( \'counterField\', $scriptProperties, false ),
            \'counterFieldCart\' => $modx->getOption( \'counterFieldCart\', $scriptProperties, true ),
            \'changePrice\' => $modx->getOption( \'changePrice\', $scriptProperties, true ),
            \'flyToCart\' => $modx->getOption( \'flyToCart\', $scriptProperties, \'helper\' ),
            \'noLoader\' => $modx->getOption( \'noLoader\', $scriptProperties, false ),
            \'allowFloatCount\' => $modx->getOption( \'allowFloatCount\', $scriptProperties, false ),
            \'animCart\' => $modx->getOption( \'animCart\', $scriptProperties, true ),
            \'goToOrderFormPage\' => $modx->getOption( \'goToOrderFormPage\', $scriptProperties, false ),
            //\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),
            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\',$scriptProperties,1),\'\',\'\',\'abs\'),
            \'debug\' => $modx->getOption( \'debug\', $scriptProperties, false )
        );
        
        if( defined(\'JSON_UNESCAPED_SLASHES\') && defined(\'JSON_FORCE_OBJECT\') ){
            $options_obj_str = json_encode( $shk_opts, JSON_FORCE_OBJECT | JSON_UNESCAPED_SLASHES );
        }else{
            $options_obj_str = json_encode( $shk_opts );
        }
        
        $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;
        $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : 0;
        
        //create script
        $headHtml = "\\t<script type=\\"text/javascript\\">";
        $headHtml .= "
        SHK.data = {price_total:".Shopkeeper::$price_total.",items_total:".Shopkeeper::$items_total.",items_unique_total:".Shopkeeper::$items_unique_total.",delivery_price:{$delivery_price},delivery_name:\'{$delivery_name}\',ids:[".$shopCart->getProdIds(\'string\')."]};
        jQuery(document).bind( \'ready\', function(){
            SHK.init( " . $options_obj_str . " );
        });" . PHP_EOL;
        
        $headHtml .= "\\t</script>" . PHP_EOL;
        
        $modx->regClientStartupHTMLBlock( $headHtml );
        
    }
    
}

//вывод корзины
$output .= $shopCart->getCartContent();

return $output;',
      'locked' => 0,
      'properties' => 'a:37:{s:4:"lang";a:7:{s:4:"name";s:4:"lang";s:4:"desc";s:13:"prop_shk.lang";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:2:"ru";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:8:"prodCont";a:7:{s:4:"name";s:8:"prodCont";s:4:"desc";s:17:"prop_shk.prodcont";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:12:"div.shk-item";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:7:"tplPath";a:7:{s:4:"name";s:7:"tplPath";s:4:"desc";s:16:"prop_shk.tplpath";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:47:"core/components/shopkeeper3/elements/chunks/ru/";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:7:"cartTpl";a:7:{s:4:"name";s:7:"cartTpl";s:4:"desc";s:16:"prop_shk.carttpl";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:18:"@FILE shopCart.tpl";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:10:"cartRowTpl";a:7:{s:4:"name";s:10:"cartRowTpl";s:4:"desc";s:19:"prop_shk.cartrowtpl";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:21:"@FILE shopCartRow.tpl";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:12:"additDataTpl";a:7:{s:4:"name";s:12:"additDataTpl";s:4:"desc";s:21:"prop_shk.additdatatpl";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:19:"@FILE additData.tpl";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:12:"orderDataTpl";a:7:{s:4:"name";s:12:"orderDataTpl";s:4:"desc";s:21:"prop_shk.orderdatatpl";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:19:"@FILE orderData.tpl";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:13:"cartHelperTpl";a:7:{s:4:"name";s:13:"cartHelperTpl";s:4:"desc";s:21:"prop_shk.carthelpetpl";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:9:"flyToCart";a:7:{s:4:"name";s:9:"flyToCart";s:4:"desc";s:18:"prop_shk.flytocart";s:4:"type";s:4:"list";s:7:"options";a:4:{i:0;a:2:{s:4:"text";s:6:"helper";s:5:"value";s:6:"helper";}i:1;a:2:{s:4:"text";s:5:"image";s:5:"value";s:5:"image";}i:2;a:2:{s:4:"text";s:11:"scrollimage";s:5:"value";s:11:"scrollimage";}i:3;a:2:{s:4:"text";s:5:"nofly";s:5:"value";s:5:"nofly";}}s:5:"value";s:6:"helper";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:10:"fieldPrice";a:7:{s:4:"name";s:10:"fieldPrice";s:4:"desc";s:16:"prop_shk.pricetv";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:5:"price";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:5:"style";a:7:{s:4:"name";s:5:"style";s:4:"desc";s:14:"prop_shk.style";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:7:"default";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:8:"currency";a:7:{s:4:"name";s:8:"currency";s:4:"desc";s:17:"prop_shk.currency";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:7:"руб.";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:9:"noCounter";a:7:{s:4:"name";s:9:"noCounter";s:4:"desc";s:18:"prop_shk.nocounter";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:8:"noLoader";a:7:{s:4:"name";s:8:"noLoader";s:4:"desc";s:17:"prop_shk.noloader";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:15:"orderFormPageId";a:7:{s:4:"name";s:15:"orderFormPageId";s:4:"desc";s:22:"prop_shk.orderformpage";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"1";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:17:"goToOrderFormPage";a:7:{s:4:"name";s:17:"goToOrderFormPage";s:4:"desc";s:26:"prop_shk.gotoorderformpage";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:12:"counterField";a:7:{s:4:"name";s:12:"counterField";s:4:"desc";s:21:"prop_shk.counterfield";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:16:"counterFieldCart";a:7:{s:4:"name";s:16:"counterFieldCart";s:4:"desc";s:25:"prop_shk.counterFieldCart";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:15:"excepDigitGroup";a:7:{s:4:"name";s:15:"excepDigitGroup";s:4:"desc";s:24:"prop_shk.excepdigitgroup";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:11:"changePrice";a:7:{s:4:"name";s:11:"changePrice";s:4:"desc";s:20:"prop_shk.changeprice";s:4:"type";s:4:"list";s:7:"options";a:3:{i:0;a:2:{s:4:"text";s:3:"yes";s:5:"value";s:1:"1";}i:1;a:2:{s:4:"text";s:2:"no";s:5:"value";s:1:"0";}i:2;a:2:{s:4:"text";s:7:"replace";s:5:"value";s:7:"replace";}}s:5:"value";s:1:"1";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:8:"animCart";a:7:{s:4:"name";s:8:"animCart";s:4:"desc";s:17:"prop_shk.animcart";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:1;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:15:"allowFloatCount";a:7:{s:4:"name";s:15:"allowFloatCount";s:4:"desc";s:24:"prop_shk.allowfloatcount";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:12:"noJavaScript";a:7:{s:4:"name";s:12:"noJavaScript";s:4:"desc";s:21:"prop_shk.nojavascript";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:8:"noJQuery";a:7:{s:4:"name";s:8:"noJQuery";s:4:"desc";s:17:"prop_shk.nojquery";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:10:"noConflict";a:7:{s:4:"name";s:10:"noConflict";s:4:"desc";s:19:"prop_shk.noconflict";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:6:"hideOn";a:7:{s:4:"name";s:6:"hideOn";s:4:"desc";s:15:"prop_shk.hideon";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:10:"TVsaveList";a:7:{s:4:"name";s:10:"TVsaveList";s:4:"desc";s:19:"prop_shk.TVsaveList";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:14:"fromParentList";a:7:{s:4:"name";s:14:"fromParentList";s:4:"desc";s:23:"prop_shk.fromParentList";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:16:"fromParentHeight";a:7:{s:4:"name";s:16:"fromParentHeight";s:4:"desc";s:25:"prop_shk.fromParentHeight";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"1";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:16:"additParamSource";a:7:{s:4:"name";s:16:"additParamSource";s:4:"desc";s:25:"prop_shk.additParamSource";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:9:"className";a:7:{s:4:"name";s:9:"className";s:4:"desc";s:18:"prop_shk.className";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:11:"modResource";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:11:"packageName";a:7:{s:4:"name";s:11:"packageName";s:4:"desc";s:20:"prop_shk.packageName";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:19:"savePurchasesFields";a:7:{s:4:"name";s:19:"savePurchasesFields";s:4:"desc";s:28:"prop_shk.savePurchasesFields";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:5:"debug";a:7:{s:4:"name";s:5:"debug";s:4:"desc";s:14:"prop_shk.debug";s:4:"type";s:13:"combo-boolean";s:7:"options";s:0:"";s:5:"value";b:0;s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:13:"processParams";a:7:{s:4:"name";s:13:"processParams";s:4:"desc";s:22:"prop_shk.processParams";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"0";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:11:"pluralWords";a:7:{s:4:"name";s:11:"pluralWords";s:4:"desc";s:20:"prop_shk.pluralWords";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}s:7:"groupBy";a:7:{s:4:"name";s:7:"groupBy";s:4:"desc";s:16:"prop_shk.groupBy";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";s:21:"shopkeeper:properties";s:4:"area";s:0:"";}}',
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/**
 * Shopkeeper
 * 
 * Shopping cart for MODx Revolution
 *
 * @package shopkeeper3
 * @category 	   snippet
 * @version 	   3.x
 * @license 	   http://www.gnu.org/copyleft/gpl.html GNU Public License (GPL)
 * @internal	   @properties
 * @internal	   @modx_category Shop
 */

if(isset($hideOn) && preg_match(\'/(^|\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)/\',$hideOn)) return \'\';

$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;
$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];
if( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . "components/shopkeeper3/" );

$output = \'\';

require_once $modx->getOption(\'core_path\') . "components/shopkeeper3/model/shopkeeper.class.php";

$shopCart = new Shopkeeper($modx, $scriptProperties);

if( $SHK_callCount === 1 ){
    
    if( !empty( $scriptProperties[\'style\'] ) ){
        $modx->regClientCSS( SHOPKEEPER_URL . "web/css/".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . "/style.css" );
    }
    
    if( !$modx->getOption( \'noJavaScript\', $scriptProperties, false ) ){
        
        if(!$modx->getOption( \'noJQuery\', $scriptProperties, false ) ){
            $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/jquery-1.11.1.min.js" );
        }
        
        $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/lang/" . $modx->getOption( \'lang\', $scriptProperties, \'ru\' ) . ".js?v=" . $shopCart->getVersion() );
        $modx->regClientStartupScript( SHOPKEEPER_URL . "web/js/shopkeeper.js?v=" . $shopCart->getVersion() );
        
        $shk_opts = array(
            \'prodCont\' => $modx->getOption( \'prodCont\', $scriptProperties, \'div.shk-item\' ),
            \'site_base_url\' => $modx->config[\'base_url\'],
            \'counterField\' => $modx->getOption( \'counterField\', $scriptProperties, false ),
            \'counterFieldCart\' => $modx->getOption( \'counterFieldCart\', $scriptProperties, true ),
            \'changePrice\' => $modx->getOption( \'changePrice\', $scriptProperties, true ),
            \'flyToCart\' => $modx->getOption( \'flyToCart\', $scriptProperties, \'helper\' ),
            \'noLoader\' => $modx->getOption( \'noLoader\', $scriptProperties, false ),
            \'allowFloatCount\' => $modx->getOption( \'allowFloatCount\', $scriptProperties, false ),
            \'animCart\' => $modx->getOption( \'animCart\', $scriptProperties, true ),
            \'goToOrderFormPage\' => $modx->getOption( \'goToOrderFormPage\', $scriptProperties, false ),
            //\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),
            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\',$scriptProperties,1),\'\',\'\',\'abs\'),
            \'debug\' => $modx->getOption( \'debug\', $scriptProperties, false )
        );
        
        if( defined(\'JSON_UNESCAPED_SLASHES\') && defined(\'JSON_FORCE_OBJECT\') ){
            $options_obj_str = json_encode( $shk_opts, JSON_FORCE_OBJECT | JSON_UNESCAPED_SLASHES );
        }else{
            $options_obj_str = json_encode( $shk_opts );
        }
        
        $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;
        $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : 0;
        
        //create script
        $headHtml = "\\t<script type=\\"text/javascript\\">";
        $headHtml .= "
        SHK.data = {price_total:".Shopkeeper::$price_total.",items_total:".Shopkeeper::$items_total.",items_unique_total:".Shopkeeper::$items_unique_total.",delivery_price:{$delivery_price},delivery_name:\'{$delivery_name}\',ids:[".$shopCart->getProdIds(\'string\')."]};
        jQuery(document).bind( \'ready\', function(){
            SHK.init( " . $options_obj_str . " );
        });" . PHP_EOL;
        
        $headHtml .= "\\t</script>" . PHP_EOL;
        
        $modx->regClientStartupHTMLBlock( $headHtml );
        
    }
    
}

//вывод корзины
$output .= $shopCart->getCartContent();

return $output;',
    ),
  ),
  '60a0140b2ac6cbe40504785bbb519a15' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_fihook',
    ),
    'object' => 
    array (
      'id' => 32,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_fihook',
      'description' => 'FormIt hook for Shopkeeper',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/**
 * FormIt hook for Shopkeeper 3.x
 */

//ini_set(\'display_errors\',1);
//error_reporting(E_ALL);

$output = false;

if(!defined(\'SHOPKEEPER_PATH\')){
    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH."components/shopkeeper3/");
}

//Определяем параметры сниппета Shopkeeper
$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );
$sys_property_sets = explode( \',\', $sys_property_sets );
$propertySetName = trim( current( $sys_property_sets ) );

$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));
$properties = $snippet->getProperties();
if( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){
    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );
    $propSetProperties = $propSet->getProperties();
    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);
}

$lang = $modx->getOption( \'lang\', $properties, \'ru\' );
$modx->getService( \'lexicon\', \'modLexicon\' );
$modx->lexicon->load( $lang . \':shopkeeper3:default\' );

if( !empty( $_SESSION[\'shk_order\'] ) ){
    
    require_once SHOPKEEPER_PATH . "model/shopkeeper.class.php";
    $shopCart = new Shopkeeper( $modx, $properties );
    
    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model/\' );
    
    //shopkeeper settings
    $contacts_fields = array();
    $response = $modx->runProcessor(\'getsettings\',
        array( \'settings\' => array(\'contacts_fields\') ),
        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components/shopkeeper3/processors/mgr/\' )
    );
    if ($response->isError()) {
        echo $response->getMessage();
    }
    if($result = $response->getResponse()){
        
        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();
        if( !empty( $temp_arr ) ){
            
            foreach( $temp_arr as $opt ){
                
                $contacts_fields[$opt[\'name\']] = $opt;
                
            }
            
        }
        
    }
    
    $userId = $modx->getLoginUserID( $modx->context->key );
    if( !$userId ) $userId = 0;
    
    //Контактные данные
    $contacts = array();
    $allFormFields = $hook->getValues();
    foreach( $allFormFields as $key => $val ){
        
        if( in_array( $key, array_keys( $contacts_fields ) ) ){
            
            $temp_arr = array(
                \'name\' => $contacts_fields[$key][\'name\'],
                \'value\' => $val,
                \'label\' => $contacts_fields[$key][\'label\']
            );
            
            array_push( $contacts, $temp_arr );
            
        }
        
    }
    
    $contacts = json_encode( $contacts );
    
    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );
    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );
    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );
    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );
    
    //Доставка
    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;
    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';
    if( !$delivery_name ){
	$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';
    }
    
    //Сохраняем данные заказа
    $order = $modx->newObject(\'shk_order\');
    $insert_data = array(
        \'contacts\' => $contacts,
	\'options\' => \'\',
	\'price\' => Shopkeeper::$price_total,
	\'currency\' => $shopCart->config[\'currency\'],
	\'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),
	\'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),
	\'note\' => \'\',
	\'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',
	\'delivery\' => $delivery_name,
	\'delivery_price\' => $delivery_price,
	\'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',
	\'tracking_num\' => \'\',
	\'phone\' => isset( $allFormFields[$phoneField] ) ? $allFormFields[$phoneField] : \'\',
	\'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )
    );
    if( $userId ){
        $insert_data[\'userid\'] = $userId;
    }
    $order->fromArray($insert_data);
    $saved = $order->save();
    
    //Сохраняем товары заказа
    if( $saved ){
        
	$purchasesData = $shopCart->getProductsData( true );
	
        foreach( $shopCart->data as $key => $p_data ){
            
            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';
	    $fields_data = !empty( $purchasesData[ $key ] ) ? $purchasesData[ $key ] : array();
	    $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';
	    unset( $fields_data[\'id\'] );
	    $fields_data_str = json_encode( $fields_data );
	    
            $insert_data = array(
                \'p_id\' => $p_data[\'id\'],
                \'order_id\' => $order->id,
                \'name\' => $p_data[\'name\'],
                \'price\' => $p_data[\'price\'],
                \'count\' => $p_data[\'count\'],
                \'class_name\' => $p_data[\'className\'],
                \'package_name\' => $p_data[\'packageName\'],
		\'data\' => $fields_data_str,
                \'options\' => $options
            );
            
            $purchase = $modx->newObject(\'shk_purchases\');
            $purchase->fromArray( $insert_data );
            $purchase->save();
            
        }
        
	$shopCart->setOrderDataSession( $order->toArray() );
	
    }
    
    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );
    
    $orderOutputData = $shopCart->getOrderData( $order->id );
    
    //OnSHKsaveOrder
    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));
    if(is_array($evtOut)) $orderOutputData .= implode(\'\',$evtOut);
    
    $hook->setValues(array(
        \'orderID\' => $order->get(\'id\'),
        \'orderDate\' => $order->get(\'date\'),
        \'orderPrice\' => $order->get(\'price\'),
	\'orderCurrency\' => $shopCart->config[\'currency\'],
	\'orderOutputData\' => $orderOutputData
    ));
    
    $shopCart->request_empty( false );
    
    $output = true;
    
}else{
    
    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );
    $output = false;
    
}

return $output;',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/**
 * FormIt hook for Shopkeeper 3.x
 */

//ini_set(\'display_errors\',1);
//error_reporting(E_ALL);

$output = false;

if(!defined(\'SHOPKEEPER_PATH\')){
    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH."components/shopkeeper3/");
}

//Определяем параметры сниппета Shopkeeper
$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );
$sys_property_sets = explode( \',\', $sys_property_sets );
$propertySetName = trim( current( $sys_property_sets ) );

$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));
$properties = $snippet->getProperties();
if( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){
    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );
    $propSetProperties = $propSet->getProperties();
    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);
}

$lang = $modx->getOption( \'lang\', $properties, \'ru\' );
$modx->getService( \'lexicon\', \'modLexicon\' );
$modx->lexicon->load( $lang . \':shopkeeper3:default\' );

if( !empty( $_SESSION[\'shk_order\'] ) ){
    
    require_once SHOPKEEPER_PATH . "model/shopkeeper.class.php";
    $shopCart = new Shopkeeper( $modx, $properties );
    
    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model/\' );
    
    //shopkeeper settings
    $contacts_fields = array();
    $response = $modx->runProcessor(\'getsettings\',
        array( \'settings\' => array(\'contacts_fields\') ),
        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components/shopkeeper3/processors/mgr/\' )
    );
    if ($response->isError()) {
        echo $response->getMessage();
    }
    if($result = $response->getResponse()){
        
        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();
        if( !empty( $temp_arr ) ){
            
            foreach( $temp_arr as $opt ){
                
                $contacts_fields[$opt[\'name\']] = $opt;
                
            }
            
        }
        
    }
    
    $userId = $modx->getLoginUserID( $modx->context->key );
    if( !$userId ) $userId = 0;
    
    //Контактные данные
    $contacts = array();
    $allFormFields = $hook->getValues();
    foreach( $allFormFields as $key => $val ){
        
        if( in_array( $key, array_keys( $contacts_fields ) ) ){
            
            $temp_arr = array(
                \'name\' => $contacts_fields[$key][\'name\'],
                \'value\' => $val,
                \'label\' => $contacts_fields[$key][\'label\']
            );
            
            array_push( $contacts, $temp_arr );
            
        }
        
    }
    
    $contacts = json_encode( $contacts );
    
    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );
    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );
    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );
    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );
    
    //Доставка
    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;
    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';
    if( !$delivery_name ){
	$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';
    }
    
    //Сохраняем данные заказа
    $order = $modx->newObject(\'shk_order\');
    $insert_data = array(
        \'contacts\' => $contacts,
	\'options\' => \'\',
	\'price\' => Shopkeeper::$price_total,
	\'currency\' => $shopCart->config[\'currency\'],
	\'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),
	\'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),
	\'note\' => \'\',
	\'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',
	\'delivery\' => $delivery_name,
	\'delivery_price\' => $delivery_price,
	\'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',
	\'tracking_num\' => \'\',
	\'phone\' => isset( $allFormFields[$phoneField] ) ? $allFormFields[$phoneField] : \'\',
	\'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )
    );
    if( $userId ){
        $insert_data[\'userid\'] = $userId;
    }
    $order->fromArray($insert_data);
    $saved = $order->save();
    
    //Сохраняем товары заказа
    if( $saved ){
        
	$purchasesData = $shopCart->getProductsData( true );
	
        foreach( $shopCart->data as $key => $p_data ){
            
            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';
	    $fields_data = !empty( $purchasesData[ $key ] ) ? $purchasesData[ $key ] : array();
	    $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';
	    unset( $fields_data[\'id\'] );
	    $fields_data_str = json_encode( $fields_data );
	    
            $insert_data = array(
                \'p_id\' => $p_data[\'id\'],
                \'order_id\' => $order->id,
                \'name\' => $p_data[\'name\'],
                \'price\' => $p_data[\'price\'],
                \'count\' => $p_data[\'count\'],
                \'class_name\' => $p_data[\'className\'],
                \'package_name\' => $p_data[\'packageName\'],
		\'data\' => $fields_data_str,
                \'options\' => $options
            );
            
            $purchase = $modx->newObject(\'shk_purchases\');
            $purchase->fromArray( $insert_data );
            $purchase->save();
            
        }
        
	$shopCart->setOrderDataSession( $order->toArray() );
	
    }
    
    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );
    
    $orderOutputData = $shopCart->getOrderData( $order->id );
    
    //OnSHKsaveOrder
    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));
    if(is_array($evtOut)) $orderOutputData .= implode(\'\',$evtOut);
    
    $hook->setValues(array(
        \'orderID\' => $order->get(\'id\'),
        \'orderDate\' => $order->get(\'date\'),
        \'orderPrice\' => $order->get(\'price\'),
	\'orderCurrency\' => $shopCart->config[\'currency\'],
	\'orderOutputData\' => $orderOutputData
    ));
    
    $shopCart->request_empty( false );
    
    $output = true;
    
}else{
    
    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );
    $output = false;
    
}

return $output;',
    ),
  ),
  'f7c5a0501e0ef822e5f42ae958a893ce' => 
  array (
    'criteria' => 
    array (
      'name' => 'shkOptions',
    ),
    'object' => 
    array (
      'id' => 33,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shkOptions',
      'description' => 'Print configuration of Shopkeeper',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/**
 * shkOptions
 * Сниппет выводит данные из конфигурации Shopkeeper
 *
 */

$output = array();

$get = explode( \',\', $modx->getOption( \'get\', $scriptProperties, \'\' ) );
$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );
$get = array_map( \'trim\', $get );
$post_name = array_map( \'trim\', $post_name );
$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );
$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );
$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );

if( empty( $get ) ) return \'\';

if( class_exists(\'Shopkeeper\') ){
    
    $config = Shopkeeper::getConfig( $get );
    
    //echo \'<pre>\' . print_r( $config, true ) . \'</pre>\';
    
    if( !empty( $config ) ){
        
        foreach( $get as $index => $opt_name ){
            
            if( !empty( $config[ $opt_name ] ) ){
                
                $output[ $opt_name ] = \'\';
                
                foreach( $config[ $opt_name ] as $key => $conf ){
                    
                    if( empty( $conf[\'value\'] ) ){
                        $conf[\'value\'] = $conf[\'label\'];
                    }
                    
                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected="selected"\' : \'\' );
                    
                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . "\\t";
                    
                }
                
            }
            
        }
        
    }
    
}

if( $toPlaceholders ){
    
    foreach( $output as $pl_name => $out ){
        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );
    }
    
    $output = array();
    
}

return implode( \'\', $output );',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/**
 * shkOptions
 * Сниппет выводит данные из конфигурации Shopkeeper
 *
 */

$output = array();

$get = explode( \',\', $modx->getOption( \'get\', $scriptProperties, \'\' ) );
$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );
$get = array_map( \'trim\', $get );
$post_name = array_map( \'trim\', $post_name );
$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );
$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );
$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );

if( empty( $get ) ) return \'\';

if( class_exists(\'Shopkeeper\') ){
    
    $config = Shopkeeper::getConfig( $get );
    
    //echo \'<pre>\' . print_r( $config, true ) . \'</pre>\';
    
    if( !empty( $config ) ){
        
        foreach( $get as $index => $opt_name ){
            
            if( !empty( $config[ $opt_name ] ) ){
                
                $output[ $opt_name ] = \'\';
                
                foreach( $config[ $opt_name ] as $key => $conf ){
                    
                    if( empty( $conf[\'value\'] ) ){
                        $conf[\'value\'] = $conf[\'label\'];
                    }
                    
                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected="selected"\' : \'\' );
                    
                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . "\\t";
                    
                }
                
            }
            
        }
        
    }
    
}

if( $toPlaceholders ){
    
    foreach( $output as $pl_name => $out ){
        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );
    }
    
    $output = array();
    
}

return implode( \'\', $output );',
    ),
  ),
  '9494275cd17304407c2518b20755da20' => 
  array (
    'criteria' => 
    array (
      'name' => 'num_format',
    ),
    'object' => 
    array (
      'id' => 34,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'num_format',
      'description' => 'Number format output filter',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/*
 * numFormat snippet
 * example: [[*price:num_format]]
 */

if(strlen($input)==0) return \'\';

$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));
return number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/*
 * numFormat snippet
 * example: [[*price:num_format]]
 */

if(strlen($input)==0) return \'\';

$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));
return number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');',
    ),
  ),
  'a59d6855eb104546132060922716ae13' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_curr_rate',
    ),
    'object' => 
    array (
      'id' => 35,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_curr_rate',
      'description' => '',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/*
 * shk_curr_rate snippet
 * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]
 */

if(!function_exists(\'shk_currency_calc\')){
    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){
        
        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;//обратный перевод цены
        
        if( !$rate_ratio ){
            
            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){
                
                $rate_ratio = $_SESSION[\'shk_curr_rate\'];
                
            }else{
                
                if( !isset( $properties[\'currency_rate\'] ) ){
                    require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );
                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];
                }
                
                $rate_ratio = 1;
                
                if( $properties[\'currency_default\'] != $currency_id ){
                    
                    $rate_default = 1;
                    $rate = 1;
                    //Определяем курс по умолчанию и новый курс
                    foreach( $properties[\'currency_rate\'] as $rt ){
                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){
                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                        else if( $rt[\'id\'] == $currency_id ){
                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                    }
                    
                    if( !$inverse ){
                        $rate_ratio = $rate_default / $rate;
                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;
                    }else{
                        $rate_ratio = $rate / $rate_default;
                    }
                    
                }
                
            }
            
        }
        
        //Считаем цену по курсу
        if( $rate_ratio ){
            
            $price = $base_price * $rate_ratio;
            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );
            return $price;
        
        }else{
            return $base_price;
        }
        
    }
}

$scriptProperties = array_merge(
    array(
        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),
        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )
    ),
    $scriptProperties
);

$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));
$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];
//Если нужен всегда преевод в одну валюту
if( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){
    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, "/" );
    $shk_currency = intval($scriptProperties[\'currency_selected\']);
}

//Считаем цену по курсу
$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );

return $output;',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/*
 * shk_curr_rate snippet
 * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]
 */

if(!function_exists(\'shk_currency_calc\')){
    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){
        
        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;//обратный перевод цены
        
        if( !$rate_ratio ){
            
            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){
                
                $rate_ratio = $_SESSION[\'shk_curr_rate\'];
                
            }else{
                
                if( !isset( $properties[\'currency_rate\'] ) ){
                    require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );
                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];
                }
                
                $rate_ratio = 1;
                
                if( $properties[\'currency_default\'] != $currency_id ){
                    
                    $rate_default = 1;
                    $rate = 1;
                    //Определяем курс по умолчанию и новый курс
                    foreach( $properties[\'currency_rate\'] as $rt ){
                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){
                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                        else if( $rt[\'id\'] == $currency_id ){
                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                    }
                    
                    if( !$inverse ){
                        $rate_ratio = $rate_default / $rate;
                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;
                    }else{
                        $rate_ratio = $rate / $rate_default;
                    }
                    
                }
                
            }
            
        }
        
        //Считаем цену по курсу
        if( $rate_ratio ){
            
            $price = $base_price * $rate_ratio;
            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );
            return $price;
        
        }else{
            return $base_price;
        }
        
    }
}

$scriptProperties = array_merge(
    array(
        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),
        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )
    ),
    $scriptProperties
);

$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));
$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];
//Если нужен всегда преевод в одну валюту
if( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){
    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, "/" );
    $shk_currency = intval($scriptProperties[\'currency_selected\']);
}

//Считаем цену по курсу
$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );

return $output;',
    ),
  ),
  '85fa12677e1378283adf00b3a012dc73' => 
  array (
    'criteria' => 
    array (
      'name' => 'param_edit_table',
    ),
    'object' => 
    array (
      'id' => 36,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'param_edit_table',
      'description' => 'Print options of product (param-edit)',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '//***********************************
//Сниппет для MODx 2.x
//***********************************

/*

[[param_edit_table?
&docId=`1`
&tvName=`param1`
&tpl=`properties_table`
]]

[[param_edit_table?
&tvValue=`[[+tv.param1]]`
&tpl=`properties_table`
]]

[[param_edit_table?
&docId=`1`
&tvName=`all_width`
&postName=`w`
&tpl=`@CODE:
<select name="w">
    <option value=""></option>
    [[+inner]]
</select>
<!--tpl_separator-->
<option value="[[+field1]]"[[+selected1]]>[[+field1]]</option>
`]]

Примеры чанка:

1.

<h1>Заголовок</h1>
[[+inner]]
<!--tpl_separator-->
<div class="one">
    <img src="[[+field1]]" width="203" height="144" alt="" />
    <h3>[[+field2]]</h3>
    <p>[[+field3]]</p>
</div>

2.

<table>[[+inner]]</table>
<!--tpl_separator-->
<tr>
    [[+inner]]
</tr>
<!--tpl_separator-->
<td>[[+col_num]]. [[+field]]</td>

3.

<div class="product-options">
    [[+inner]]
</div>
<!--tpl_separator-->
<label>
    <input type="radio" class="shk_param" value="[[*idx]]__[[+field2]]" name="size__[[+id]]" onclick="SHK.additOpt(this)" [[+idx:eq=`0`:then=`checked`]] />
    [[+field1]]
</label>

*/

$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));
$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');
$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);
$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');
$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');
$postName_arr = explode(\',\',$postName);
$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');
$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);
$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);
$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');
$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);
$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');
$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');
$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');
$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');
if(!$tpl) return \'\';
$output = \'\';
$out_arr = array();

if(!function_exists(\'fetchTpl\')){
function fetchTpl($tpl){
    global $modx;
    $template = "";
    if(substr($tpl, 0, 6) == "@FILE:"){
      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
        $template = file_get_contents($tpl_file);
    }else if(substr($tpl, 0, 6) == "@CODE:"){
        $template = substr($tpl, 6);
    }else if($modx->getChunk($tpl) != ""){
        $template = $modx->getChunk($tpl);
    }else{
        $template = false;
    }
    return $template;
}
}

if(!$tvValue){
    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));
    if($tv) $tvValue = $tv->getValue($docId);
}
$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));
$fields = $tvValue ? explode(\'||\',$tvValue) : array();
if(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);

$row_unique = uniqid();
$col_unique = uniqid();

if(count($fields)>0 && count($fields) >= $minCount){

    foreach($fields as $key => $val){
        $row = explode(\'==\',$val);
        $rowArr = array();
        foreach($row as $k => $v){
            if(!empty($v) || !$noEmpty){
                
                $index = $separateCols ? $k : 0;
                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;
                
                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];
                if(isset($_POST[$postName])){
                    $selected = $_POST[$postName] == $v ? \' selected="selected"\' : \'\';
                }if(isset($_GET[$postName])){
                    $selected = $_GET[$postName] == $v ? \' selected="selected"\' : \'\';
                }else{
                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected="selected"\' : \'\';
                }
                
                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;
                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';
                
                if(!empty($rowChunk[2])){
                    $colArr = array(
                        $placeholderPrefix.\'col_num\' => $k+1,
                        $placeholderPrefix.\'field\' => $v,
                        $placeholderPrefix.\'idx\' => $key,
                        $placeholderPrefix.\'num\' => $key+1
                    );
                    $chunk = $modx->newObject(\'modChunk\');
                    $chunk->fromArray(array(\'name\'=>"@INLINE-{$col_unique}",\'snippet\'=>$rowChunk[2]));
                    $chunk->setCacheable(false);
                    
                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);
                    
                }
            }
        }
        unset($k,$v);
        
        //echo \'<pre>\'; print_r($rowArr); echo \'</pre>\'; exit;
        
        foreach($rowArr as $k => $v){
            $chunk = $modx->newObject(\'modChunk\');
            $chunk->fromArray(array(\'name\'=>"@INLINE-{$row_unique}",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));
            $chunk->setCacheable(false);
            $v[$placeholderPrefix.\'idx\'] = $key;
            $v[$placeholderPrefix.\'num\'] = $key+1;
            $v[$placeholderPrefix.\'id\'] = $docId;
            $temp_out = $chunk->process($v);
            if(!$noEmpty || ($temp_out != $rowChunk[1])){
                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';
                $out_arr[$k] .= $temp_out;
            }
        }
        unset($k,$v);
    }
    unset($key,$val);
    
    //echo \'<pre>\'; print_r($out_arr); echo \'</pre>\'; exit;
    
    if(strlen($out_arr[0])>0){
        $chunk = $modx->newObject(\'modChunk\');
        $chunk->fromArray(array(\'name\'=>"@INLINE-".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));
        $chunk->setCacheable(false);
        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));
        $output = $out_arr[0];
        
        //Ставим отдельные плейсхолдеры для всех колонок таблицы
        if($separateCols){
            array_shift($out_arr);
            array_shift($postName_arr);
            foreach($out_arr as $key => $val){
                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;
                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);
            }
        }
        
    }

}else if($defaultValue && $defaultTpl){
    
    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));
    
}

if($output && $toPlaceholder){
    $modx->setPlaceholder($toPlaceholder, $output);
    $output = \'\';
}

return $output;',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '//***********************************
//Сниппет для MODx 2.x
//***********************************

/*

[[param_edit_table?
&docId=`1`
&tvName=`param1`
&tpl=`properties_table`
]]

[[param_edit_table?
&tvValue=`[[+tv.param1]]`
&tpl=`properties_table`
]]

[[param_edit_table?
&docId=`1`
&tvName=`all_width`
&postName=`w`
&tpl=`@CODE:
<select name="w">
    <option value=""></option>
    [[+inner]]
</select>
<!--tpl_separator-->
<option value="[[+field1]]"[[+selected1]]>[[+field1]]</option>
`]]

Примеры чанка:

1.

<h1>Заголовок</h1>
[[+inner]]
<!--tpl_separator-->
<div class="one">
    <img src="[[+field1]]" width="203" height="144" alt="" />
    <h3>[[+field2]]</h3>
    <p>[[+field3]]</p>
</div>

2.

<table>[[+inner]]</table>
<!--tpl_separator-->
<tr>
    [[+inner]]
</tr>
<!--tpl_separator-->
<td>[[+col_num]]. [[+field]]</td>

3.

<div class="product-options">
    [[+inner]]
</div>
<!--tpl_separator-->
<label>
    <input type="radio" class="shk_param" value="[[*idx]]__[[+field2]]" name="size__[[+id]]" onclick="SHK.additOpt(this)" [[+idx:eq=`0`:then=`checked`]] />
    [[+field1]]
</label>

*/

$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));
$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');
$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);
$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');
$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');
$postName_arr = explode(\',\',$postName);
$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');
$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);
$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);
$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');
$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);
$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');
$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');
$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');
$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');
if(!$tpl) return \'\';
$output = \'\';
$out_arr = array();

if(!function_exists(\'fetchTpl\')){
function fetchTpl($tpl){
    global $modx;
    $template = "";
    if(substr($tpl, 0, 6) == "@FILE:"){
      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);
        $template = file_get_contents($tpl_file);
    }else if(substr($tpl, 0, 6) == "@CODE:"){
        $template = substr($tpl, 6);
    }else if($modx->getChunk($tpl) != ""){
        $template = $modx->getChunk($tpl);
    }else{
        $template = false;
    }
    return $template;
}
}

if(!$tvValue){
    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));
    if($tv) $tvValue = $tv->getValue($docId);
}
$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));
$fields = $tvValue ? explode(\'||\',$tvValue) : array();
if(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);

$row_unique = uniqid();
$col_unique = uniqid();

if(count($fields)>0 && count($fields) >= $minCount){

    foreach($fields as $key => $val){
        $row = explode(\'==\',$val);
        $rowArr = array();
        foreach($row as $k => $v){
            if(!empty($v) || !$noEmpty){
                
                $index = $separateCols ? $k : 0;
                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;
                
                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];
                if(isset($_POST[$postName])){
                    $selected = $_POST[$postName] == $v ? \' selected="selected"\' : \'\';
                }if(isset($_GET[$postName])){
                    $selected = $_GET[$postName] == $v ? \' selected="selected"\' : \'\';
                }else{
                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected="selected"\' : \'\';
                }
                
                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;
                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';
                
                if(!empty($rowChunk[2])){
                    $colArr = array(
                        $placeholderPrefix.\'col_num\' => $k+1,
                        $placeholderPrefix.\'field\' => $v,
                        $placeholderPrefix.\'idx\' => $key,
                        $placeholderPrefix.\'num\' => $key+1
                    );
                    $chunk = $modx->newObject(\'modChunk\');
                    $chunk->fromArray(array(\'name\'=>"@INLINE-{$col_unique}",\'snippet\'=>$rowChunk[2]));
                    $chunk->setCacheable(false);
                    
                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);
                    
                }
            }
        }
        unset($k,$v);
        
        //echo \'<pre>\'; print_r($rowArr); echo \'</pre>\'; exit;
        
        foreach($rowArr as $k => $v){
            $chunk = $modx->newObject(\'modChunk\');
            $chunk->fromArray(array(\'name\'=>"@INLINE-{$row_unique}",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));
            $chunk->setCacheable(false);
            $v[$placeholderPrefix.\'idx\'] = $key;
            $v[$placeholderPrefix.\'num\'] = $key+1;
            $v[$placeholderPrefix.\'id\'] = $docId;
            $temp_out = $chunk->process($v);
            if(!$noEmpty || ($temp_out != $rowChunk[1])){
                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';
                $out_arr[$k] .= $temp_out;
            }
        }
        unset($k,$v);
    }
    unset($key,$val);
    
    //echo \'<pre>\'; print_r($out_arr); echo \'</pre>\'; exit;
    
    if(strlen($out_arr[0])>0){
        $chunk = $modx->newObject(\'modChunk\');
        $chunk->fromArray(array(\'name\'=>"@INLINE-".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));
        $chunk->setCacheable(false);
        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));
        $output = $out_arr[0];
        
        //Ставим отдельные плейсхолдеры для всех колонок таблицы
        if($separateCols){
            array_shift($out_arr);
            array_shift($postName_arr);
            foreach($out_arr as $key => $val){
                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;
                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);
            }
        }
        
    }

}else if($defaultValue && $defaultTpl){
    
    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));
    
}

if($output && $toPlaceholder){
    $modx->setPlaceholder($toPlaceholder, $output);
    $output = \'\';
}

return $output;',
    ),
  ),
  '4bbd03d72684df036c6dbb746f92e59b' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_sitemap',
    ),
    'object' => 
    array (
      'id' => 37,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_sitemap',
      'description' => 'Create sitemap.xml for catalog',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'snippet' => '/**
 * snippet shk_sitemap
 *
 * @author slaad
 * 
 */

/*

http://modx-shopkeeper.ru/forum/viewtopic.php?pid=20545#p20545

Examples

1. Only resources (one or more contexts):

[[shk_sitemap?
&packageNames=`modResource`
&classNames=`modResource`
]]

2. Resources and shop package (Shopkeeper), two contexts:

[[shk_sitemap?
&packageNames=`modResource,shop`
&classNames=`modResource,ShopContent`
&contexts=`web,catalog`
]]

*/

$config =  array( 
    \'packageNames\' => \'modResource,shop\',
    \'classNames\' => \'modResource,ShopContent\',
    \'contexts\' => \'web,catalog\'
);

$config = array_merge( $config, $scriptProperties );
$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
$config[\'urlSuffix\'] = $contentType->getExtension();
$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');

$output = "<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"
<urlset xmlns=\\"http://www.sitemaps.org/schemas/sitemap/0.9\\">" . PHP_EOL;

if(!function_exists(\'getMapQuery\')){
function getMapQuery($className,$select){
    global $modx;
        $query = $modx->newQuery($className);
        $query->select($select);
        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );
        if ( $query->prepare() && $query->stmt->execute() ){     
            $query_out= array();
            //$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());
            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);
            
            foreach($query_out as $r){
                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();
                foreach ($select as $s){
                    $resources[$r[\'id\']][$s] = $r[$s];
                }
            }         
        }
        return $resources;
    }
}

$packageNames = explode(\',\',$config[\'packageNames\']);
$classNames = explode(\',\',$config[\'classNames\']);
$contexts = explode(\',\',$config[\'contexts\']);

foreach ( $packageNames as $key => $packageName ){
    
    $parentName = $packageName == \'modResource\' ? "parent" : "resource_id";
    $select = array(\'id\',\'alias\',\'editedon\',$parentName);
    if( $packageName != \'modResource\' ){
        $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $packageName . \'/model/\';
        $modx->addPackage($packageName, $modelpath);
    }
    else{
        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );
    }
    
    $resources = getMapQuery($classNames[$key],$select);
    
    foreach ( $resources as $resource ){
        
        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];
        if ( $resource[$parentName] != 0 ){
            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');
        }
        else{
            $url = $modx->getOption(\'site_url\');
        }
        $url .= $resource[\'alias\'];
        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];
        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];
        $date = strftime( \'%Y-%m-%d\', $editedon );
        $output .= "
        <url>
            <loc>{$url}</loc>
            <lastmod>{$date}</lastmod>
            <priority>0.9</priority>
            <changefreq>monthly</changefreq>
        </url>";
    }

}

$output .= PHP_EOL . "</urlset>";

return $output;',
      'locked' => 0,
      'properties' => NULL,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/**
 * snippet shk_sitemap
 *
 * @author slaad
 * 
 */

/*

http://modx-shopkeeper.ru/forum/viewtopic.php?pid=20545#p20545

Examples

1. Only resources (one or more contexts):

[[shk_sitemap?
&packageNames=`modResource`
&classNames=`modResource`
]]

2. Resources and shop package (Shopkeeper), two contexts:

[[shk_sitemap?
&packageNames=`modResource,shop`
&classNames=`modResource,ShopContent`
&contexts=`web,catalog`
]]

*/

$config =  array( 
    \'packageNames\' => \'modResource,shop\',
    \'classNames\' => \'modResource,ShopContent\',
    \'contexts\' => \'web,catalog\'
);

$config = array_merge( $config, $scriptProperties );
$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
$config[\'urlSuffix\'] = $contentType->getExtension();
$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');

$output = "<?xml version=\\"1.0\\" encoding=\\"UTF-8\\"
<urlset xmlns=\\"http://www.sitemaps.org/schemas/sitemap/0.9\\">" . PHP_EOL;

if(!function_exists(\'getMapQuery\')){
function getMapQuery($className,$select){
    global $modx;
        $query = $modx->newQuery($className);
        $query->select($select);
        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );
        if ( $query->prepare() && $query->stmt->execute() ){     
            $query_out= array();
            //$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());
            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);
            
            foreach($query_out as $r){
                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();
                foreach ($select as $s){
                    $resources[$r[\'id\']][$s] = $r[$s];
                }
            }         
        }
        return $resources;
    }
}

$packageNames = explode(\',\',$config[\'packageNames\']);
$classNames = explode(\',\',$config[\'classNames\']);
$contexts = explode(\',\',$config[\'contexts\']);

foreach ( $packageNames as $key => $packageName ){
    
    $parentName = $packageName == \'modResource\' ? "parent" : "resource_id";
    $select = array(\'id\',\'alias\',\'editedon\',$parentName);
    if( $packageName != \'modResource\' ){
        $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $packageName . \'/model/\';
        $modx->addPackage($packageName, $modelpath);
    }
    else{
        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );
    }
    
    $resources = getMapQuery($classNames[$key],$select);
    
    foreach ( $resources as $resource ){
        
        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];
        if ( $resource[$parentName] != 0 ){
            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');
        }
        else{
            $url = $modx->getOption(\'site_url\');
        }
        $url .= $resource[\'alias\'];
        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];
        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];
        $date = strftime( \'%Y-%m-%d\', $editedon );
        $output .= "
        <url>
            <loc>{$url}</loc>
            <lastmod>{$date}</lastmod>
            <priority>0.9</priority>
            <changefreq>monthly</changefreq>
        </url>";
    }

}

$output .= PHP_EOL . "</urlset>";

return $output;',
    ),
  ),
  '40e74571d478f1615612c9b246a56179' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_contextSwitch',
    ),
    'object' => 
    array (
      'id' => 4,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_contextSwitch',
      'description' => 'Switch to catalog context.',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'plugincode' => '/*

 plugin contextSwitch
 
 System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete

*/

//ini_set( \'display_errors\', 1 );
//error_reporting(E_ALL);

if($modx->context->get(\'key\') == \'mgr\') return \'\';

$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');//shop
$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');//ShopContent
$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);
$debug = $modx->getOption(\'debug\',$scriptProperties,false);
$cacheOptions = array(
    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),
    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),
    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),
    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),
    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),
    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)
);

switch($modx->event->name){
    
    case "OnHandleRequest":
        
        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');
        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');
        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);
        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');
        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);
        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');
        $site_start = $modx->getOption(\'site_start\', null, 1);
        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];
        if( strpos( $request_uri, \'/\' ) !== false ){
            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'/\' ) );
        }else{
            $lang_key = $request_uri;
        }
        
        if( !$context_key ) return \'\';
        
        if( $modx->config[\'friendly_urls\'] ){
            
            if( $request_uri ){
                
                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
                $html_ext = $contentType->getExtension();
                
                $base_dir_alias = current( explode( \'/\', $request_uri ) );
                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){
                    $base_dir_alias .= $container_suffix;
                }
                if( !$container_suffix && $html_ext ){
                    $base_dir_alias .= $html_ext;
                }
                
                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );
                
                //Проверяем нужно ли переключать контекст
                $switch_action = false;
                foreach( $context_child_ids as $id ){
                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );
                    if( $temp_url == $base_dir_alias ){
                        $switch_action = true;
                        break;
                    }
                }
                
                if( $switch_action ){
                    $modx->reloadContext( $context_key );
                    $modx->switchContext( $context_key );
                    $modx->config[\'site_start\'] = $site_start;
                    $modx->setPlaceholder( \'context_key\', $context_key );
                }
                
            }
            
        }else{
            
            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;
            if(!$requestId) return \'\';
            $resource = $modx->getObject( \'modResource\', $requestId );
            if( $resource && $resource->get(\'context_key\') == $context_key ){
                $modx->reloadContext( $context_key );
                $modx->switchContext( $context_key );
                $modx->config[\'site_start\'] = $site_start;
                $modx->setPlaceholder( \'context_key\', $context_key );
            }
            
        }
    
    break;
    case "OnPageNotFound":
        
        if(!$prodClassName || $prodClassName==\'modResource\') break;
        
        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');
        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');
        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');
        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';
        
        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
        $html_ext = $contentType->getExtension();
        
        $parent_url = strpos( $url, \'/\' ) !== false ? substr( $url, 0, strrpos( $url, \'/\' ) ) . $container_suffix : \'\';
        $prod_alias = strpos( $url, \'/\' ) !== false ? substr( $url, (strrpos( $url, \'/\' )+1) ) : $url;
        if($html_ext) $prod_alias = substr( $prod_alias, 0, ( 0 - strlen( $html_ext ) ) );
        
        $resourceIdentifier = $modx->findResource($parent_url);
        if(!$resourceIdentifier) return \'\';
        
        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );
        if( !$resource ) return \'\';
        
        //Определяем параметры шаблона
        $templateObj = $resource->getOne(\'Template\');
        $templateProps = $templateObj->getProperties();
        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];
        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];
        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];
        
        $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $prodPackageName . \'/model/\';
        $modx->addPackage($prodPackageName, $modelpath);
        
        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );
        
        if($product){
            
            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);
            $product->set(\'parent\',$resourceIdentifier);
            
            $cacheKey = \'shk_\'.$prodPackageName.\'/\'.$product->get(\'id\');
            
            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );
            
            //Вытаскиваем из кэша
            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {
                
                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);
                
                if ($modx->resource) {
                    
                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);
                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];
                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);
                    
                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];
                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];
                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');
                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');
                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));
                    $isForward = $modx->resource->_isForward;
                    $modx->resource->setProcessed(true);
                    $fromCache = true;
                    
                    $modx->invokeEvent(\'OnLoadWebPageCache\');
                    
                }
            
            //Если в кэше нет, создаём новый виртуальный ресурс товара
            }else{
                
                $modx->resource = $modx->newObject(\'modResource\');
                //$modx->resource->set();
                
                ####################################################
                //Просчитываем поля по типам ввода связанных TV
                $product_fields = $product->toArray();
                $field_tv = array();
                
                $sql = "
                SELECT `formtabs`
                FROM `".$modx->config[\'table_prefix\']."migx_configs`
                WHERE `name` = \'{$prodPackageName}\'
                ";
                $stmt = $modx->prepare($sql);
                if ($stmt && $stmt->execute()) {
                    $migx_config_formtabs = $stmt->fetchColumn();
                    if($migx_config_formtabs){
                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);
                        foreach($migx_config_formtabs_arr as $formtabs){
                            
                            if(!empty($formtabs[\'fields\'])){
                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];
                            }else{
                                $temp_fields = array();
                            }
                            
                            foreach($temp_fields as $temp_field){
                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];
                            }
                        }
                        
                    }
                }
                $stmt->closeCursor();
                
                foreach($field_tv as $field_name => $tv_name){
                    if(isset($product_fields[$field_name])){
                        
                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));
                        if( is_object($tv_object) ){
                            if($tv_object->get(\'display\')==\'default\') continue;
                            
                            $tv_object->set(\'name\',$field_name);
                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));
                            $tv_object->set(\'output_properties\',$output_properties);
                            $tv_object->set(\'value\',$product_fields[$field_name]);
                            
                            $value = $product_fields[$field_name];
                            $value = $tv_object->prepareOutput($value);
                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');
                            
                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));
                            
                            $product_fields[$field_name] = $value;
                        }
                    }
                }
                ####################################################
                
                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));
                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);
                
                $modx->resource->set(\'id\',$product->get(\'id\'));
                $modx->resource->set(\'cacheable\',false);
                $modx->resource->set(\'class_key\',$prodClassName);
                $modx->resource->_content = \'\';
                $modx->resource->_output = \'\';
                $modx->resource->_isForward = true;
                //$modx->resource->_class = $prodClassName;
                
                $modx->elementCache = array();
                $modx->resourceGenerated = true;
                unset($resource);
                
            }
            
            unset($product);
            
            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'</pre>\'; exit; }
            
            //Просчитываем и выводим HTML-код страницы товара
            $modx->resourceIdentifier = $modx->resource->get(\'id\');
            $modx->resourceMethod = \'id\';
            
            $modx->request->prepareResponse();
            
        }
        
    break;

    case "OnWebPageComplete":
        
        if(!$prodClassName || $prodClassName == \'modResource\') break;
        
        $results= array();
        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {
            
            if( $modx->resource->class_key != $prodClassName ) break;
            
            $cacheKey = \'shk_\'.$prodPackageName.\'/\'.$modx->resource->get(\'id\');
            
            //$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));
            //$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );
            
            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );
            
            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {
                
                $results[\'resourceClass\'] = $modx->resource->_class;
                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();
                $results[\'resource\']= $modx->resource->toArray(\'\', true);
                $results[\'resource\'][\'_content\']= $modx->resource->_content;
                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;
                if ($contentType = $modx->resource->getOne(\'ContentType\')) {
                    $results[\'contentType\']= $contentType->toArray(\'\', true);
                }
                $results[\'resourceGroups\']= array();
                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';
                $policies = $modx->resource->findPolicy($context);
                if (is_array($policies)) {
                    $results[\'policyCache\']= $policies;
                }
                if (!empty($modx->elementCache)) {
                    $results[\'elementCache\']= $modx->elementCache;
                }
                if (!empty($modx->sourceCache)) {
                    $results[\'sourceCache\']= $modx->sourceCache;
                }
                if (!empty($modx->resource->_sjscripts)) {
                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;
                }
                if (!empty($modx->resource->_jscripts)) {
                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;
                }
                if (!empty($modx->resource->_loadedjscripts)) {
                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;
                }
                
                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));
                
                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {
                    $modx->log( modX::LOG_LEVEL_ERROR, "[contextSwitch] Could not cache resource " . $modx->resource->get(\'id\') );
                }
                
            }
            
            unset($cachedResource);
            
        }
        
    break;

}

return \'\';',
      'locked' => 0,
      'properties' => 'a:8:{s:19:"context_param_alias";a:7:{s:4:"name";s:19:"context_param_alias";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"c";s:7:"lexicon";N;s:4:"area";s:0:"";}s:16:"request_param_id";a:7:{s:4:"name";s:16:"request_param_id";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:2:"id";s:7:"lexicon";N;s:4:"area";s:0:"";}s:10:"catalog_id";a:7:{s:4:"name";s:10:"catalog_id";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"0";s:7:"lexicon";N;s:4:"area";s:0:"";}s:11:"context_key";a:7:{s:4:"name";s:11:"context_key";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:7:"catalog";s:7:"lexicon";N;s:4:"area";s:0:"";}s:10:"site_start";a:7:{s:4:"name";s:10:"site_start";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"1";s:7:"lexicon";N;s:4:"area";s:0:"";}s:15:"prodPackageName";a:7:{s:4:"name";s:15:"prodPackageName";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:13:"prodClassName";a:7:{s:4:"name";s:13:"prodClassName";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:0:"";s:7:"lexicon";N;s:4:"area";s:0:"";}s:14:"prodTemplateId";a:7:{s:4:"name";s:14:"prodTemplateId";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"1";s:7:"lexicon";N;s:4:"area";s:0:"";}}',
      'disabled' => 0,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/*

 plugin contextSwitch
 
 System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete

*/

//ini_set( \'display_errors\', 1 );
//error_reporting(E_ALL);

if($modx->context->get(\'key\') == \'mgr\') return \'\';

$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');//shop
$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');//ShopContent
$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);
$debug = $modx->getOption(\'debug\',$scriptProperties,false);
$cacheOptions = array(
    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),
    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),
    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),
    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),
    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),
    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)
);

switch($modx->event->name){
    
    case "OnHandleRequest":
        
        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');
        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');
        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);
        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');
        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);
        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');
        $site_start = $modx->getOption(\'site_start\', null, 1);
        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];
        if( strpos( $request_uri, \'/\' ) !== false ){
            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'/\' ) );
        }else{
            $lang_key = $request_uri;
        }
        
        if( !$context_key ) return \'\';
        
        if( $modx->config[\'friendly_urls\'] ){
            
            if( $request_uri ){
                
                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
                $html_ext = $contentType->getExtension();
                
                $base_dir_alias = current( explode( \'/\', $request_uri ) );
                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){
                    $base_dir_alias .= $container_suffix;
                }
                if( !$container_suffix && $html_ext ){
                    $base_dir_alias .= $html_ext;
                }
                
                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );
                
                //Проверяем нужно ли переключать контекст
                $switch_action = false;
                foreach( $context_child_ids as $id ){
                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );
                    if( $temp_url == $base_dir_alias ){
                        $switch_action = true;
                        break;
                    }
                }
                
                if( $switch_action ){
                    $modx->reloadContext( $context_key );
                    $modx->switchContext( $context_key );
                    $modx->config[\'site_start\'] = $site_start;
                    $modx->setPlaceholder( \'context_key\', $context_key );
                }
                
            }
            
        }else{
            
            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;
            if(!$requestId) return \'\';
            $resource = $modx->getObject( \'modResource\', $requestId );
            if( $resource && $resource->get(\'context_key\') == $context_key ){
                $modx->reloadContext( $context_key );
                $modx->switchContext( $context_key );
                $modx->config[\'site_start\'] = $site_start;
                $modx->setPlaceholder( \'context_key\', $context_key );
            }
            
        }
    
    break;
    case "OnPageNotFound":
        
        if(!$prodClassName || $prodClassName==\'modResource\') break;
        
        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');
        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');
        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');
        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';
        
        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));
        $html_ext = $contentType->getExtension();
        
        $parent_url = strpos( $url, \'/\' ) !== false ? substr( $url, 0, strrpos( $url, \'/\' ) ) . $container_suffix : \'\';
        $prod_alias = strpos( $url, \'/\' ) !== false ? substr( $url, (strrpos( $url, \'/\' )+1) ) : $url;
        if($html_ext) $prod_alias = substr( $prod_alias, 0, ( 0 - strlen( $html_ext ) ) );
        
        $resourceIdentifier = $modx->findResource($parent_url);
        if(!$resourceIdentifier) return \'\';
        
        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );
        if( !$resource ) return \'\';
        
        //Определяем параметры шаблона
        $templateObj = $resource->getOne(\'Template\');
        $templateProps = $templateObj->getProperties();
        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];
        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];
        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];
        
        $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $prodPackageName . \'/model/\';
        $modx->addPackage($prodPackageName, $modelpath);
        
        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );
        
        if($product){
            
            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);
            $product->set(\'parent\',$resourceIdentifier);
            
            $cacheKey = \'shk_\'.$prodPackageName.\'/\'.$product->get(\'id\');
            
            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );
            
            //Вытаскиваем из кэша
            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {
                
                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);
                
                if ($modx->resource) {
                    
                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);
                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];
                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);
                    
                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];
                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];
                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');
                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');
                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));
                    $isForward = $modx->resource->_isForward;
                    $modx->resource->setProcessed(true);
                    $fromCache = true;
                    
                    $modx->invokeEvent(\'OnLoadWebPageCache\');
                    
                }
            
            //Если в кэше нет, создаём новый виртуальный ресурс товара
            }else{
                
                $modx->resource = $modx->newObject(\'modResource\');
                //$modx->resource->set();
                
                ####################################################
                //Просчитываем поля по типам ввода связанных TV
                $product_fields = $product->toArray();
                $field_tv = array();
                
                $sql = "
                SELECT `formtabs`
                FROM `".$modx->config[\'table_prefix\']."migx_configs`
                WHERE `name` = \'{$prodPackageName}\'
                ";
                $stmt = $modx->prepare($sql);
                if ($stmt && $stmt->execute()) {
                    $migx_config_formtabs = $stmt->fetchColumn();
                    if($migx_config_formtabs){
                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);
                        foreach($migx_config_formtabs_arr as $formtabs){
                            
                            if(!empty($formtabs[\'fields\'])){
                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];
                            }else{
                                $temp_fields = array();
                            }
                            
                            foreach($temp_fields as $temp_field){
                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];
                            }
                        }
                        
                    }
                }
                $stmt->closeCursor();
                
                foreach($field_tv as $field_name => $tv_name){
                    if(isset($product_fields[$field_name])){
                        
                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));
                        if( is_object($tv_object) ){
                            if($tv_object->get(\'display\')==\'default\') continue;
                            
                            $tv_object->set(\'name\',$field_name);
                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));
                            $tv_object->set(\'output_properties\',$output_properties);
                            $tv_object->set(\'value\',$product_fields[$field_name]);
                            
                            $value = $product_fields[$field_name];
                            $value = $tv_object->prepareOutput($value);
                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');
                            
                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));
                            
                            $product_fields[$field_name] = $value;
                        }
                    }
                }
                ####################################################
                
                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));
                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);
                
                $modx->resource->set(\'id\',$product->get(\'id\'));
                $modx->resource->set(\'cacheable\',false);
                $modx->resource->set(\'class_key\',$prodClassName);
                $modx->resource->_content = \'\';
                $modx->resource->_output = \'\';
                $modx->resource->_isForward = true;
                //$modx->resource->_class = $prodClassName;
                
                $modx->elementCache = array();
                $modx->resourceGenerated = true;
                unset($resource);
                
            }
            
            unset($product);
            
            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'</pre>\'; exit; }
            
            //Просчитываем и выводим HTML-код страницы товара
            $modx->resourceIdentifier = $modx->resource->get(\'id\');
            $modx->resourceMethod = \'id\';
            
            $modx->request->prepareResponse();
            
        }
        
    break;

    case "OnWebPageComplete":
        
        if(!$prodClassName || $prodClassName == \'modResource\') break;
        
        $results= array();
        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {
            
            if( $modx->resource->class_key != $prodClassName ) break;
            
            $cacheKey = \'shk_\'.$prodPackageName.\'/\'.$modx->resource->get(\'id\');
            
            //$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));
            //$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );
            
            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );
            
            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {
                
                $results[\'resourceClass\'] = $modx->resource->_class;
                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();
                $results[\'resource\']= $modx->resource->toArray(\'\', true);
                $results[\'resource\'][\'_content\']= $modx->resource->_content;
                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;
                if ($contentType = $modx->resource->getOne(\'ContentType\')) {
                    $results[\'contentType\']= $contentType->toArray(\'\', true);
                }
                $results[\'resourceGroups\']= array();
                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';
                $policies = $modx->resource->findPolicy($context);
                if (is_array($policies)) {
                    $results[\'policyCache\']= $policies;
                }
                if (!empty($modx->elementCache)) {
                    $results[\'elementCache\']= $modx->elementCache;
                }
                if (!empty($modx->sourceCache)) {
                    $results[\'sourceCache\']= $modx->sourceCache;
                }
                if (!empty($modx->resource->_sjscripts)) {
                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;
                }
                if (!empty($modx->resource->_jscripts)) {
                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;
                }
                if (!empty($modx->resource->_loadedjscripts)) {
                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;
                }
                
                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));
                
                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {
                    $modx->log( modX::LOG_LEVEL_ERROR, "[contextSwitch] Could not cache resource " . $modx->resource->get(\'id\') );
                }
                
            }
            
            unset($cachedResource);
            
        }
        
    break;

}

return \'\';',
    ),
  ),
  '77f9fb0c8bdfe1dd9b092a55245f760d' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 4,
      'event' => 'OnHandleRequest',
    ),
    'object' => 
    array (
      'pluginid' => 4,
      'event' => 'OnHandleRequest',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '76f330637bd15b9a48aae3aafcde8aec' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 4,
      'event' => 'OnPageNotFound',
    ),
    'object' => 
    array (
      'pluginid' => 4,
      'event' => 'OnPageNotFound',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '455caed3e1fc0d03df876225eb2f89ce' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 4,
      'event' => 'OnWebPageComplete',
    ),
    'object' => 
    array (
      'pluginid' => 4,
      'event' => 'OnWebPageComplete',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '1bebab8d32e3095f5fd910fb787968dd' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_updateInventory',
    ),
    'object' => 
    array (
      'id' => 5,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_updateInventory',
      'description' => 'Update inventory data.',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'plugincode' => '/*
 * shk_updateInventory
 * 
 * Плагин обновляет количество товара на складе при переводе статуса заказа в "Отправлен" (или др.)
 * 
 * OnSHKChangeStatus
 */

$eventName = $modx->event->name;

$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );
$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );
$context = $modx->getOption( \'context\', $scriptProperties, \'\' );
$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );
if( !is_array( $order_ids ) ){
    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();
}
$status = $modx->getOption( \'status\', $scriptProperties, \'\' );

if( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';

$modelpath = $modx->getOption(\'core_path\') . \'components/shopkeeper3/model/\';
$modx->addPackage( \'shopkeeper3\', $modelpath );

foreach( $order_ids as $order_id ){
    
    $query = $modx->newQuery( \'shk_purchases\' );
    $query->where( array( \'order_id\' => $order_id ) );
    $purchases = $modx->getIterator( \'shk_purchases\', $query );
    
    if( $purchases ){
        
        foreach( $purchases as $purchase ){
            
            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){
                $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $purchase->package_name . \'/model/\';
                $modx->addPackage( $purchase->package_name, $modelpath );
            }
            
            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );
            if( $product ){
                
                $p_data = $product->toArray();
                
                //Если это поле основной таблицы
                if( isset( $p_data[ $inventory_fieldname ] ) ){
                    
                    $current_inventory = $p_data[ $inventory_fieldname ];
                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;
                    if( !$current_inventory ) continue;
                    
                    $new_inventory = $current_inventory - $purchase->count;
                    if( $new_inventory < 0 ) $new_inventory = 0;
                    
                    $product->set( $inventory_fieldname, $new_inventory );
                    $product->save();
                    
                }
                //Если значение хранится в TV параметре
                else{
                    
                    $table_name = \'\';
                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {
                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';
                    }
                    if( $table_name != \'site_content\' ) continue;
                    
                    $context = $p_data[\'context_key\'];
                    
                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));
                    if( !$tv ) continue;
                    
                    $current_inventory = $tv->getValue( $p_data[\'id\'] );
                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;
                    if( !$current_inventory ) continue;
                    
                    $new_inventory = $current_inventory - $purchase->count;
                    if( $new_inventory < 0 ) $new_inventory = 0;
                    
                    //$tv->setValue( $p_data[\'id\'], $new_inventory );
                    
                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(
                        \'tmplvarid\' => $tv->get(\'id\'),
                        \'contentid\' => $p_data[\'id\'],
                    ),true);
                    
                    if( $templateVarResource ){
                        $templateVarResource->set( \'value\', $new_inventory );
                        $templateVarResource->save();
                    }
                    
                }
                
            }
            
        }
        
    }
    
}


//Очистка кэша сайта
if( $context ){
    $modx->cacheManager->refresh(array(
        \'resource\' => array( \'contexts\' => array( $context ) ),
    ));
}

return \'\';',
      'locked' => 0,
      'properties' => 'a:3:{s:13:"plugin_status";a:7:{s:4:"name";s:13:"plugin_status";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:1:"2";s:7:"lexicon";N;s:4:"area";s:0:"";}s:19:"inventory_fieldname";a:7:{s:4:"name";s:19:"inventory_fieldname";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:9:"inventory";s:7:"lexicon";N;s:4:"area";s:0:"";}s:7:"context";a:7:{s:4:"name";s:7:"context";s:4:"desc";s:0:"";s:4:"type";s:9:"textfield";s:7:"options";s:0:"";s:5:"value";s:3:"web";s:7:"lexicon";N;s:4:"area";s:0:"";}}',
      'disabled' => 1,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/*
 * shk_updateInventory
 * 
 * Плагин обновляет количество товара на складе при переводе статуса заказа в "Отправлен" (или др.)
 * 
 * OnSHKChangeStatus
 */

$eventName = $modx->event->name;

$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );
$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );
$context = $modx->getOption( \'context\', $scriptProperties, \'\' );
$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );
if( !is_array( $order_ids ) ){
    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();
}
$status = $modx->getOption( \'status\', $scriptProperties, \'\' );

if( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';

$modelpath = $modx->getOption(\'core_path\') . \'components/shopkeeper3/model/\';
$modx->addPackage( \'shopkeeper3\', $modelpath );

foreach( $order_ids as $order_id ){
    
    $query = $modx->newQuery( \'shk_purchases\' );
    $query->where( array( \'order_id\' => $order_id ) );
    $purchases = $modx->getIterator( \'shk_purchases\', $query );
    
    if( $purchases ){
        
        foreach( $purchases as $purchase ){
            
            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){
                $modelpath = $modx->getOption(\'core_path\') . \'components/\' . $purchase->package_name . \'/model/\';
                $modx->addPackage( $purchase->package_name, $modelpath );
            }
            
            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );
            if( $product ){
                
                $p_data = $product->toArray();
                
                //Если это поле основной таблицы
                if( isset( $p_data[ $inventory_fieldname ] ) ){
                    
                    $current_inventory = $p_data[ $inventory_fieldname ];
                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;
                    if( !$current_inventory ) continue;
                    
                    $new_inventory = $current_inventory - $purchase->count;
                    if( $new_inventory < 0 ) $new_inventory = 0;
                    
                    $product->set( $inventory_fieldname, $new_inventory );
                    $product->save();
                    
                }
                //Если значение хранится в TV параметре
                else{
                    
                    $table_name = \'\';
                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {
                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';
                    }
                    if( $table_name != \'site_content\' ) continue;
                    
                    $context = $p_data[\'context_key\'];
                    
                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));
                    if( !$tv ) continue;
                    
                    $current_inventory = $tv->getValue( $p_data[\'id\'] );
                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;
                    if( !$current_inventory ) continue;
                    
                    $new_inventory = $current_inventory - $purchase->count;
                    if( $new_inventory < 0 ) $new_inventory = 0;
                    
                    //$tv->setValue( $p_data[\'id\'], $new_inventory );
                    
                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(
                        \'tmplvarid\' => $tv->get(\'id\'),
                        \'contentid\' => $p_data[\'id\'],
                    ),true);
                    
                    if( $templateVarResource ){
                        $templateVarResource->set( \'value\', $new_inventory );
                        $templateVarResource->save();
                    }
                    
                }
                
            }
            
        }
        
    }
    
}


//Очистка кэша сайта
if( $context ){
    $modx->cacheManager->refresh(array(
        \'resource\' => array( \'contexts\' => array( $context ) ),
    ));
}

return \'\';',
    ),
  ),
  'e8f2bf8965db811efe306e81ba3114fc' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 5,
      'event' => 'OnSHKChangeStatus',
    ),
    'object' => 
    array (
      'pluginid' => 5,
      'event' => 'OnSHKChangeStatus',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '332b5f2d5cfc715c06cc2b204ebe03cb' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_tv_input_output',
    ),
    'object' => 
    array (
      'id' => 6,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_tv_input_output',
      'description' => 'Print Shopkeeper`s input and output types for TV.',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'plugincode' => '$corePath = MODX_CORE_PATH.\'components/shopkeeper3/\';

switch ($modx->event->name) {
    //tv input
    case \'OnTVInputRenderList\':
        if($modx->context->get(\'key\') != \'mgr\') return;
        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/js/shk_mgr.js\');
        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/js/widgets/shk.grid.js\');
        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/css/mgr.css\');
        $modx->event->output($corePath.\'elements/tv/input/\');
    break;
    case \'OnTVInputPropertiesList\':
        if($modx->context->get(\'key\') != \'mgr\') return;
        $modx->event->output($corePath.\'elements/tv/inputproperties/\');
    break;
    //tv output
    case \'OnTVOutputRenderList\':
        $modx->event->output($corePath.\'elements/tv/output/\');
    break;
    case \'OnTVOutputRenderPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/outputproperties/\');
    break;
}

return;',
      'locked' => 0,
      'properties' => NULL,
      'disabled' => 0,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '$corePath = MODX_CORE_PATH.\'components/shopkeeper3/\';

switch ($modx->event->name) {
    //tv input
    case \'OnTVInputRenderList\':
        if($modx->context->get(\'key\') != \'mgr\') return;
        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/js/shk_mgr.js\');
        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/js/widgets/shk.grid.js\');
        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components/shopkeeper3/mgr/css/mgr.css\');
        $modx->event->output($corePath.\'elements/tv/input/\');
    break;
    case \'OnTVInputPropertiesList\':
        if($modx->context->get(\'key\') != \'mgr\') return;
        $modx->event->output($corePath.\'elements/tv/inputproperties/\');
    break;
    //tv output
    case \'OnTVOutputRenderList\':
        $modx->event->output($corePath.\'elements/tv/output/\');
    break;
    case \'OnTVOutputRenderPropertiesList\':
        $modx->event->output($corePath.\'elements/tv/outputproperties/\');
    break;
}

return;',
    ),
  ),
  '6cbd9d19ad40dc405e8b5eb13655f4d9' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVInputRenderList',
    ),
    'object' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVInputRenderList',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  'fad422c4bb16fb621ff4e5c4624ff7ac' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVInputPropertiesList',
    ),
    'object' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVInputPropertiesList',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '888fd280650121504f81c534a428e146' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVOutputRenderList',
    ),
    'object' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVOutputRenderList',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '7fc2ed13d2124c75dc0e2f0ae675bb68' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVOutputRenderPropertiesList',
    ),
    'object' => 
    array (
      'pluginid' => 6,
      'event' => 'OnTVOutputRenderPropertiesList',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  'cc50b28fed4c997a465fff8866bbe73f' => 
  array (
    'criteria' => 
    array (
      'name' => 'shk_multicurrency',
    ),
    'object' => 
    array (
      'id' => 7,
      'source' => 1,
      'property_preprocess' => 0,
      'name' => 'shk_multicurrency',
      'description' => 'Multicurrency in store.',
      'editor_type' => 0,
      'category' => 9,
      'cache_type' => 0,
      'plugincode' => '/*
 plugin shk_multicurrency
 System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice

<div>
    Валюта:
    <select id="site_currency" name="curency">
        <option value="1">руб.</option>
        <option value="2">грн.</option>
        <option value="3">USD</option>
        <option value="4">euro</option>
    </select>
</div>

*/

$scriptProperties = array_merge(
    array(
        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),
        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )
    ),
    $scriptProperties
);

$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];
//Если нужен всегда преевод в одну валюту
if( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){
    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, "/" );
    $shk_currency = intval($scriptProperties[\'currency_selected\']);
}
$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;

if(!function_exists(\'shk_currency_calc\')){
    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){
        
        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;//обратный перевод цены
        
        if( !$rate_ratio ){
            
            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){
                
                $rate_ratio = $_SESSION[\'shk_curr_rate\'];
                
            }else{
                
                if( !isset( $properties[\'currency_rate\'] ) ){
                    require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );
                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];
                }
                
                $rate_ratio = 1;
                
                if( $properties[\'currency_default\'] != $currency_id ){
                    
                    $rate_default = 1;
                    $rate = 1;
                    //Определяем курс по умолчанию и новый курс
                    foreach( $properties[\'currency_rate\'] as $rt ){
                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){
                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                        else if( $rt[\'id\'] == $currency_id ){
                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                    }
                    
                    if( !$inverse ){
                        $rate_ratio = $rate_default / $rate;
                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;
                    }else{
                        $rate_ratio = $rate / $rate_default;
                    }
                    
                }
                
            }
            
        }
        
        //Считаем цену по курсу
        if( $rate_ratio ){
            
            $price = $base_price * $rate_ratio;
            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );
            return $price;
        
        }else{
            return $base_price;
        }
        
    }
}

switch($modx->event->name){
    
    case \'OnLoadWebDocument\':
        
        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';
        
        if(empty($scriptProperties[\'noScript\'])){
            
            $script_str = \'
            <script type="text/javascript">
                var shk_cindex = document.cookie.indexOf("shk_currency=") > -1 ? document.cookie.indexOf("shk_currency=") + new String("shk_currency=").length : -1;
                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;
                jQuery("#site_currency")
                .val(shk_currency)
                .bind("change",function(){
                    var loc_href = window.location.pathname+document.location.search;
                    window.location.href = loc_href+(loc_href.indexOf("?") > -1 ? "&" : "?") + "scurr=" + this.value;
                });
            </script>
            \';
            $modx->regClientScript( $script_str, true );
        }
        
        if( isset( $_GET[\'scurr\'] ) ){
            
            if( $currency_id != $shk_currency ){
                
                require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                
                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );
                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];
                $conf_delivery = $config[\'delivery\'];
                
            }
            
            $_SESSION[\'shk_curr_rate\'] = null;
            unset($_SESSION[\'shk_curr_rate\']);
            
            //Доставка
            if( !empty( $conf_delivery ) ){
                
                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';
                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;
                $_SESSION[\'shk_delivery\'] = array();
                
                foreach( $conf_delivery as $opt ){
                    
                    if( $opt[\'label\'] == $delivery_label ){
                        
                        $_SESSION[\'shk_delivery\'] = array(
                            \'label\' => $opt[\'label\'],
                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,
                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),
                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),
                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )
                        );
                        
                        break;
                    }
                    
                }
                
                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );
                }
                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );
                }
                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );
                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];
                }
                
            }
            
            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();
            
            if( !empty( $scriptProperties[\'currency_rate\'] ) ){
                
                //Изменяем цены товаров в корзине
                if( !empty( $purchases ) ){
                    
                    foreach( $purchases as $key => &$purchase ){
                        
                        if( isset( $purchase[\'old_price\'] ) ){
                            $base_price = $purchase[\'old_price\'];
                        }
                        else if( !isset( $purchase[\'old_price\'] ) ) {
                            $purchase[\'old_price\'] = $purchase[\'price\'];
                            $base_price = $purchase[\'price\'];
                        }
                        
                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );
                        
                        //Доп. параметры
                        if( !empty( $purchase[\'options\'] ) ){
                            foreach( $purchase[\'options\'] as &$addit_param ){
                                
                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];
                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );
                                
                            }
                        }
                        
                    }
                    
                    $_SESSION[\'shk_order\'] = $purchases;
                    
                }else{
                    
                    //Если нет товаров, просто переключаем валюту
                    shk_currency_calc( $scriptProperties, 0, $currency_id );
                    
                }
                
                $shk_currency = $currency_id;
                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, "/" );
                
                //Сохраняем название валюты
                $currency_name = \'\';
                foreach( $scriptProperties[\'currency_rate\'] as $rt ){
                    if( $rt[\'id\'] == $currency_id ){
                        $currency_name = $rt[\'label\'];
                        break;
                    }
                }
                $_SESSION[\'shk_currency_name\'] = $currency_name;
                
            }
            
            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');
            if( $modx->config[\'friendly_urls\'] ){
                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );
            }
            
            $modx->sendRedirect( $back_url, 0 );
            
        }
        
        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';
        if( !$currency_name ){
            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');
        }
        $modx->setPlaceholder( \'shk_currency\', $currency_name );
        
    break;
    case \'OnSHKgetProductAdditParamPrice\':
    case \'OnSHKgetDeliveryPrice\':
    case \'OnSHKgetProductPrice\':
        
        $output = $modx->getOption( \'price\', $scriptProperties, 0 );
        
        if( is_numeric( $output ) ){
            
            //Считаем цену по курсу
            $output = shk_currency_calc( $scriptProperties, $output, $currency_id );
            
            $modx->event->_output = \'\';
            $modx->event->output( $output );
            
        }else{
            $modx->event->output( false );
        }
        
    break;
    
}

return \'\';',
      'locked' => 0,
      'properties' => NULL,
      'disabled' => 1,
      'moduleguid' => '',
      'static' => 0,
      'static_file' => '',
      'content' => '/*
 plugin shk_multicurrency
 System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice

<div>
    Валюта:
    <select id="site_currency" name="curency">
        <option value="1">руб.</option>
        <option value="2">грн.</option>
        <option value="3">USD</option>
        <option value="4">euro</option>
    </select>
</div>

*/

$scriptProperties = array_merge(
    array(
        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),
        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )
    ),
    $scriptProperties
);

$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];
//Если нужен всегда преевод в одну валюту
if( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){
    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, "/" );
    $shk_currency = intval($scriptProperties[\'currency_selected\']);
}
$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;

if(!function_exists(\'shk_currency_calc\')){
    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){
        
        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;//обратный перевод цены
        
        if( !$rate_ratio ){
            
            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){
                
                $rate_ratio = $_SESSION[\'shk_curr_rate\'];
                
            }else{
                
                if( !isset( $properties[\'currency_rate\'] ) ){
                    require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );
                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];
                }
                
                $rate_ratio = 1;
                
                if( $properties[\'currency_default\'] != $currency_id ){
                    
                    $rate_default = 1;
                    $rate = 1;
                    //Определяем курс по умолчанию и новый курс
                    foreach( $properties[\'currency_rate\'] as $rt ){
                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){
                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                        else if( $rt[\'id\'] == $currency_id ){
                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );
                        }
                    }
                    
                    if( !$inverse ){
                        $rate_ratio = $rate_default / $rate;
                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;
                    }else{
                        $rate_ratio = $rate / $rate_default;
                    }
                    
                }
                
            }
            
        }
        
        //Считаем цену по курсу
        if( $rate_ratio ){
            
            $price = $base_price * $rate_ratio;
            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );
            return $price;
        
        }else{
            return $base_price;
        }
        
    }
}

switch($modx->event->name){
    
    case \'OnLoadWebDocument\':
        
        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';
        
        if(empty($scriptProperties[\'noScript\'])){
            
            $script_str = \'
            <script type="text/javascript">
                var shk_cindex = document.cookie.indexOf("shk_currency=") > -1 ? document.cookie.indexOf("shk_currency=") + new String("shk_currency=").length : -1;
                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;
                jQuery("#site_currency")
                .val(shk_currency)
                .bind("change",function(){
                    var loc_href = window.location.pathname+document.location.search;
                    window.location.href = loc_href+(loc_href.indexOf("?") > -1 ? "&" : "?") + "scurr=" + this.value;
                });
            </script>
            \';
            $modx->regClientScript( $script_str, true );
        }
        
        if( isset( $_GET[\'scurr\'] ) ){
            
            if( $currency_id != $shk_currency ){
                
                require_once MODX_CORE_PATH . "components/shopkeeper3/model/shopkeeper.class.php";
                
                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );
                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];
                $conf_delivery = $config[\'delivery\'];
                
            }
            
            $_SESSION[\'shk_curr_rate\'] = null;
            unset($_SESSION[\'shk_curr_rate\']);
            
            //Доставка
            if( !empty( $conf_delivery ) ){
                
                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';
                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;
                $_SESSION[\'shk_delivery\'] = array();
                
                foreach( $conf_delivery as $opt ){
                    
                    if( $opt[\'label\'] == $delivery_label ){
                        
                        $_SESSION[\'shk_delivery\'] = array(
                            \'label\' => $opt[\'label\'],
                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,
                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),
                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),
                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )
                        );
                        
                        break;
                    }
                    
                }
                
                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );
                }
                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );
                }
                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){
                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );
                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];
                }
                
            }
            
            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();
            
            if( !empty( $scriptProperties[\'currency_rate\'] ) ){
                
                //Изменяем цены товаров в корзине
                if( !empty( $purchases ) ){
                    
                    foreach( $purchases as $key => &$purchase ){
                        
                        if( isset( $purchase[\'old_price\'] ) ){
                            $base_price = $purchase[\'old_price\'];
                        }
                        else if( !isset( $purchase[\'old_price\'] ) ) {
                            $purchase[\'old_price\'] = $purchase[\'price\'];
                            $base_price = $purchase[\'price\'];
                        }
                        
                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );
                        
                        //Доп. параметры
                        if( !empty( $purchase[\'options\'] ) ){
                            foreach( $purchase[\'options\'] as &$addit_param ){
                                
                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];
                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );
                                
                            }
                        }
                        
                    }
                    
                    $_SESSION[\'shk_order\'] = $purchases;
                    
                }else{
                    
                    //Если нет товаров, просто переключаем валюту
                    shk_currency_calc( $scriptProperties, 0, $currency_id );
                    
                }
                
                $shk_currency = $currency_id;
                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, "/" );
                
                //Сохраняем название валюты
                $currency_name = \'\';
                foreach( $scriptProperties[\'currency_rate\'] as $rt ){
                    if( $rt[\'id\'] == $currency_id ){
                        $currency_name = $rt[\'label\'];
                        break;
                    }
                }
                $_SESSION[\'shk_currency_name\'] = $currency_name;
                
            }
            
            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');
            if( $modx->config[\'friendly_urls\'] ){
                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );
            }
            
            $modx->sendRedirect( $back_url, 0 );
            
        }
        
        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';
        if( !$currency_name ){
            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');
        }
        $modx->setPlaceholder( \'shk_currency\', $currency_name );
        
    break;
    case \'OnSHKgetProductAdditParamPrice\':
    case \'OnSHKgetDeliveryPrice\':
    case \'OnSHKgetProductPrice\':
        
        $output = $modx->getOption( \'price\', $scriptProperties, 0 );
        
        if( is_numeric( $output ) ){
            
            //Считаем цену по курсу
            $output = shk_currency_calc( $scriptProperties, $output, $currency_id );
            
            $modx->event->_output = \'\';
            $modx->event->output( $output );
            
        }else{
            $modx->event->output( false );
        }
        
    break;
    
}

return \'\';',
    ),
  ),
  '8b9c83af6e382604654594b9350fdb5f' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 7,
      'event' => 'OnLoadWebDocument',
    ),
    'object' => 
    array (
      'pluginid' => 7,
      'event' => 'OnLoadWebDocument',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '39fc7957ad836ee80f7e8ab22ef700ac' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetProductPrice',
    ),
    'object' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetProductPrice',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  '4408a2ab68f2a2e0d4a4848015fcbc8a' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetProductAdditParamPrice',
    ),
    'object' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetProductAdditParamPrice',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
  'c753eacacf3eb3eccac4f96edcca1c0c' => 
  array (
    'criteria' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetDeliveryPrice',
    ),
    'object' => 
    array (
      'pluginid' => 7,
      'event' => 'OnSHKgetDeliveryPrice',
      'priority' => 0,
      'propertyset' => 0,
    ),
  ),
);