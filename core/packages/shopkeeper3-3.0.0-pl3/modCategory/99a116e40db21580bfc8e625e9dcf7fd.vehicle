<?php return array (
  'unique_key' => 'category',
  'preserve_keys' => false,
  'update_object' => true,
  'related_objects' => 
  array (
    'Chunks' => 
    array (
      '7c96a7a93b4688675904d4f9321e44dc' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopCartRow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<tr class=\\"cart-order\\">\\n    <td width=\\"45%\\" align=\\"left\\"><b><a href=\\"[[+url]]\\">[[+name]]<\\/a><\\/b> [[+addit_data]]<\\/td>\\n    <td width=\\"30%\\">[[+price]] [[+currency]]<\\/td>\\n    <td width=\\"15%\\">\\n        <input class=\\"shk-count\\" type=\\"text\\" size=\\"2\\" name=\\"count[]\\" maxlength=\\"3\\" title=\\"\\u0438\\u0437\\u043c\\u0435\\u043d\\u0438\\u0442\\u044c \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e\\" value=\\"[[+count]]\\" \\/>\\n    <\\/td>\\n    <td width=\\"10%\\" align=\\"right\\">\\n        <a href=\\"[[+url_del_item]]\\" title=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" class=\\"shk-del\\"><img src=\\"assets\\/components\\/shopkeeper\\/css\\/web\\/default\\/img\\/delete.gif\\" width=\\"17\\" height=\\"17\\" alt=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" \\/><\\/a>\\n    <\\/td>\\n<\\/tr>","locked":0,"properties":null,"static":0,"static_file":"","content":"<tr class=\\"cart-order\\">\\n    <td width=\\"45%\\" align=\\"left\\"><b><a href=\\"[[+url]]\\">[[+name]]<\\/a><\\/b> [[+addit_data]]<\\/td>\\n    <td width=\\"30%\\">[[+price]] [[+currency]]<\\/td>\\n    <td width=\\"15%\\">\\n        <input class=\\"shk-count\\" type=\\"text\\" size=\\"2\\" name=\\"count[]\\" maxlength=\\"3\\" title=\\"\\u0438\\u0437\\u043c\\u0435\\u043d\\u0438\\u0442\\u044c \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e\\" value=\\"[[+count]]\\" \\/>\\n    <\\/td>\\n    <td width=\\"10%\\" align=\\"right\\">\\n        <a href=\\"[[+url_del_item]]\\" title=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" class=\\"shk-del\\"><img src=\\"assets\\/components\\/shopkeeper\\/css\\/web\\/default\\/img\\/delete.gif\\" width=\\"17\\" height=\\"17\\" alt=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" \\/><\\/a>\\n    <\\/td>\\n<\\/tr>"}',
        'guid' => '96872d41f7a4bbacd4372777cddf7f5a',
        'native_key' => NULL,
        'signature' => 'ee2e9d40872ad8c936d9b42eb04ea4d9',
      ),
      'f655100b4257cf90ee44d88684317151' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopCart","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<div class=\\"shop-cart\\" data-shopcart=\\"1\\">\\n    <div class=\\"shop-cart-head\\"><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"empty\\">\\n        <div class=\\"shop-cart-empty\\">\\u041f\\u0443\\u0441\\u0442\\u043e<\\/div>\\n    <\\/div>\\n<\\/div>\\n<!--tpl_separator-->\\n<div class=\\"shop-cart\\" data-shopcart=\\"1\\">\\n    <div class=\\"shop-cart-head\\"><a name=\\"shopCart\\"><\\/a><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"full\\">\\n        <form action=\\"[[+this_page_url]]#shopCart\\" method=\\"post\\">\\n        <fieldset>\\n            <div  style=\\"text-align:right;\\">\\n                <a href=\\"[[+empty_url]]\\" id=\\"shk_butEmptyCart\\">\\u041e\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044c \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0443<\\/a>\\n            <\\/div>\\n            <table width=\\"100%\\">\\n                <colgroup>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"40%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"10%\\" \\/>\\n                <\\/colgroup>\\n                <tbody>\\n                    [[+inner]]\\n                <\\/tbody>\\n            <\\/table>\\n            <div  style=\\"text-align:right;\\">\\n                \\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430: [[+delivery_name]] ([[+delivery_price]] [[+currency]])\\n            <\\/div>\\n            <div  style=\\"text-align:right;\\">\\n                \\u041e\\u0431\\u0449\\u0430\\u044f \\u0441\\u0443\\u043c\\u043c\\u0430: <b>[[+price_total]]<\\/b> [[+currency]]\\n            <\\/div>\\n            <noscript>\\n                <div><input type=\\"submit\\" name=\\"shk_recount\\" value=\\"\\u041f\\u0435\\u0440\\u0435\\u0441\\u0447\\u0438\\u0442\\u0430\\u0442\\u044c\\" \\/><\\/div>\\n            <\\/noscript>\\n            <div class=\\"cart-order\\">\\n                <a href=\\"[[+order_page_url]]\\" id=\\"shk_butOrder\\">\\u041e\\u0444\\u043e\\u0440\\u043c\\u0438\\u0442\\u044c \\u0437\\u0430\\u043a\\u0430\\u0437<\\/a>\\n            <\\/div>\\n        <\\/fieldset>\\n        <\\/form>\\n    <\\/div>\\n<\\/div>","locked":0,"properties":null,"static":0,"static_file":"","content":"<div class=\\"shop-cart\\" data-shopcart=\\"1\\">\\n    <div class=\\"shop-cart-head\\"><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"empty\\">\\n        <div class=\\"shop-cart-empty\\">\\u041f\\u0443\\u0441\\u0442\\u043e<\\/div>\\n    <\\/div>\\n<\\/div>\\n<!--tpl_separator-->\\n<div class=\\"shop-cart\\" data-shopcart=\\"1\\">\\n    <div class=\\"shop-cart-head\\"><a name=\\"shopCart\\"><\\/a><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"full\\">\\n        <form action=\\"[[+this_page_url]]#shopCart\\" method=\\"post\\">\\n        <fieldset>\\n            <div  style=\\"text-align:right;\\">\\n                <a href=\\"[[+empty_url]]\\" id=\\"shk_butEmptyCart\\">\\u041e\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044c \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0443<\\/a>\\n            <\\/div>\\n            <table width=\\"100%\\">\\n                <colgroup>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"40%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"10%\\" \\/>\\n                <\\/colgroup>\\n                <tbody>\\n                    [[+inner]]\\n                <\\/tbody>\\n            <\\/table>\\n            <div  style=\\"text-align:right;\\">\\n                \\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430: [[+delivery_name]] ([[+delivery_price]] [[+currency]])\\n            <\\/div>\\n            <div  style=\\"text-align:right;\\">\\n                \\u041e\\u0431\\u0449\\u0430\\u044f \\u0441\\u0443\\u043c\\u043c\\u0430: <b>[[+price_total]]<\\/b> [[+currency]]\\n            <\\/div>\\n            <noscript>\\n                <div><input type=\\"submit\\" name=\\"shk_recount\\" value=\\"\\u041f\\u0435\\u0440\\u0435\\u0441\\u0447\\u0438\\u0442\\u0430\\u0442\\u044c\\" \\/><\\/div>\\n            <\\/noscript>\\n            <div class=\\"cart-order\\">\\n                <a href=\\"[[+order_page_url]]\\" id=\\"shk_butOrder\\">\\u041e\\u0444\\u043e\\u0440\\u043c\\u0438\\u0442\\u044c \\u0437\\u0430\\u043a\\u0430\\u0437<\\/a>\\n            <\\/div>\\n        <\\/fieldset>\\n        <\\/form>\\n    <\\/div>\\n<\\/div>"}',
        'guid' => '2f5ee0c2b9444bc5fba695e83af90edf',
        'native_key' => NULL,
        'signature' => 'e2db7d77f18d320894d8cece5e27dd13',
      ),
      '1b1e21d338a5d881d65e1423b8807295' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopOrderForm","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"[[!shkOptions?\\n&get=`delivery,payments`\\n&post_name=`shk_delivery,payment`\\n&toPlaceholders=`1`\\n&pl_prefix=`shkopt_`\\n&tpl=`select_option`\\n]]\\n\\n<p class=\\"error\\">[[!+fi.error.error_message]]<\\/p>\\n<br \\/>\\n\\n<form method=\\"post\\" action=\\"[[~[[*id]]]]\\" id=\\"shopOrderForm\\">\\n\\n<fieldset>\\n\\n<input type=\\"text\\" name=\\"nospam:blank\\" value=\\"\\" style=\\"display:none;\\" \\/>\\n<input type=\\"hidden\\" name=\\"order\\" value=\\"1\\" \\/>\\n\\n<table cellpadding=\\"3\\">\\n    <tr>\\n        <td>\\u0424.\\u0418.\\u041e.*:<\\/td>\\n        <td>\\n            <input name=\\"fullname\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.fullname]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0410\\u0434\\u0440\\u0435\\u0441*:<\\/td>\\n        <td>\\n              <input name=\\"address\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]\\" \\/>\\n              <div>[[!+fi.error.address]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>E-mail*:<\\/td>\\n        <td>\\n            <input name=\\"email\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.email]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d*:<\\/td>\\n        <td>\\n            <input name=\\"phone\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.phone]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438*:<\\/td>\\n        <td>\\n            <select name=\\"shk_delivery\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_delivery]]\\n            <\\/select>\\n            <div>[[!+fi.error.shk_delivery]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b*:<\\/td>\\n        <td>\\n            <select name=\\"payment\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_payments]]\\n            <\\/select>\\n            <div>[[!+fi.error.payment]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n        <td>\\n            <textarea name=\\"message\\" class=\\"textfield\\" rows=\\"4\\" cols=\\"30\\">[[!+fi.message]]<\\/textarea>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td><\\/td>\\n        <td><input type=\\"submit\\" name=\\"submit_button\\" class=\\"button\\" value=\\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u0438\\u0442\\u044c\\" \\/><\\/td>\\n    <\\/tr>\\n<\\/table>\\n\\n<\\/fieldset>\\n\\n<\\/form>","locked":0,"properties":null,"static":0,"static_file":"","content":"[[!shkOptions?\\n&get=`delivery,payments`\\n&post_name=`shk_delivery,payment`\\n&toPlaceholders=`1`\\n&pl_prefix=`shkopt_`\\n&tpl=`select_option`\\n]]\\n\\n<p class=\\"error\\">[[!+fi.error.error_message]]<\\/p>\\n<br \\/>\\n\\n<form method=\\"post\\" action=\\"[[~[[*id]]]]\\" id=\\"shopOrderForm\\">\\n\\n<fieldset>\\n\\n<input type=\\"text\\" name=\\"nospam:blank\\" value=\\"\\" style=\\"display:none;\\" \\/>\\n<input type=\\"hidden\\" name=\\"order\\" value=\\"1\\" \\/>\\n\\n<table cellpadding=\\"3\\">\\n    <tr>\\n        <td>\\u0424.\\u0418.\\u041e.*:<\\/td>\\n        <td>\\n            <input name=\\"fullname\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.fullname]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0410\\u0434\\u0440\\u0435\\u0441*:<\\/td>\\n        <td>\\n              <input name=\\"address\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]\\" \\/>\\n              <div>[[!+fi.error.address]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>E-mail*:<\\/td>\\n        <td>\\n            <input name=\\"email\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.email]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d*:<\\/td>\\n        <td>\\n            <input name=\\"phone\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.phone]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438*:<\\/td>\\n        <td>\\n            <select name=\\"shk_delivery\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_delivery]]\\n            <\\/select>\\n            <div>[[!+fi.error.shk_delivery]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b*:<\\/td>\\n        <td>\\n            <select name=\\"payment\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_payments]]\\n            <\\/select>\\n            <div>[[!+fi.error.payment]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n        <td>\\n            <textarea name=\\"message\\" class=\\"textfield\\" rows=\\"4\\" cols=\\"30\\">[[!+fi.message]]<\\/textarea>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td><\\/td>\\n        <td><input type=\\"submit\\" name=\\"submit_button\\" class=\\"button\\" value=\\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u0438\\u0442\\u044c\\" \\/><\\/td>\\n    <\\/tr>\\n<\\/table>\\n\\n<\\/fieldset>\\n\\n<\\/form>"}',
        'guid' => 'be75685a982c8d59496928db4c0174db',
        'native_key' => NULL,
        'signature' => 'aae96a963c36fa04202cd13f709aaf7c',
      ),
      'a2cb2dbf02e46d2feb2ec1e012950d0c' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopOrderReport","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:550px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n    \\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0412 \\u0438\\u043d\\u0442\\u0435\\u0440\\u043d\\u0435\\u0442-\\u043c\\u0430\\u0433\\u0430\\u0437\\u0438\\u043d\\u0435 \\u0441\\u0434\\u0435\\u043b\\u0430\\u043d \\u0437\\u0430\\u043a\\u0430\\u0437.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    <b>\\u0421\\u043e\\u0441\\u0442\\u0430\\u0432 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430:<\\/b>\\n    \\n    <table>\\n        [[+orderOutputData]]\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                \\u0418\\u0442\\u043e\\u0433\\u043e:\\n            <\\/td>\\n            <td>\\n                [[+orderPrice]] [[+orderCurrency]]\\n            <\\/td>\\n        <\\/tr>\\n    <\\/table>\\n    \\n    <b>\\u0414\\u0430\\u043d\\u043d\\u044b\\u0435 \\u043f\\u043e\\u043a\\u0443\\u043f\\u0430\\u0442\\u0435\\u043b\\u044f:<\\/b><br \\/>\\n    \\n    <table>\\n        <tr>\\n            <td>\\u0424.\\u0418.\\u041e.:<\\/td>\\n            <td>[[+fullname]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0410\\u0434\\u0440\\u0435\\u0441:<\\/td>\\n            <td>[[+address]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0410\\u0434\\u0440\\u0435\\u0441 \\u044d\\u043b. \\u043f\\u043e\\u0447\\u0442\\u044b:<\\/td>\\n            <td><a href=\\"mailto:[[+email]]\\">[[+email]]<\\/a><\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d:<\\/td>\\n            <td>[[+phone]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438:<\\/td>\\n            <td>[[+shk_delivery]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b:<\\/td>\\n            <td>[[+payment]] <\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n            <td>[[+message]]<\\/td>\\n        <\\/tr>\\n    <\\/table>\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>","locked":0,"properties":null,"static":0,"static_file":"","content":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:550px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n    \\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0412 \\u0438\\u043d\\u0442\\u0435\\u0440\\u043d\\u0435\\u0442-\\u043c\\u0430\\u0433\\u0430\\u0437\\u0438\\u043d\\u0435 \\u0441\\u0434\\u0435\\u043b\\u0430\\u043d \\u0437\\u0430\\u043a\\u0430\\u0437.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    <b>\\u0421\\u043e\\u0441\\u0442\\u0430\\u0432 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430:<\\/b>\\n    \\n    <table>\\n        [[+orderOutputData]]\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                \\u0418\\u0442\\u043e\\u0433\\u043e:\\n            <\\/td>\\n            <td>\\n                [[+orderPrice]] [[+orderCurrency]]\\n            <\\/td>\\n        <\\/tr>\\n    <\\/table>\\n    \\n    <b>\\u0414\\u0430\\u043d\\u043d\\u044b\\u0435 \\u043f\\u043e\\u043a\\u0443\\u043f\\u0430\\u0442\\u0435\\u043b\\u044f:<\\/b><br \\/>\\n    \\n    <table>\\n        <tr>\\n            <td>\\u0424.\\u0418.\\u041e.:<\\/td>\\n            <td>[[+fullname]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0410\\u0434\\u0440\\u0435\\u0441:<\\/td>\\n            <td>[[+address]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0410\\u0434\\u0440\\u0435\\u0441 \\u044d\\u043b. \\u043f\\u043e\\u0447\\u0442\\u044b:<\\/td>\\n            <td><a href=\\"mailto:[[+email]]\\">[[+email]]<\\/a><\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d:<\\/td>\\n            <td>[[+phone]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438:<\\/td>\\n            <td>[[+shk_delivery]]<\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b:<\\/td>\\n            <td>[[+payment]] <\\/td>\\n        <\\/tr>\\n        <tr>\\n            <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n            <td>[[+message]]<\\/td>\\n        <\\/tr>\\n    <\\/table>\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>"}',
        'guid' => '628f11c1459320b1a0c11e7d3a7b91c0',
        'native_key' => NULL,
        'signature' => 'ae31fb821978f3b695b3391e56c1be73',
      ),
      '9ef6c605a467fc77977b61cef615f44e' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"mailContactsRow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<tr>\\n    <td>[[+label]]:<\\/td>\\n    <td>[[+value]]<\\/td>\\n<\\/tr>","locked":0,"properties":null,"static":0,"static_file":"","content":"<tr>\\n    <td>[[+label]]:<\\/td>\\n    <td>[[+value]]<\\/td>\\n<\\/tr>"}',
        'guid' => 'fdbcfc1cad47930affbd823c81ef34f5',
        'native_key' => NULL,
        'signature' => 'a263054a7cbc5cf0fc9f574a6b430d99',
      ),
    ),
    'Snippets' => 
    array (
      '769fd316f5a4baec12d3cb7b94fd9fee' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"Shopkeeper3","description":"Shopping cart","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * Shopkeeper\\n * \\n * Shopping cart for MODx Revolution\\n *\\n * @package shopkeeper3\\n * @category \\t   snippet\\n * @version \\t   3.x\\n * @license \\t   http:\\/\\/www.gnu.org\\/copyleft\\/gpl.html GNU Public License (GPL)\\n * @internal\\t   @properties\\n * @internal\\t   @modx_category Shop\\n *\\/\\n\\nif(isset($hideOn) && preg_match(\'\\/(^|\\\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)\\/\',$hideOn)) return \'\';\\n\\n$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;\\n$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];\\nif( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . \\"components\\/shopkeeper3\\/\\" );\\n\\n$output = \'\';\\n\\nrequire_once $modx->getOption(\'core_path\') . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n\\n$shopCart = new Shopkeeper($modx, $scriptProperties);\\n\\nif( $SHK_callCount === 1 ){\\n    \\n    if( !empty( $scriptProperties[\'style\'] ) ){\\n        $modx->regClientCSS( SHOPKEEPER_URL . \\"web\\/css\\/\\".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . \\"\\/style.css\\" );\\n    }\\n    \\n    if( !$modx->getOption( \'noJavaScript\', $scriptProperties, false ) ){\\n        \\n        if(!$modx->getOption( \'noJQuery\', $scriptProperties, false ) ){\\n            $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/jquery-1.11.1.min.js\\" );\\n        }\\n        \\n        $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/lang\\/\\" . $modx->getOption( \'lang\', $scriptProperties, \'ru\' ) . \\".js?v=\\" . $shopCart->getVersion() );\\n        $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/shopkeeper.js?v=\\" . $shopCart->getVersion() );\\n        \\n        $shk_opts = array(\\n            \'prodCont\' => $modx->getOption( \'prodCont\', $scriptProperties, \'div.shk-item\' ),\\n            \'site_base_url\' => $modx->config[\'base_url\'],\\n            \'counterField\' => $modx->getOption( \'counterField\', $scriptProperties, false ),\\n            \'counterFieldCart\' => $modx->getOption( \'counterFieldCart\', $scriptProperties, true ),\\n            \'changePrice\' => $modx->getOption( \'changePrice\', $scriptProperties, true ),\\n            \'flyToCart\' => $modx->getOption( \'flyToCart\', $scriptProperties, \'helper\' ),\\n            \'noLoader\' => $modx->getOption( \'noLoader\', $scriptProperties, false ),\\n            \'allowFloatCount\' => $modx->getOption( \'allowFloatCount\', $scriptProperties, false ),\\n            \'animCart\' => $modx->getOption( \'animCart\', $scriptProperties, true ),\\n            \'goToOrderFormPage\' => $modx->getOption( \'goToOrderFormPage\', $scriptProperties, false ),\\n            \\/\\/\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),\\n            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\',$scriptProperties,1),\'\',\'\',\'abs\'),\\n            \'debug\' => $modx->getOption( \'debug\', $scriptProperties, false )\\n        );\\n        \\n        if( defined(\'JSON_UNESCAPED_SLASHES\') && defined(\'JSON_FORCE_OBJECT\') ){\\n            $options_obj_str = json_encode( $shk_opts, JSON_FORCE_OBJECT | JSON_UNESCAPED_SLASHES );\\n        }else{\\n            $options_obj_str = json_encode( $shk_opts );\\n        }\\n        \\n        $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n        $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : 0;\\n        \\n        \\/\\/create script\\n        $headHtml = \\"\\\\t<script type=\\\\\\"text\\/javascript\\\\\\">\\";\\n        $headHtml .= \\"\\n        SHK.data = {price_total:\\".Shopkeeper::$price_total.\\",items_total:\\".Shopkeeper::$items_total.\\",items_unique_total:\\".Shopkeeper::$items_unique_total.\\",delivery_price:{$delivery_price},delivery_name:\'{$delivery_name}\',ids:[\\".$shopCart->getProdIds(\'string\').\\"]};\\n        jQuery(document).bind( \'ready\', function(){\\n            SHK.init( \\" . $options_obj_str . \\" );\\n        });\\" . PHP_EOL;\\n        \\n        $headHtml .= \\"\\\\t<\\/script>\\" . PHP_EOL;\\n        \\n        $modx->regClientStartupHTMLBlock( $headHtml );\\n        \\n    }\\n    \\n}\\n\\n\\/\\/\\u0432\\u044b\\u0432\\u043e\\u0434 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u044b\\n$output .= $shopCart->getCartContent();\\n\\nreturn $output;","locked":0,"properties":"a:36:{s:4:\\"lang\\";a:7:{s:4:\\"name\\";s:4:\\"lang\\";s:4:\\"desc\\";s:13:\\"prop_shk.lang\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:2:\\"ru\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"prodCont\\";a:7:{s:4:\\"name\\";s:8:\\"prodCont\\";s:4:\\"desc\\";s:17:\\"prop_shk.prodcont\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:12:\\"div.shk-item\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"tplPath\\";a:7:{s:4:\\"name\\";s:7:\\"tplPath\\";s:4:\\"desc\\";s:16:\\"prop_shk.tplpath\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:47:\\"core\\/components\\/shopkeeper3\\/elements\\/chunks\\/ru\\/\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"cartTpl\\";a:7:{s:4:\\"name\\";s:7:\\"cartTpl\\";s:4:\\"desc\\";s:16:\\"prop_shk.carttpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:18:\\"@FILE shopCart.tpl\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"cartRowTpl\\";a:7:{s:4:\\"name\\";s:10:\\"cartRowTpl\\";s:4:\\"desc\\";s:19:\\"prop_shk.cartrowtpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:21:\\"@FILE shopCartRow.tpl\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"additDataTpl\\";a:7:{s:4:\\"name\\";s:12:\\"additDataTpl\\";s:4:\\"desc\\";s:21:\\"prop_shk.additdatatpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:19:\\"@FILE additData.tpl\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"orderDataTpl\\";a:7:{s:4:\\"name\\";s:12:\\"orderDataTpl\\";s:4:\\"desc\\";s:21:\\"prop_shk.orderdatatpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:19:\\"@FILE orderData.tpl\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"cartHelperTpl\\";a:7:{s:4:\\"name\\";s:13:\\"cartHelperTpl\\";s:4:\\"desc\\";s:21:\\"prop_shk.carthelpetpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"flyToCart\\";a:7:{s:4:\\"name\\";s:9:\\"flyToCart\\";s:4:\\"desc\\";s:18:\\"prop_shk.flytocart\\";s:4:\\"type\\";s:4:\\"list\\";s:7:\\"options\\";a:4:{i:0;a:2:{s:4:\\"text\\";s:6:\\"helper\\";s:5:\\"value\\";s:6:\\"helper\\";}i:1;a:2:{s:4:\\"text\\";s:5:\\"image\\";s:5:\\"value\\";s:5:\\"image\\";}i:2;a:2:{s:4:\\"text\\";s:11:\\"scrollimage\\";s:5:\\"value\\";s:11:\\"scrollimage\\";}i:3;a:2:{s:4:\\"text\\";s:5:\\"nofly\\";s:5:\\"value\\";s:5:\\"nofly\\";}}s:5:\\"value\\";s:6:\\"helper\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"fieldPrice\\";a:7:{s:4:\\"name\\";s:10:\\"fieldPrice\\";s:4:\\"desc\\";s:16:\\"prop_shk.pricetv\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:5:\\"price\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"style\\";a:7:{s:4:\\"name\\";s:5:\\"style\\";s:4:\\"desc\\";s:14:\\"prop_shk.style\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"default\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"currency\\";a:7:{s:4:\\"name\\";s:8:\\"currency\\";s:4:\\"desc\\";s:17:\\"prop_shk.currency\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"\\u0440\\u0443\\u0431.\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"noCounter\\";a:7:{s:4:\\"name\\";s:9:\\"noCounter\\";s:4:\\"desc\\";s:18:\\"prop_shk.nocounter\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"noLoader\\";a:7:{s:4:\\"name\\";s:8:\\"noLoader\\";s:4:\\"desc\\";s:17:\\"prop_shk.noloader\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"orderFormPageId\\";a:7:{s:4:\\"name\\";s:15:\\"orderFormPageId\\";s:4:\\"desc\\";s:22:\\"prop_shk.orderformpage\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:17:\\"goToOrderFormPage\\";a:7:{s:4:\\"name\\";s:17:\\"goToOrderFormPage\\";s:4:\\"desc\\";s:26:\\"prop_shk.gotoorderformpage\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"counterField\\";a:7:{s:4:\\"name\\";s:12:\\"counterField\\";s:4:\\"desc\\";s:21:\\"prop_shk.counterfield\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"counterFieldCart\\";a:7:{s:4:\\"name\\";s:16:\\"counterFieldCart\\";s:4:\\"desc\\";s:25:\\"prop_shk.counterFieldCart\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"excepDigitGroup\\";a:7:{s:4:\\"name\\";s:15:\\"excepDigitGroup\\";s:4:\\"desc\\";s:24:\\"prop_shk.excepdigitgroup\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"changePrice\\";a:7:{s:4:\\"name\\";s:11:\\"changePrice\\";s:4:\\"desc\\";s:20:\\"prop_shk.changeprice\\";s:4:\\"type\\";s:4:\\"list\\";s:7:\\"options\\";a:3:{i:0;a:2:{s:4:\\"text\\";s:3:\\"yes\\";s:5:\\"value\\";s:1:\\"1\\";}i:1;a:2:{s:4:\\"text\\";s:2:\\"no\\";s:5:\\"value\\";s:1:\\"0\\";}i:2;a:2:{s:4:\\"text\\";s:7:\\"replace\\";s:5:\\"value\\";s:7:\\"replace\\";}}s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"animCart\\";a:7:{s:4:\\"name\\";s:8:\\"animCart\\";s:4:\\"desc\\";s:17:\\"prop_shk.animcart\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"allowFloatCount\\";a:7:{s:4:\\"name\\";s:15:\\"allowFloatCount\\";s:4:\\"desc\\";s:24:\\"prop_shk.allowfloatcount\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"noJavaScript\\";a:7:{s:4:\\"name\\";s:12:\\"noJavaScript\\";s:4:\\"desc\\";s:21:\\"prop_shk.nojavascript\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"noJQuery\\";a:7:{s:4:\\"name\\";s:8:\\"noJQuery\\";s:4:\\"desc\\";s:17:\\"prop_shk.nojquery\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"noConflict\\";a:7:{s:4:\\"name\\";s:10:\\"noConflict\\";s:4:\\"desc\\";s:19:\\"prop_shk.noconflict\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:6:\\"hideOn\\";a:7:{s:4:\\"name\\";s:6:\\"hideOn\\";s:4:\\"desc\\";s:15:\\"prop_shk.hideon\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"TVsaveList\\";a:7:{s:4:\\"name\\";s:10:\\"TVsaveList\\";s:4:\\"desc\\";s:19:\\"prop_shk.TVsaveList\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:14:\\"fromParentList\\";a:7:{s:4:\\"name\\";s:14:\\"fromParentList\\";s:4:\\"desc\\";s:23:\\"prop_shk.fromParentList\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"fromParentHeight\\";a:7:{s:4:\\"name\\";s:16:\\"fromParentHeight\\";s:4:\\"desc\\";s:25:\\"prop_shk.fromParentHeight\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"additParamSource\\";a:7:{s:4:\\"name\\";s:16:\\"additParamSource\\";s:4:\\"desc\\";s:25:\\"prop_shk.additParamSource\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"className\\";a:7:{s:4:\\"name\\";s:9:\\"className\\";s:4:\\"desc\\";s:18:\\"prop_shk.className\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:11:\\"modResource\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"packageName\\";a:7:{s:4:\\"name\\";s:11:\\"packageName\\";s:4:\\"desc\\";s:20:\\"prop_shk.packageName\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:19:\\"savePurchasesFields\\";a:7:{s:4:\\"name\\";s:19:\\"savePurchasesFields\\";s:4:\\"desc\\";s:28:\\"prop_shk.savePurchasesFields\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"debug\\";a:7:{s:4:\\"name\\";s:5:\\"debug\\";s:4:\\"desc\\";s:14:\\"prop_shk.debug\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"orderDataRowTpl\\";a:7:{s:4:\\"name\\";s:15:\\"orderDataRowTpl\\";s:4:\\"desc\\";s:24:\\"prop_shk.orderDataRowTpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:12:\\"orderDataRow\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"processParams\\";a:7:{s:4:\\"name\\";s:13:\\"processParams\\";s:4:\\"desc\\";s:22:\\"prop_shk.processParams\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"0\\";s:7:\\"lexicon\\";s:21:\\"shopkeeper:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * Shopkeeper\\n * \\n * Shopping cart for MODx Revolution\\n *\\n * @package shopkeeper3\\n * @category \\t   snippet\\n * @version \\t   3.x\\n * @license \\t   http:\\/\\/www.gnu.org\\/copyleft\\/gpl.html GNU Public License (GPL)\\n * @internal\\t   @properties\\n * @internal\\t   @modx_category Shop\\n *\\/\\n\\nif(isset($hideOn) && preg_match(\'\\/(^|\\\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)\\/\',$hideOn)) return \'\';\\n\\n$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;\\n$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];\\nif( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . \\"components\\/shopkeeper3\\/\\" );\\n\\n$output = \'\';\\n\\nrequire_once $modx->getOption(\'core_path\') . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n\\n$shopCart = new Shopkeeper($modx, $scriptProperties);\\n\\nif( $SHK_callCount === 1 ){\\n    \\n    if( !empty( $scriptProperties[\'style\'] ) ){\\n        $modx->regClientCSS( SHOPKEEPER_URL . \\"web\\/css\\/\\".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . \\"\\/style.css\\" );\\n    }\\n    \\n    if( !$modx->getOption( \'noJavaScript\', $scriptProperties, false ) ){\\n        \\n        if(!$modx->getOption( \'noJQuery\', $scriptProperties, false ) ){\\n            $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/jquery-1.11.1.min.js\\" );\\n        }\\n        \\n        $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/lang\\/\\" . $modx->getOption( \'lang\', $scriptProperties, \'ru\' ) . \\".js?v=\\" . $shopCart->getVersion() );\\n        $modx->regClientStartupScript( SHOPKEEPER_URL . \\"web\\/js\\/shopkeeper.js?v=\\" . $shopCart->getVersion() );\\n        \\n        $shk_opts = array(\\n            \'prodCont\' => $modx->getOption( \'prodCont\', $scriptProperties, \'div.shk-item\' ),\\n            \'site_base_url\' => $modx->config[\'base_url\'],\\n            \'counterField\' => $modx->getOption( \'counterField\', $scriptProperties, false ),\\n            \'counterFieldCart\' => $modx->getOption( \'counterFieldCart\', $scriptProperties, true ),\\n            \'changePrice\' => $modx->getOption( \'changePrice\', $scriptProperties, true ),\\n            \'flyToCart\' => $modx->getOption( \'flyToCart\', $scriptProperties, \'helper\' ),\\n            \'noLoader\' => $modx->getOption( \'noLoader\', $scriptProperties, false ),\\n            \'allowFloatCount\' => $modx->getOption( \'allowFloatCount\', $scriptProperties, false ),\\n            \'animCart\' => $modx->getOption( \'animCart\', $scriptProperties, true ),\\n            \'goToOrderFormPage\' => $modx->getOption( \'goToOrderFormPage\', $scriptProperties, false ),\\n            \\/\\/\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),\\n            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\',$scriptProperties,1),\'\',\'\',\'abs\'),\\n            \'debug\' => $modx->getOption( \'debug\', $scriptProperties, false )\\n        );\\n        \\n        if( defined(\'JSON_UNESCAPED_SLASHES\') && defined(\'JSON_FORCE_OBJECT\') ){\\n            $options_obj_str = json_encode( $shk_opts, JSON_FORCE_OBJECT | JSON_UNESCAPED_SLASHES );\\n        }else{\\n            $options_obj_str = json_encode( $shk_opts );\\n        }\\n        \\n        $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n        $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : 0;\\n        \\n        \\/\\/create script\\n        $headHtml = \\"\\\\t<script type=\\\\\\"text\\/javascript\\\\\\">\\";\\n        $headHtml .= \\"\\n        SHK.data = {price_total:\\".Shopkeeper::$price_total.\\",items_total:\\".Shopkeeper::$items_total.\\",items_unique_total:\\".Shopkeeper::$items_unique_total.\\",delivery_price:{$delivery_price},delivery_name:\'{$delivery_name}\',ids:[\\".$shopCart->getProdIds(\'string\').\\"]};\\n        jQuery(document).bind( \'ready\', function(){\\n            SHK.init( \\" . $options_obj_str . \\" );\\n        });\\" . PHP_EOL;\\n        \\n        $headHtml .= \\"\\\\t<\\/script>\\" . PHP_EOL;\\n        \\n        $modx->regClientStartupHTMLBlock( $headHtml );\\n        \\n    }\\n    \\n}\\n\\n\\/\\/\\u0432\\u044b\\u0432\\u043e\\u0434 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u044b\\n$output .= $shopCart->getCartContent();\\n\\nreturn $output;"}',
        'guid' => '84878b2382b6a1374ad233ad9ed28beb',
        'native_key' => NULL,
        'signature' => '3e1ff4634920e2239b996eb4411f9475',
      ),
      '306b0f1dc89fabb48921019b8209de87' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_fihook","description":"FormIt hook for Shopkeeper","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * FormIt hook for Shopkeeper 3.x\\n *\\/\\n\\n\\/\\/ini_set(\'display_errors\',1);\\n\\/\\/error_reporting(E_ALL);\\n\\n$output = false;\\n\\nif(!defined(\'SHOPKEEPER_PATH\')){\\n    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH.\\"components\\/shopkeeper3\\/\\");\\n}\\n\\n\\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0441\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442\\u0430 Shopkeeper\\n$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );\\n$sys_property_sets = explode( \',\', $sys_property_sets );\\n$propertySetName = trim( current( $sys_property_sets ) );\\n\\n$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));\\n$properties = $snippet->getProperties();\\nif( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){\\n    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );\\n    $propSetProperties = $propSet->getProperties();\\n    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);\\n}\\n\\n$lang = $modx->getOption( \'lang\', $properties, \'ru\' );\\n$modx->getService( \'lexicon\', \'modLexicon\' );\\n$modx->lexicon->load( $lang . \':shopkeeper3:default\' );\\n\\nif( !empty( $_SESSION[\'shk_order\'] ) ){\\n    \\n    require_once SHOPKEEPER_PATH . \\"model\\/shopkeeper.class.php\\";\\n    $shopCart = new Shopkeeper( $modx, $properties );\\n    \\n    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model\\/\' );\\n    \\n    \\/\\/shopkeeper settings\\n    $contacts_fields = array();\\n    $response = $modx->runProcessor(\'getsettings\',\\n        array( \'settings\' => array(\'contacts_fields\') ),\\n        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components\\/shopkeeper3\\/processors\\/mgr\\/\' )\\n    );\\n    if ($response->isError()) {\\n        echo $response->getMessage();\\n    }\\n    if($result = $response->getResponse()){\\n        \\n        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();\\n        if( !empty( $temp_arr ) ){\\n            \\n            foreach( $temp_arr as $opt ){\\n                \\n                $contacts_fields[$opt[\'name\']] = $opt;\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n    $userId = $modx->getLoginUserID( $modx->context->key );\\n    if( !$userId ) $userId = 0;\\n    \\n    \\/\\/\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435\\n    $contacts = array();\\n    $allFormFields = $hook->getValues();\\n    foreach( $allFormFields as $key => $val ){\\n        \\n        if( in_array( $key, array_keys( $contacts_fields ) ) ){\\n            \\n            $temp_arr = array(\\n                \'name\' => $contacts_fields[$key][\'name\'],\\n                \'value\' => $val,\\n                \'label\' => $contacts_fields[$key][\'label\']\\n            );\\n            \\n            array_push( $contacts, $temp_arr );\\n            \\n        }\\n        \\n    }\\n    \\n    $contacts = json_encode( $contacts );\\n    \\n    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );\\n    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );\\n    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );\\n    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );\\n    \\n    \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';\\n    if( !$delivery_name ){\\n\\t$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';\\n    }\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    $order = $modx->newObject(\'shk_order\');\\n    $insert_data = array(\\n        \'contacts\' => $contacts,\\n\\t\'options\' => \'\',\\n\\t\'price\' => Shopkeeper::$price_total,\\n\\t\'currency\' => $shopCart->config[\'currency\'],\\n\\t\'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n\\t\'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n\\t\'note\' => \'\',\\n\\t\'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',\\n\\t\'delivery\' => $delivery_name,\\n\\t\'delivery_price\' => $delivery_price,\\n\\t\'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',\\n\\t\'tracking_num\' => \'\',\\n\\t\'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )\\n    );\\n    if( $userId ){\\n        $insert_data[\'userid\'] = $userId;\\n    }\\n    $order->fromArray($insert_data);\\n    $saved = $order->save();\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0442\\u043e\\u0432\\u0430\\u0440\\u044b \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    if( $saved ){\\n        \\n\\t$purchasesData = $shopCart->getProductsData( true );\\n\\t\\n        foreach( $shopCart->data as $p_data ){\\n            \\n            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';\\n\\t    $fields_data = !empty( $purchasesData[ $p_data[ \'id\' ] ] ) ? $purchasesData[ $p_data[ \'id\' ] ] : array();\\n\\t    $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';\\n\\t    $fields_data_str = json_encode( $fields_data );\\n\\t    \\n            $insert_data = array(\\n                \'p_id\' => $p_data[\'id\'],\\n                \'order_id\' => $order->id,\\n                \'name\' => $p_data[\'name\'],\\n                \'price\' => $p_data[\'price\'],\\n                \'count\' => $p_data[\'count\'],\\n                \'class_name\' => $p_data[\'className\'],\\n                \'package_name\' => $p_data[\'packageName\'],\\n\\t\\t\'data\' => $fields_data_str,\\n                \'options\' => $options\\n            );\\n            \\n            $purchase = $modx->newObject(\'shk_purchases\');\\n            $purchase->fromArray( $insert_data );\\n            $purchase->save();\\n            \\n        }\\n        \\n\\t$shopCart->setOrderDataSession( $order->toArray() );\\n\\t\\n    }\\n    \\n    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );\\n    \\n    $orderData = $shopCart->getOrderData();\\n    \\n    \\/\\/OnSHKsaveOrder\\n    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));\\n    if(is_array($evtOut)) $orderData .= implode(\'\',$evtOut);\\n    \\n    $hook->setValues(array(\\n        \'orderID\' => $order->get(\'id\'),\\n        \'orderDate\' => $order->get(\'date\'),\\n        \'orderPrice\' => $order->get(\'price\'),\\n\\t\'orderCurrency\' => $shopCart->config[\'currency\'],\\n\\t\'orderOutputData\' => $orderData\\n    ));\\n    \\n    $shopCart->request_empty( false );\\n    \\n    $output = true;\\n    \\n}else{\\n    \\n    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );\\n    $output = false;\\n    \\n}\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * FormIt hook for Shopkeeper 3.x\\n *\\/\\n\\n\\/\\/ini_set(\'display_errors\',1);\\n\\/\\/error_reporting(E_ALL);\\n\\n$output = false;\\n\\nif(!defined(\'SHOPKEEPER_PATH\')){\\n    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH.\\"components\\/shopkeeper3\\/\\");\\n}\\n\\n\\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0441\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442\\u0430 Shopkeeper\\n$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );\\n$sys_property_sets = explode( \',\', $sys_property_sets );\\n$propertySetName = trim( current( $sys_property_sets ) );\\n\\n$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));\\n$properties = $snippet->getProperties();\\nif( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){\\n    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );\\n    $propSetProperties = $propSet->getProperties();\\n    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);\\n}\\n\\n$lang = $modx->getOption( \'lang\', $properties, \'ru\' );\\n$modx->getService( \'lexicon\', \'modLexicon\' );\\n$modx->lexicon->load( $lang . \':shopkeeper3:default\' );\\n\\nif( !empty( $_SESSION[\'shk_order\'] ) ){\\n    \\n    require_once SHOPKEEPER_PATH . \\"model\\/shopkeeper.class.php\\";\\n    $shopCart = new Shopkeeper( $modx, $properties );\\n    \\n    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model\\/\' );\\n    \\n    \\/\\/shopkeeper settings\\n    $contacts_fields = array();\\n    $response = $modx->runProcessor(\'getsettings\',\\n        array( \'settings\' => array(\'contacts_fields\') ),\\n        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components\\/shopkeeper3\\/processors\\/mgr\\/\' )\\n    );\\n    if ($response->isError()) {\\n        echo $response->getMessage();\\n    }\\n    if($result = $response->getResponse()){\\n        \\n        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();\\n        if( !empty( $temp_arr ) ){\\n            \\n            foreach( $temp_arr as $opt ){\\n                \\n                $contacts_fields[$opt[\'name\']] = $opt;\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n    $userId = $modx->getLoginUserID( $modx->context->key );\\n    if( !$userId ) $userId = 0;\\n    \\n    \\/\\/\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435\\n    $contacts = array();\\n    $allFormFields = $hook->getValues();\\n    foreach( $allFormFields as $key => $val ){\\n        \\n        if( in_array( $key, array_keys( $contacts_fields ) ) ){\\n            \\n            $temp_arr = array(\\n                \'name\' => $contacts_fields[$key][\'name\'],\\n                \'value\' => $val,\\n                \'label\' => $contacts_fields[$key][\'label\']\\n            );\\n            \\n            array_push( $contacts, $temp_arr );\\n            \\n        }\\n        \\n    }\\n    \\n    $contacts = json_encode( $contacts );\\n    \\n    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );\\n    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );\\n    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );\\n    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );\\n    \\n    \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';\\n    if( !$delivery_name ){\\n\\t$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';\\n    }\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    $order = $modx->newObject(\'shk_order\');\\n    $insert_data = array(\\n        \'contacts\' => $contacts,\\n\\t\'options\' => \'\',\\n\\t\'price\' => Shopkeeper::$price_total,\\n\\t\'currency\' => $shopCart->config[\'currency\'],\\n\\t\'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n\\t\'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n\\t\'note\' => \'\',\\n\\t\'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',\\n\\t\'delivery\' => $delivery_name,\\n\\t\'delivery_price\' => $delivery_price,\\n\\t\'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',\\n\\t\'tracking_num\' => \'\',\\n\\t\'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )\\n    );\\n    if( $userId ){\\n        $insert_data[\'userid\'] = $userId;\\n    }\\n    $order->fromArray($insert_data);\\n    $saved = $order->save();\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0442\\u043e\\u0432\\u0430\\u0440\\u044b \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    if( $saved ){\\n        \\n\\t$purchasesData = $shopCart->getProductsData( true );\\n\\t\\n        foreach( $shopCart->data as $p_data ){\\n            \\n            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';\\n\\t    $fields_data = !empty( $purchasesData[ $p_data[ \'id\' ] ] ) ? $purchasesData[ $p_data[ \'id\' ] ] : array();\\n\\t    $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';\\n\\t    $fields_data_str = json_encode( $fields_data );\\n\\t    \\n            $insert_data = array(\\n                \'p_id\' => $p_data[\'id\'],\\n                \'order_id\' => $order->id,\\n                \'name\' => $p_data[\'name\'],\\n                \'price\' => $p_data[\'price\'],\\n                \'count\' => $p_data[\'count\'],\\n                \'class_name\' => $p_data[\'className\'],\\n                \'package_name\' => $p_data[\'packageName\'],\\n\\t\\t\'data\' => $fields_data_str,\\n                \'options\' => $options\\n            );\\n            \\n            $purchase = $modx->newObject(\'shk_purchases\');\\n            $purchase->fromArray( $insert_data );\\n            $purchase->save();\\n            \\n        }\\n        \\n\\t$shopCart->setOrderDataSession( $order->toArray() );\\n\\t\\n    }\\n    \\n    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );\\n    \\n    $orderData = $shopCart->getOrderData();\\n    \\n    \\/\\/OnSHKsaveOrder\\n    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));\\n    if(is_array($evtOut)) $orderData .= implode(\'\',$evtOut);\\n    \\n    $hook->setValues(array(\\n        \'orderID\' => $order->get(\'id\'),\\n        \'orderDate\' => $order->get(\'date\'),\\n        \'orderPrice\' => $order->get(\'price\'),\\n\\t\'orderCurrency\' => $shopCart->config[\'currency\'],\\n\\t\'orderOutputData\' => $orderData\\n    ));\\n    \\n    $shopCart->request_empty( false );\\n    \\n    $output = true;\\n    \\n}else{\\n    \\n    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );\\n    $output = false;\\n    \\n}\\n\\nreturn $output;"}',
        'guid' => '5b574a078239fa908998754760cf359d',
        'native_key' => NULL,
        'signature' => 'c60ac4d12fecffcf3b922047d0478a41',
      ),
      '14292d0a9e1e3a5c1482207fbe01c3b2' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shkOptions","description":"Print configuration of Shopkeeper","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * shkOptions\\n * \\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u0442 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0438\\u0437 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u0438 Shopkeeper\\n *\\n *\\/\\n\\n$output = array();\\n\\n$get = explode( \',\', $modx->getOption( \'get\', $scriptProperties, \'\' ) );\\n$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );\\n$get = array_map( \'trim\', $get );\\n$post_name = array_map( \'trim\', $post_name );\\n$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );\\n$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );\\n$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );\\n\\nif( empty( $get ) ) return \'\';\\n\\nif( class_exists(\'Shopkeeper\') ){\\n    \\n    $config = Shopkeeper::getConfig( $get );\\n    \\n    \\/\\/echo \'<pre>\' . print_r( $config, true ) . \'<\\/pre>\';\\n    \\n    if( !empty( $config ) ){\\n        \\n        foreach( $get as $index => $opt_name ){\\n            \\n            if( !empty( $config[ $opt_name ] ) ){\\n                \\n                $output[ $opt_name ] = \'\';\\n                \\n                foreach( $config[ $opt_name ] as $key => $conf ){\\n                    \\n                    if( empty( $conf[\'value\'] ) ){\\n                        $conf[\'value\'] = $conf[\'label\'];\\n                    }\\n                    \\n                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected=\\"selected\\"\' : \'\' );\\n                    \\n                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . \\"\\\\t\\";\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\nif( $toPlaceholders ){\\n    \\n    foreach( $output as $pl_name => $out ){\\n        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );\\n    }\\n    \\n    $output = array();\\n    \\n}\\n\\nreturn implode( \'\', $output );","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * shkOptions\\n * \\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u0442 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0438\\u0437 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u0438 Shopkeeper\\n *\\n *\\/\\n\\n$output = array();\\n\\n$get = explode( \',\', $modx->getOption( \'get\', $scriptProperties, \'\' ) );\\n$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );\\n$get = array_map( \'trim\', $get );\\n$post_name = array_map( \'trim\', $post_name );\\n$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );\\n$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );\\n$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );\\n\\nif( empty( $get ) ) return \'\';\\n\\nif( class_exists(\'Shopkeeper\') ){\\n    \\n    $config = Shopkeeper::getConfig( $get );\\n    \\n    \\/\\/echo \'<pre>\' . print_r( $config, true ) . \'<\\/pre>\';\\n    \\n    if( !empty( $config ) ){\\n        \\n        foreach( $get as $index => $opt_name ){\\n            \\n            if( !empty( $config[ $opt_name ] ) ){\\n                \\n                $output[ $opt_name ] = \'\';\\n                \\n                foreach( $config[ $opt_name ] as $key => $conf ){\\n                    \\n                    if( empty( $conf[\'value\'] ) ){\\n                        $conf[\'value\'] = $conf[\'label\'];\\n                    }\\n                    \\n                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected=\\"selected\\"\' : \'\' );\\n                    \\n                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . \\"\\\\t\\";\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\nif( $toPlaceholders ){\\n    \\n    foreach( $output as $pl_name => $out ){\\n        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );\\n    }\\n    \\n    $output = array();\\n    \\n}\\n\\nreturn implode( \'\', $output );"}',
        'guid' => '945c858bc40fe7b6c8f70c8d354032ad',
        'native_key' => NULL,
        'signature' => 'c7fb74c62d4255adaba4ba7d07037d0d',
      ),
      'a2ee1d6a35854ebe349ad7282fea3fbf' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"num_format","description":"Number format output filter","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/*\\n * numFormat snippet\\n * example: [[*price:num_format]]\\n *\\/\\n\\nif(strlen($input)==0) return \'\';\\n\\n$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));\\nreturn number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * numFormat snippet\\n * example: [[*price:num_format]]\\n *\\/\\n\\nif(strlen($input)==0) return \'\';\\n\\n$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));\\nreturn number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');"}',
        'guid' => '4e0cebae2c9cd68fecfce6488445236d',
        'native_key' => NULL,
        'signature' => 'a6203ca44bd74f052a30aec5de71b00c',
      ),
      '36e0312f4e4379a829bc1d65d24e6e92' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_curr_rate","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/*\\n * shk_curr_rate snippet\\n * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]\\n *\\/\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n\\n\\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * shk_curr_rate snippet\\n * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]\\n *\\/\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n\\n\\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );\\n\\nreturn $output;"}',
        'guid' => '836403a86c54c6375f1e457c23fbaa7e',
        'native_key' => NULL,
        'signature' => 'd3a43f74e7e7d9a3048f06065c4ed245',
      ),
      '2b7b079144f06b2cc6f83e1c10d5ce2f' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"param_edit_table","description":"Print options of product (param-edit)","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/\\/***********************************\\n\\/\\/\\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0434\\u043b\\u044f MODx 2.x\\n\\/\\/***********************************\\n\\n\\/*\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`param1`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&tvValue=`[[+tv.param1]]`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`all_width`\\n&postName=`w`\\n&tpl=`@CODE:\\n<select name=\\"w\\">\\n    <option value=\\"\\"><\\/option>\\n    [[+inner]]\\n<\\/select>\\n<!--tpl_separator-->\\n<option value=\\"[[+field1]]\\"[[+selected1]]>[[+field1]]<\\/option>\\n`]]\\n\\n\\u041f\\u0440\\u0438\\u043c\\u0435\\u0440\\u044b \\u0447\\u0430\\u043d\\u043a\\u0430:\\n\\n1.\\n\\n<h1>\\u0417\\u0430\\u0433\\u043e\\u043b\\u043e\\u0432\\u043e\\u043a<\\/h1>\\n[[+inner]]\\n<!--tpl_separator-->\\n<div class=\\"one\\">\\n    <img src=\\"[[+field1]]\\" width=\\"203\\" height=\\"144\\" alt=\\"\\" \\/>\\n    <h3>[[+field2]]<\\/h3>\\n    <p>[[+field3]]<\\/p>\\n<\\/div>\\n\\n2.\\n\\n<table>[[+inner]]<\\/table>\\n<!--tpl_separator-->\\n<tr>\\n    [[+inner]]\\n<\\/tr>\\n<!--tpl_separator-->\\n<td>[[+col_num]]. [[+field]]<\\/td>\\n\\n3.\\n\\n<div class=\\"product-options\\">\\n    [[+inner]]\\n<\\/div>\\n<!--tpl_separator-->\\n<label>\\n    <input type=\\"radio\\" class=\\"shk_param\\" value=\\"[[*idx]]__[[+field2]]\\" name=\\"size__[[+id]]\\" onclick=\\"SHK.additOpt(this)\\" [[+idx:eq=`0`:then=`checked`]] \\/>\\n    [[+field1]]\\n<\\/label>\\n\\n*\\/\\n\\n$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));\\n$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');\\n$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);\\n$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');\\n$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');\\n$postName_arr = explode(\',\',$postName);\\n$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');\\n$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);\\n$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);\\n$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');\\n$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);\\n$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');\\n$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');\\n$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');\\n$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');\\nif(!$tpl) return \'\';\\n$output = \'\';\\n$out_arr = array();\\n\\nif(!function_exists(\'fetchTpl\')){\\nfunction fetchTpl($tpl){\\n    global $modx;\\n    $template = \\"\\";\\n    if(substr($tpl, 0, 6) == \\"@FILE:\\"){\\n      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);\\n        $template = file_get_contents($tpl_file);\\n    }else if(substr($tpl, 0, 6) == \\"@CODE:\\"){\\n        $template = substr($tpl, 6);\\n    }else if($modx->getChunk($tpl) != \\"\\"){\\n        $template = $modx->getChunk($tpl);\\n    }else{\\n        $template = false;\\n    }\\n    return $template;\\n}\\n}\\n\\nif(!$tvValue){\\n    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));\\n    if($tv) $tvValue = $tv->getValue($docId);\\n}\\n$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));\\n$fields = $tvValue ? explode(\'||\',$tvValue) : array();\\nif(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);\\n\\n$row_unique = uniqid();\\n$col_unique = uniqid();\\n\\nif(count($fields)>0 && count($fields) >= $minCount){\\n\\n    foreach($fields as $key => $val){\\n        $row = explode(\'==\',$val);\\n        $rowArr = array();\\n        foreach($row as $k => $v){\\n            if(!empty($v) || !$noEmpty){\\n                \\n                $index = $separateCols ? $k : 0;\\n                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;\\n                \\n                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];\\n                if(isset($_POST[$postName])){\\n                    $selected = $_POST[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }if(isset($_GET[$postName])){\\n                    $selected = $_GET[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }else{\\n                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }\\n                \\n                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;\\n                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';\\n                \\n                if(!empty($rowChunk[2])){\\n                    $colArr = array(\\n                        $placeholderPrefix.\'col_num\' => $k+1,\\n                        $placeholderPrefix.\'field\' => $v,\\n                        $placeholderPrefix.\'idx\' => $key,\\n                        $placeholderPrefix.\'num\' => $key+1\\n                    );\\n                    $chunk = $modx->newObject(\'modChunk\');\\n                    $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$col_unique}\\",\'snippet\'=>$rowChunk[2]));\\n                    $chunk->setCacheable(false);\\n                    \\n                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);\\n                    \\n                }\\n            }\\n        }\\n        unset($k,$v);\\n        \\n        \\/\\/echo \'<pre>\'; print_r($rowArr); echo \'<\\/pre>\'; exit;\\n        \\n        foreach($rowArr as $k => $v){\\n            $chunk = $modx->newObject(\'modChunk\');\\n            $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$row_unique}\\",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));\\n            $chunk->setCacheable(false);\\n            $v[$placeholderPrefix.\'idx\'] = $key;\\n            $v[$placeholderPrefix.\'num\'] = $key+1;\\n            $v[$placeholderPrefix.\'id\'] = $docId;\\n            $temp_out = $chunk->process($v);\\n            if(!$noEmpty || ($temp_out != $rowChunk[1])){\\n                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';\\n                $out_arr[$k] .= $temp_out;\\n            }\\n        }\\n        unset($k,$v);\\n    }\\n    unset($key,$val);\\n    \\n    \\/\\/echo \'<pre>\'; print_r($out_arr); echo \'<\\/pre>\'; exit;\\n    \\n    if(strlen($out_arr[0])>0){\\n        $chunk = $modx->newObject(\'modChunk\');\\n        $chunk->fromArray(array(\'name\'=>\\"@INLINE-\\".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));\\n        $chunk->setCacheable(false);\\n        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));\\n        $output = $out_arr[0];\\n        \\n        \\/\\/\\u0421\\u0442\\u0430\\u0432\\u0438\\u043c \\u043e\\u0442\\u0434\\u0435\\u043b\\u044c\\u043d\\u044b\\u0435 \\u043f\\u043b\\u0435\\u0439\\u0441\\u0445\\u043e\\u043b\\u0434\\u0435\\u0440\\u044b \\u0434\\u043b\\u044f \\u0432\\u0441\\u0435\\u0445 \\u043a\\u043e\\u043b\\u043e\\u043d\\u043e\\u043a \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n        if($separateCols){\\n            array_shift($out_arr);\\n            array_shift($postName_arr);\\n            foreach($out_arr as $key => $val){\\n                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;\\n                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);\\n            }\\n        }\\n        \\n    }\\n\\n}else if($defaultValue && $defaultTpl){\\n    \\n    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));\\n    \\n}\\n\\nif($output && $toPlaceholder){\\n    $modx->setPlaceholder($toPlaceholder, $output);\\n    $output = \'\';\\n}\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/\\/***********************************\\n\\/\\/\\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0434\\u043b\\u044f MODx 2.x\\n\\/\\/***********************************\\n\\n\\/*\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`param1`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&tvValue=`[[+tv.param1]]`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`all_width`\\n&postName=`w`\\n&tpl=`@CODE:\\n<select name=\\"w\\">\\n    <option value=\\"\\"><\\/option>\\n    [[+inner]]\\n<\\/select>\\n<!--tpl_separator-->\\n<option value=\\"[[+field1]]\\"[[+selected1]]>[[+field1]]<\\/option>\\n`]]\\n\\n\\u041f\\u0440\\u0438\\u043c\\u0435\\u0440\\u044b \\u0447\\u0430\\u043d\\u043a\\u0430:\\n\\n1.\\n\\n<h1>\\u0417\\u0430\\u0433\\u043e\\u043b\\u043e\\u0432\\u043e\\u043a<\\/h1>\\n[[+inner]]\\n<!--tpl_separator-->\\n<div class=\\"one\\">\\n    <img src=\\"[[+field1]]\\" width=\\"203\\" height=\\"144\\" alt=\\"\\" \\/>\\n    <h3>[[+field2]]<\\/h3>\\n    <p>[[+field3]]<\\/p>\\n<\\/div>\\n\\n2.\\n\\n<table>[[+inner]]<\\/table>\\n<!--tpl_separator-->\\n<tr>\\n    [[+inner]]\\n<\\/tr>\\n<!--tpl_separator-->\\n<td>[[+col_num]]. [[+field]]<\\/td>\\n\\n3.\\n\\n<div class=\\"product-options\\">\\n    [[+inner]]\\n<\\/div>\\n<!--tpl_separator-->\\n<label>\\n    <input type=\\"radio\\" class=\\"shk_param\\" value=\\"[[*idx]]__[[+field2]]\\" name=\\"size__[[+id]]\\" onclick=\\"SHK.additOpt(this)\\" [[+idx:eq=`0`:then=`checked`]] \\/>\\n    [[+field1]]\\n<\\/label>\\n\\n*\\/\\n\\n$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));\\n$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');\\n$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);\\n$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');\\n$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');\\n$postName_arr = explode(\',\',$postName);\\n$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');\\n$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);\\n$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);\\n$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');\\n$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);\\n$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');\\n$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');\\n$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');\\n$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');\\nif(!$tpl) return \'\';\\n$output = \'\';\\n$out_arr = array();\\n\\nif(!function_exists(\'fetchTpl\')){\\nfunction fetchTpl($tpl){\\n    global $modx;\\n    $template = \\"\\";\\n    if(substr($tpl, 0, 6) == \\"@FILE:\\"){\\n      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);\\n        $template = file_get_contents($tpl_file);\\n    }else if(substr($tpl, 0, 6) == \\"@CODE:\\"){\\n        $template = substr($tpl, 6);\\n    }else if($modx->getChunk($tpl) != \\"\\"){\\n        $template = $modx->getChunk($tpl);\\n    }else{\\n        $template = false;\\n    }\\n    return $template;\\n}\\n}\\n\\nif(!$tvValue){\\n    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));\\n    if($tv) $tvValue = $tv->getValue($docId);\\n}\\n$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));\\n$fields = $tvValue ? explode(\'||\',$tvValue) : array();\\nif(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);\\n\\n$row_unique = uniqid();\\n$col_unique = uniqid();\\n\\nif(count($fields)>0 && count($fields) >= $minCount){\\n\\n    foreach($fields as $key => $val){\\n        $row = explode(\'==\',$val);\\n        $rowArr = array();\\n        foreach($row as $k => $v){\\n            if(!empty($v) || !$noEmpty){\\n                \\n                $index = $separateCols ? $k : 0;\\n                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;\\n                \\n                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];\\n                if(isset($_POST[$postName])){\\n                    $selected = $_POST[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }if(isset($_GET[$postName])){\\n                    $selected = $_GET[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }else{\\n                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }\\n                \\n                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;\\n                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';\\n                \\n                if(!empty($rowChunk[2])){\\n                    $colArr = array(\\n                        $placeholderPrefix.\'col_num\' => $k+1,\\n                        $placeholderPrefix.\'field\' => $v,\\n                        $placeholderPrefix.\'idx\' => $key,\\n                        $placeholderPrefix.\'num\' => $key+1\\n                    );\\n                    $chunk = $modx->newObject(\'modChunk\');\\n                    $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$col_unique}\\",\'snippet\'=>$rowChunk[2]));\\n                    $chunk->setCacheable(false);\\n                    \\n                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);\\n                    \\n                }\\n            }\\n        }\\n        unset($k,$v);\\n        \\n        \\/\\/echo \'<pre>\'; print_r($rowArr); echo \'<\\/pre>\'; exit;\\n        \\n        foreach($rowArr as $k => $v){\\n            $chunk = $modx->newObject(\'modChunk\');\\n            $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$row_unique}\\",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));\\n            $chunk->setCacheable(false);\\n            $v[$placeholderPrefix.\'idx\'] = $key;\\n            $v[$placeholderPrefix.\'num\'] = $key+1;\\n            $v[$placeholderPrefix.\'id\'] = $docId;\\n            $temp_out = $chunk->process($v);\\n            if(!$noEmpty || ($temp_out != $rowChunk[1])){\\n                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';\\n                $out_arr[$k] .= $temp_out;\\n            }\\n        }\\n        unset($k,$v);\\n    }\\n    unset($key,$val);\\n    \\n    \\/\\/echo \'<pre>\'; print_r($out_arr); echo \'<\\/pre>\'; exit;\\n    \\n    if(strlen($out_arr[0])>0){\\n        $chunk = $modx->newObject(\'modChunk\');\\n        $chunk->fromArray(array(\'name\'=>\\"@INLINE-\\".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));\\n        $chunk->setCacheable(false);\\n        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));\\n        $output = $out_arr[0];\\n        \\n        \\/\\/\\u0421\\u0442\\u0430\\u0432\\u0438\\u043c \\u043e\\u0442\\u0434\\u0435\\u043b\\u044c\\u043d\\u044b\\u0435 \\u043f\\u043b\\u0435\\u0439\\u0441\\u0445\\u043e\\u043b\\u0434\\u0435\\u0440\\u044b \\u0434\\u043b\\u044f \\u0432\\u0441\\u0435\\u0445 \\u043a\\u043e\\u043b\\u043e\\u043d\\u043e\\u043a \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n        if($separateCols){\\n            array_shift($out_arr);\\n            array_shift($postName_arr);\\n            foreach($out_arr as $key => $val){\\n                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;\\n                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);\\n            }\\n        }\\n        \\n    }\\n\\n}else if($defaultValue && $defaultTpl){\\n    \\n    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));\\n    \\n}\\n\\nif($output && $toPlaceholder){\\n    $modx->setPlaceholder($toPlaceholder, $output);\\n    $output = \'\';\\n}\\n\\nreturn $output;"}',
        'guid' => 'f6f35e9758a83cbfa9c3dc6c68bfe7b8',
        'native_key' => NULL,
        'signature' => '6eb8e8c1f5b8db770f0677620541bbe1',
      ),
      '1ace04a5ea3bb92c5ed3275cfa870b02' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_sitemap","description":"Create sitemap.xml for catalog","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * snippet shk_sitemap\\n *\\n * @author slaad\\n * \\n *\\/\\n\\n\\/*\\n\\nhttp:\\/\\/modx-shopkeeper.ru\\/forum\\/viewtopic.php?pid=20545#p20545\\n\\nExamples\\n\\n1. Only resources (one or more contexts):\\n\\n[[shk_sitemap?\\n&packageNames=`modResource`\\n&classNames=`modResource`\\n]]\\n\\n2. Resources and shop package (Shopkeeper), two contexts:\\n\\n[[shk_sitemap?\\n&packageNames=`modResource,shop`\\n&classNames=`modResource,ShopContent`\\n&contexts=`web,catalog`\\n]]\\n\\n*\\/\\n\\n$config =  array( \\n    \'packageNames\' => \'modResource,shop\',\\n    \'classNames\' => \'modResource,ShopContent\',\\n    \'contexts\' => \'web,catalog\'\\n);\\n\\n$config = array_merge( $config, $scriptProperties );\\n$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n$config[\'urlSuffix\'] = $contentType->getExtension();\\n$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');\\n\\n$output = \\"<?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"UTF-8\\\\\\"\\n<urlset xmlns=\\\\\\"http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\\\\\\">\\" . PHP_EOL;\\n\\nif(!function_exists(\'getMapQuery\')){\\nfunction getMapQuery($className,$select){\\n    global $modx;\\n        $query = $modx->newQuery($className);\\n        $query->select($select);\\n        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );\\n        if ( $query->prepare() && $query->stmt->execute() ){     \\n            $query_out= array();\\n            \\/\\/$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());\\n            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);\\n            \\n            foreach($query_out as $r){\\n                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();\\n                foreach ($select as $s){\\n                    $resources[$r[\'id\']][$s] = $r[$s];\\n                }\\n            }         \\n        }\\n        return $resources;\\n    }\\n}\\n\\n$packageNames = explode(\',\',$config[\'packageNames\']);\\n$classNames = explode(\',\',$config[\'classNames\']);\\n$contexts = explode(\',\',$config[\'contexts\']);\\n\\nforeach ( $packageNames as $key => $packageName ){\\n    \\n    $parentName = $packageName == \'modResource\' ? \\"parent\\" : \\"resource_id\\";\\n    $select = array(\'id\',\'alias\',\'editedon\',$parentName);\\n    if( $packageName != \'modResource\' ){\\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $packageName . \'\\/model\\/\';\\n        $modx->addPackage($packageName, $modelpath);\\n    }\\n    else{\\n        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );\\n    }\\n    \\n    $resources = getMapQuery($classNames[$key],$select);\\n    \\n    foreach ( $resources as $resource ){\\n        \\n        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];\\n        if ( $resource[$parentName] != 0 ){\\n            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');\\n        }\\n        else{\\n            $url = $modx->getOption(\'site_url\');\\n        }\\n        $url .= $resource[\'alias\'];\\n        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];\\n        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];\\n        $date = strftime( \'%Y-%m-%d\', $editedon );\\n        $output .= \\"\\n        <url>\\n            <loc>{$url}<\\/loc>\\n            <lastmod>{$date}<\\/lastmod>\\n            <priority>0.9<\\/priority>\\n            <changefreq>monthly<\\/changefreq>\\n        <\\/url>\\";\\n    }\\n\\n}\\n\\n$output .= PHP_EOL . \\"<\\/urlset>\\";\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * snippet shk_sitemap\\n *\\n * @author slaad\\n * \\n *\\/\\n\\n\\/*\\n\\nhttp:\\/\\/modx-shopkeeper.ru\\/forum\\/viewtopic.php?pid=20545#p20545\\n\\nExamples\\n\\n1. Only resources (one or more contexts):\\n\\n[[shk_sitemap?\\n&packageNames=`modResource`\\n&classNames=`modResource`\\n]]\\n\\n2. Resources and shop package (Shopkeeper), two contexts:\\n\\n[[shk_sitemap?\\n&packageNames=`modResource,shop`\\n&classNames=`modResource,ShopContent`\\n&contexts=`web,catalog`\\n]]\\n\\n*\\/\\n\\n$config =  array( \\n    \'packageNames\' => \'modResource,shop\',\\n    \'classNames\' => \'modResource,ShopContent\',\\n    \'contexts\' => \'web,catalog\'\\n);\\n\\n$config = array_merge( $config, $scriptProperties );\\n$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n$config[\'urlSuffix\'] = $contentType->getExtension();\\n$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');\\n\\n$output = \\"<?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"UTF-8\\\\\\"\\n<urlset xmlns=\\\\\\"http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\\\\\\">\\" . PHP_EOL;\\n\\nif(!function_exists(\'getMapQuery\')){\\nfunction getMapQuery($className,$select){\\n    global $modx;\\n        $query = $modx->newQuery($className);\\n        $query->select($select);\\n        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );\\n        if ( $query->prepare() && $query->stmt->execute() ){     \\n            $query_out= array();\\n            \\/\\/$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());\\n            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);\\n            \\n            foreach($query_out as $r){\\n                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();\\n                foreach ($select as $s){\\n                    $resources[$r[\'id\']][$s] = $r[$s];\\n                }\\n            }         \\n        }\\n        return $resources;\\n    }\\n}\\n\\n$packageNames = explode(\',\',$config[\'packageNames\']);\\n$classNames = explode(\',\',$config[\'classNames\']);\\n$contexts = explode(\',\',$config[\'contexts\']);\\n\\nforeach ( $packageNames as $key => $packageName ){\\n    \\n    $parentName = $packageName == \'modResource\' ? \\"parent\\" : \\"resource_id\\";\\n    $select = array(\'id\',\'alias\',\'editedon\',$parentName);\\n    if( $packageName != \'modResource\' ){\\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $packageName . \'\\/model\\/\';\\n        $modx->addPackage($packageName, $modelpath);\\n    }\\n    else{\\n        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );\\n    }\\n    \\n    $resources = getMapQuery($classNames[$key],$select);\\n    \\n    foreach ( $resources as $resource ){\\n        \\n        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];\\n        if ( $resource[$parentName] != 0 ){\\n            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');\\n        }\\n        else{\\n            $url = $modx->getOption(\'site_url\');\\n        }\\n        $url .= $resource[\'alias\'];\\n        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];\\n        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];\\n        $date = strftime( \'%Y-%m-%d\', $editedon );\\n        $output .= \\"\\n        <url>\\n            <loc>{$url}<\\/loc>\\n            <lastmod>{$date}<\\/lastmod>\\n            <priority>0.9<\\/priority>\\n            <changefreq>monthly<\\/changefreq>\\n        <\\/url>\\";\\n    }\\n\\n}\\n\\n$output .= PHP_EOL . \\"<\\/urlset>\\";\\n\\nreturn $output;"}',
        'guid' => 'f66c89d213cf10ec431a34432f77b9a3',
        'native_key' => NULL,
        'signature' => '8803276b1af907af02a05f3cb9fa7edc',
      ),
    ),
    'Plugins' => 
    array (
      '7bf1f83e8de7dca19951efc86595109f' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '194c62913f911770894df09ad9da636b' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnHandleRequest","priority":0,"propertyset":0}',
              'guid' => 'aa196424a7a9682c6dbccd36639bae51',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnHandleRequest',
              ),
              'signature' => 'b55977d76f82a1d8408d9c612bba7abe',
            ),
            'cd119008bd7f41356061e4d873e11d4a' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnPageNotFound","priority":0,"propertyset":0}',
              'guid' => '318f2bfbe991f4bc359290ee39b8103a',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnPageNotFound',
              ),
              'signature' => '2b5fe117ddf4d10bec56ba679d1cab9b',
            ),
            '44a4a889c291c0843d511ea5d1d405ee' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebPageComplete","priority":0,"propertyset":0}',
              'guid' => '99273ff3f16f1b57a76b77ec1f834b70',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebPageComplete',
              ),
              'signature' => 'e34d2b7731bb508cd28f1b2be93f5ae9',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_contextSwitch","description":"Switch to catalog context.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n\\n plugin contextSwitch\\n \\n System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete\\n\\n*\\/\\n\\n\\/\\/ini_set( \'display_errors\', 1 );\\n\\/\\/error_reporting(E_ALL);\\n\\nif($modx->context->get(\'key\') == \'mgr\') return \'\';\\n\\n$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');\\/\\/shop\\n$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');\\/\\/ShopContent\\n$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);\\n$debug = $modx->getOption(\'debug\',$scriptProperties,false);\\n$cacheOptions = array(\\n    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),\\n    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),\\n    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),\\n    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),\\n    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),\\n    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)\\n);\\n\\nswitch($modx->event->name){\\n    \\n    case \\"OnHandleRequest\\":\\n        \\n        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');\\n        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');\\n        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);\\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);\\n        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');\\n        $site_start = $modx->getOption(\'site_start\', null, 1);\\n        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'\\/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];\\n        if( strpos( $request_uri, \'\\/\' ) !== false ){\\n            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'\\/\' ) );\\n        }else{\\n            $lang_key = $request_uri;\\n        }\\n        \\n        if( !$context_key ) return \'\';\\n        \\n        if( $modx->config[\'friendly_urls\'] ){\\n            \\n            if( $request_uri ){\\n                \\n                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n                $html_ext = $contentType->getExtension();\\n                \\n                $base_dir_alias = current( explode( \'\\/\', $request_uri ) );\\n                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){\\n                    $base_dir_alias .= $container_suffix;\\n                }\\n                if( !$container_suffix && $html_ext ){\\n                    $base_dir_alias .= $html_ext;\\n                }\\n                \\n                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );\\n                \\n                \\/\\/\\u041f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e \\u043b\\u0438 \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\n                $switch_action = false;\\n                foreach( $context_child_ids as $id ){\\n                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );\\n                    if( $temp_url == $base_dir_alias ){\\n                        $switch_action = true;\\n                        break;\\n                    }\\n                }\\n                \\n                if( $switch_action ){\\n                    $modx->reloadContext( $context_key );\\n                    $modx->switchContext( $context_key );\\n                    $modx->config[\'site_start\'] = $site_start;\\n                    $modx->setPlaceholder( \'context_key\', $context_key );\\n                }\\n                \\n            }\\n            \\n        }else{\\n            \\n            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;\\n            if(!$requestId) return \'\';\\n            $resource = $modx->getObject( \'modResource\', $requestId );\\n            if( $resource && $resource->get(\'context_key\') == $context_key ){\\n                $modx->reloadContext( $context_key );\\n                $modx->switchContext( $context_key );\\n                $modx->config[\'site_start\'] = $site_start;\\n                $modx->setPlaceholder( \'context_key\', $context_key );\\n            }\\n            \\n        }\\n    \\n    break;\\n    case \\"OnPageNotFound\\":\\n        \\n        if(!$prodClassName || $prodClassName==\'modResource\') break;\\n        \\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');\\n        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');\\n        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';\\n        \\n        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n        $html_ext = $contentType->getExtension();\\n        \\n        $parent_url = strpos( $url, \'\\/\' ) !== false ? substr( $url, 0, strrpos( $url, \'\\/\' ) ) . $container_suffix : \'\';\\n        $prod_alias = strpos( $url, \'\\/\' ) !== false ? substr( $url, (strrpos( $url, \'\\/\' )+1) ) : $url;\\n        if($html_ext) $prod_alias = substr( $prod_alias, 0, ( 0 - strlen( $html_ext ) ) );\\n        \\n        $resourceIdentifier = $modx->findResource($parent_url);\\n        if(!$resourceIdentifier) return \'\';\\n        \\n        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );\\n        if( !$resource ) return \'\';\\n        \\n        \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0448\\u0430\\u0431\\u043b\\u043e\\u043d\\u0430\\n        $templateObj = $resource->getOne(\'Template\');\\n        $templateProps = $templateObj->getProperties();\\n        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];\\n        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];\\n        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];\\n        \\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $prodPackageName . \'\\/model\\/\';\\n        $modx->addPackage($prodPackageName, $modelpath);\\n        \\n        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );\\n        \\n        if($product){\\n            \\n            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);\\n            $product->set(\'parent\',$resourceIdentifier);\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$product->get(\'id\');\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            \\/\\/\\u0412\\u044b\\u0442\\u0430\\u0441\\u043a\\u0438\\u0432\\u0430\\u0435\\u043c \\u0438\\u0437 \\u043a\\u044d\\u0448\\u0430\\n            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {\\n                \\n                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);\\n                \\n                if ($modx->resource) {\\n                    \\n                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);\\n                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];\\n                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);\\n                    \\n                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];\\n                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];\\n                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');\\n                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');\\n                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));\\n                    $isForward = $modx->resource->_isForward;\\n                    $modx->resource->setProcessed(true);\\n                    $fromCache = true;\\n                    \\n                    $modx->invokeEvent(\'OnLoadWebPageCache\');\\n                    \\n                }\\n            \\n            \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0432 \\u043a\\u044d\\u0448\\u0435 \\u043d\\u0435\\u0442, \\u0441\\u043e\\u0437\\u0434\\u0430\\u0451\\u043c \\u043d\\u043e\\u0432\\u044b\\u0439 \\u0432\\u0438\\u0440\\u0442\\u0443\\u0430\\u043b\\u044c\\u043d\\u044b\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441 \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            }else{\\n                \\n                $modx->resource = $modx->newObject(\'modResource\');\\n                \\/\\/$modx->resource->set();\\n                \\n                ####################################################\\n                \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f \\u043f\\u043e \\u0442\\u0438\\u043f\\u0430\\u043c \\u0432\\u0432\\u043e\\u0434\\u0430 \\u0441\\u0432\\u044f\\u0437\\u0430\\u043d\\u043d\\u044b\\u0445 TV\\n                $product_fields = $product->toArray();\\n                $field_tv = array();\\n                \\n                $sql = \\"\\n                SELECT `formtabs`\\n                FROM `\\".$modx->config[\'table_prefix\'].\\"migx_configs`\\n                WHERE `name` = \'{$prodPackageName}\'\\n                \\";\\n                $stmt = $modx->prepare($sql);\\n                if ($stmt && $stmt->execute()) {\\n                    $migx_config_formtabs = $stmt->fetchColumn();\\n                    if($migx_config_formtabs){\\n                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);\\n                        foreach($migx_config_formtabs_arr as $formtabs){\\n                            \\n                            if(!empty($formtabs[\'fields\'])){\\n                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];\\n                            }else{\\n                                $temp_fields = array();\\n                            }\\n                            \\n                            foreach($temp_fields as $temp_field){\\n                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];\\n                            }\\n                        }\\n                        \\n                    }\\n                }\\n                $stmt->closeCursor();\\n                \\n                foreach($field_tv as $field_name => $tv_name){\\n                    if(isset($product_fields[$field_name])){\\n                        \\n                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));\\n                        if( is_object($tv_object) ){\\n                            if($tv_object->get(\'display\')==\'default\') continue;\\n                            \\n                            $tv_object->set(\'name\',$field_name);\\n                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));\\n                            $tv_object->set(\'output_properties\',$output_properties);\\n                            $tv_object->set(\'value\',$product_fields[$field_name]);\\n                            \\n                            $value = $product_fields[$field_name];\\n                            $value = $tv_object->prepareOutput($value);\\n                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n                            \\n                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));\\n                            \\n                            $product_fields[$field_name] = $value;\\n                        }\\n                    }\\n                }\\n                ####################################################\\n                \\n                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));\\n                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);\\n                \\n                $modx->resource->set(\'id\',$product->get(\'id\'));\\n                $modx->resource->set(\'cacheable\',false);\\n                $modx->resource->set(\'class_key\',$prodClassName);\\n                $modx->resource->_content = \'\';\\n                $modx->resource->_output = \'\';\\n                $modx->resource->_isForward = true;\\n                \\/\\/$modx->resource->_class = $prodClassName;\\n                \\n                $modx->elementCache = array();\\n                $modx->resourceGenerated = true;\\n                unset($resource);\\n                \\n            }\\n            \\n            unset($product);\\n            \\n            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'<\\/pre>\'; exit; }\\n            \\n            \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u0438 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u043c HTML-\\u043a\\u043e\\u0434 \\u0441\\u0442\\u0440\\u0430\\u043d\\u0438\\u0446\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            $modx->resourceIdentifier = $modx->resource->get(\'id\');\\n            $modx->resourceMethod = \'id\';\\n            \\n            $modx->request->prepareResponse();\\n            \\n        }\\n        \\n    break;\\n\\n    case \\"OnWebPageComplete\\":\\n        \\n        if(!$prodClassName || $prodClassName == \'modResource\') break;\\n        \\n        $results= array();\\n        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {\\n            \\n            if( $modx->resource->class_key != $prodClassName ) break;\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$modx->resource->get(\'id\');\\n            \\n            \\/\\/$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));\\n            \\/\\/$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {\\n                \\n                $results[\'resourceClass\'] = $modx->resource->_class;\\n                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();\\n                $results[\'resource\']= $modx->resource->toArray(\'\', true);\\n                $results[\'resource\'][\'_content\']= $modx->resource->_content;\\n                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;\\n                if ($contentType = $modx->resource->getOne(\'ContentType\')) {\\n                    $results[\'contentType\']= $contentType->toArray(\'\', true);\\n                }\\n                $results[\'resourceGroups\']= array();\\n                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';\\n                $policies = $modx->resource->findPolicy($context);\\n                if (is_array($policies)) {\\n                    $results[\'policyCache\']= $policies;\\n                }\\n                if (!empty($modx->elementCache)) {\\n                    $results[\'elementCache\']= $modx->elementCache;\\n                }\\n                if (!empty($modx->sourceCache)) {\\n                    $results[\'sourceCache\']= $modx->sourceCache;\\n                }\\n                if (!empty($modx->resource->_sjscripts)) {\\n                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;\\n                }\\n                if (!empty($modx->resource->_jscripts)) {\\n                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;\\n                }\\n                if (!empty($modx->resource->_loadedjscripts)) {\\n                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;\\n                }\\n                \\n                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));\\n                \\n                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {\\n                    $modx->log( modX::LOG_LEVEL_ERROR, \\"[contextSwitch] Could not cache resource \\" . $modx->resource->get(\'id\') );\\n                }\\n                \\n            }\\n            \\n            unset($cachedResource);\\n            \\n        }\\n        \\n    break;\\n\\n}\\n\\nreturn \'\';","locked":0,"properties":"a:8:{s:19:\\"context_param_alias\\";a:7:{s:4:\\"name\\";s:19:\\"context_param_alias\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"c\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:16:\\"request_param_id\\";a:7:{s:4:\\"name\\";s:16:\\"request_param_id\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:2:\\"id\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:10:\\"catalog_id\\";a:7:{s:4:\\"name\\";s:10:\\"catalog_id\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"0\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:11:\\"context_key\\";a:7:{s:4:\\"name\\";s:11:\\"context_key\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"catalog\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:10:\\"site_start\\";a:7:{s:4:\\"name\\";s:10:\\"site_start\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:15:\\"prodPackageName\\";a:7:{s:4:\\"name\\";s:15:\\"prodPackageName\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:13:\\"prodClassName\\";a:7:{s:4:\\"name\\";s:13:\\"prodClassName\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:14:\\"prodTemplateId\\";a:7:{s:4:\\"name\\";s:14:\\"prodTemplateId\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}}","disabled":0,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n\\n plugin contextSwitch\\n \\n System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete\\n\\n*\\/\\n\\n\\/\\/ini_set( \'display_errors\', 1 );\\n\\/\\/error_reporting(E_ALL);\\n\\nif($modx->context->get(\'key\') == \'mgr\') return \'\';\\n\\n$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');\\/\\/shop\\n$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');\\/\\/ShopContent\\n$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);\\n$debug = $modx->getOption(\'debug\',$scriptProperties,false);\\n$cacheOptions = array(\\n    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),\\n    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),\\n    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),\\n    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),\\n    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),\\n    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)\\n);\\n\\nswitch($modx->event->name){\\n    \\n    case \\"OnHandleRequest\\":\\n        \\n        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');\\n        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');\\n        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);\\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);\\n        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');\\n        $site_start = $modx->getOption(\'site_start\', null, 1);\\n        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'\\/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];\\n        if( strpos( $request_uri, \'\\/\' ) !== false ){\\n            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'\\/\' ) );\\n        }else{\\n            $lang_key = $request_uri;\\n        }\\n        \\n        if( !$context_key ) return \'\';\\n        \\n        if( $modx->config[\'friendly_urls\'] ){\\n            \\n            if( $request_uri ){\\n                \\n                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n                $html_ext = $contentType->getExtension();\\n                \\n                $base_dir_alias = current( explode( \'\\/\', $request_uri ) );\\n                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){\\n                    $base_dir_alias .= $container_suffix;\\n                }\\n                if( !$container_suffix && $html_ext ){\\n                    $base_dir_alias .= $html_ext;\\n                }\\n                \\n                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );\\n                \\n                \\/\\/\\u041f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e \\u043b\\u0438 \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\n                $switch_action = false;\\n                foreach( $context_child_ids as $id ){\\n                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );\\n                    if( $temp_url == $base_dir_alias ){\\n                        $switch_action = true;\\n                        break;\\n                    }\\n                }\\n                \\n                if( $switch_action ){\\n                    $modx->reloadContext( $context_key );\\n                    $modx->switchContext( $context_key );\\n                    $modx->config[\'site_start\'] = $site_start;\\n                    $modx->setPlaceholder( \'context_key\', $context_key );\\n                }\\n                \\n            }\\n            \\n        }else{\\n            \\n            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;\\n            if(!$requestId) return \'\';\\n            $resource = $modx->getObject( \'modResource\', $requestId );\\n            if( $resource && $resource->get(\'context_key\') == $context_key ){\\n                $modx->reloadContext( $context_key );\\n                $modx->switchContext( $context_key );\\n                $modx->config[\'site_start\'] = $site_start;\\n                $modx->setPlaceholder( \'context_key\', $context_key );\\n            }\\n            \\n        }\\n    \\n    break;\\n    case \\"OnPageNotFound\\":\\n        \\n        if(!$prodClassName || $prodClassName==\'modResource\') break;\\n        \\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');\\n        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');\\n        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';\\n        \\n        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n        $html_ext = $contentType->getExtension();\\n        \\n        $parent_url = strpos( $url, \'\\/\' ) !== false ? substr( $url, 0, strrpos( $url, \'\\/\' ) ) . $container_suffix : \'\';\\n        $prod_alias = strpos( $url, \'\\/\' ) !== false ? substr( $url, (strrpos( $url, \'\\/\' )+1) ) : $url;\\n        if($html_ext) $prod_alias = substr( $prod_alias, 0, ( 0 - strlen( $html_ext ) ) );\\n        \\n        $resourceIdentifier = $modx->findResource($parent_url);\\n        if(!$resourceIdentifier) return \'\';\\n        \\n        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );\\n        if( !$resource ) return \'\';\\n        \\n        \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0448\\u0430\\u0431\\u043b\\u043e\\u043d\\u0430\\n        $templateObj = $resource->getOne(\'Template\');\\n        $templateProps = $templateObj->getProperties();\\n        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];\\n        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];\\n        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];\\n        \\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $prodPackageName . \'\\/model\\/\';\\n        $modx->addPackage($prodPackageName, $modelpath);\\n        \\n        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );\\n        \\n        if($product){\\n            \\n            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);\\n            $product->set(\'parent\',$resourceIdentifier);\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$product->get(\'id\');\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            \\/\\/\\u0412\\u044b\\u0442\\u0430\\u0441\\u043a\\u0438\\u0432\\u0430\\u0435\\u043c \\u0438\\u0437 \\u043a\\u044d\\u0448\\u0430\\n            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {\\n                \\n                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);\\n                \\n                if ($modx->resource) {\\n                    \\n                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);\\n                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];\\n                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);\\n                    \\n                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];\\n                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];\\n                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');\\n                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');\\n                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));\\n                    $isForward = $modx->resource->_isForward;\\n                    $modx->resource->setProcessed(true);\\n                    $fromCache = true;\\n                    \\n                    $modx->invokeEvent(\'OnLoadWebPageCache\');\\n                    \\n                }\\n            \\n            \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0432 \\u043a\\u044d\\u0448\\u0435 \\u043d\\u0435\\u0442, \\u0441\\u043e\\u0437\\u0434\\u0430\\u0451\\u043c \\u043d\\u043e\\u0432\\u044b\\u0439 \\u0432\\u0438\\u0440\\u0442\\u0443\\u0430\\u043b\\u044c\\u043d\\u044b\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441 \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            }else{\\n                \\n                $modx->resource = $modx->newObject(\'modResource\');\\n                \\/\\/$modx->resource->set();\\n                \\n                ####################################################\\n                \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f \\u043f\\u043e \\u0442\\u0438\\u043f\\u0430\\u043c \\u0432\\u0432\\u043e\\u0434\\u0430 \\u0441\\u0432\\u044f\\u0437\\u0430\\u043d\\u043d\\u044b\\u0445 TV\\n                $product_fields = $product->toArray();\\n                $field_tv = array();\\n                \\n                $sql = \\"\\n                SELECT `formtabs`\\n                FROM `\\".$modx->config[\'table_prefix\'].\\"migx_configs`\\n                WHERE `name` = \'{$prodPackageName}\'\\n                \\";\\n                $stmt = $modx->prepare($sql);\\n                if ($stmt && $stmt->execute()) {\\n                    $migx_config_formtabs = $stmt->fetchColumn();\\n                    if($migx_config_formtabs){\\n                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);\\n                        foreach($migx_config_formtabs_arr as $formtabs){\\n                            \\n                            if(!empty($formtabs[\'fields\'])){\\n                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];\\n                            }else{\\n                                $temp_fields = array();\\n                            }\\n                            \\n                            foreach($temp_fields as $temp_field){\\n                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];\\n                            }\\n                        }\\n                        \\n                    }\\n                }\\n                $stmt->closeCursor();\\n                \\n                foreach($field_tv as $field_name => $tv_name){\\n                    if(isset($product_fields[$field_name])){\\n                        \\n                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));\\n                        if( is_object($tv_object) ){\\n                            if($tv_object->get(\'display\')==\'default\') continue;\\n                            \\n                            $tv_object->set(\'name\',$field_name);\\n                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));\\n                            $tv_object->set(\'output_properties\',$output_properties);\\n                            $tv_object->set(\'value\',$product_fields[$field_name]);\\n                            \\n                            $value = $product_fields[$field_name];\\n                            $value = $tv_object->prepareOutput($value);\\n                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n                            \\n                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));\\n                            \\n                            $product_fields[$field_name] = $value;\\n                        }\\n                    }\\n                }\\n                ####################################################\\n                \\n                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));\\n                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);\\n                \\n                $modx->resource->set(\'id\',$product->get(\'id\'));\\n                $modx->resource->set(\'cacheable\',false);\\n                $modx->resource->set(\'class_key\',$prodClassName);\\n                $modx->resource->_content = \'\';\\n                $modx->resource->_output = \'\';\\n                $modx->resource->_isForward = true;\\n                \\/\\/$modx->resource->_class = $prodClassName;\\n                \\n                $modx->elementCache = array();\\n                $modx->resourceGenerated = true;\\n                unset($resource);\\n                \\n            }\\n            \\n            unset($product);\\n            \\n            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'<\\/pre>\'; exit; }\\n            \\n            \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u0438 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u043c HTML-\\u043a\\u043e\\u0434 \\u0441\\u0442\\u0440\\u0430\\u043d\\u0438\\u0446\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            $modx->resourceIdentifier = $modx->resource->get(\'id\');\\n            $modx->resourceMethod = \'id\';\\n            \\n            $modx->request->prepareResponse();\\n            \\n        }\\n        \\n    break;\\n\\n    case \\"OnWebPageComplete\\":\\n        \\n        if(!$prodClassName || $prodClassName == \'modResource\') break;\\n        \\n        $results= array();\\n        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {\\n            \\n            if( $modx->resource->class_key != $prodClassName ) break;\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$modx->resource->get(\'id\');\\n            \\n            \\/\\/$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));\\n            \\/\\/$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {\\n                \\n                $results[\'resourceClass\'] = $modx->resource->_class;\\n                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();\\n                $results[\'resource\']= $modx->resource->toArray(\'\', true);\\n                $results[\'resource\'][\'_content\']= $modx->resource->_content;\\n                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;\\n                if ($contentType = $modx->resource->getOne(\'ContentType\')) {\\n                    $results[\'contentType\']= $contentType->toArray(\'\', true);\\n                }\\n                $results[\'resourceGroups\']= array();\\n                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';\\n                $policies = $modx->resource->findPolicy($context);\\n                if (is_array($policies)) {\\n                    $results[\'policyCache\']= $policies;\\n                }\\n                if (!empty($modx->elementCache)) {\\n                    $results[\'elementCache\']= $modx->elementCache;\\n                }\\n                if (!empty($modx->sourceCache)) {\\n                    $results[\'sourceCache\']= $modx->sourceCache;\\n                }\\n                if (!empty($modx->resource->_sjscripts)) {\\n                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;\\n                }\\n                if (!empty($modx->resource->_jscripts)) {\\n                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;\\n                }\\n                if (!empty($modx->resource->_loadedjscripts)) {\\n                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;\\n                }\\n                \\n                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));\\n                \\n                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {\\n                    $modx->log( modX::LOG_LEVEL_ERROR, \\"[contextSwitch] Could not cache resource \\" . $modx->resource->get(\'id\') );\\n                }\\n                \\n            }\\n            \\n            unset($cachedResource);\\n            \\n        }\\n        \\n    break;\\n\\n}\\n\\nreturn \'\';"}',
        'guid' => 'd91843901473d719e0935f5083815fe4',
        'native_key' => 1,
        'signature' => 'f48de376e3c9e64d9dfe8eed8af0a6c9',
      ),
      '8734175b1a5183994c27cf9b244d121d' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            'c50c25ad07929e7c08e9ab36d25fdc91' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKChangeStatus","priority":0,"propertyset":0}',
              'guid' => 'afb4b5bafeef320a294c0b65dfbf3c95',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKChangeStatus',
              ),
              'signature' => '8b2adac89abe85ed5080bafccbe580d0',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_updateInventory","description":"Update inventory data.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n * shk_updateInventory\\n * \\n * \\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043d\\u043e\\u0432\\u043b\\u044f\\u0435\\u0442 \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430 \\u043d\\u0430 \\u0441\\u043a\\u043b\\u0430\\u0434\\u0435 \\u043f\\u0440\\u0438 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434\\u0435 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430 \\u0432 \\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u043b\\u0435\\u043d\\" (\\u0438\\u043b\\u0438 \\u0434\\u0440.)\\n * \\n * OnSHKChangeStatus\\n *\\/\\n\\n$eventName = $modx->event->name;\\n\\n$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );\\n$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );\\n$context = $modx->getOption( \'context\', $scriptProperties, \'\' );\\n$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );\\nif( !is_array( $order_ids ) ){\\n    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();\\n}\\n$status = $modx->getOption( \'status\', $scriptProperties, \'\' );\\n\\nif( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';\\n\\n$modelpath = $modx->getOption(\'core_path\') . \'components\\/shopkeeper3\\/model\\/\';\\n$modx->addPackage( \'shopkeeper3\', $modelpath );\\n\\nforeach( $order_ids as $order_id ){\\n    \\n    $query = $modx->newQuery( \'shk_purchases\' );\\n    $query->where( array( \'order_id\' => $order_id ) );\\n    $purchases = $modx->getIterator( \'shk_purchases\', $query );\\n    \\n    if( $purchases ){\\n        \\n        foreach( $purchases as $purchase ){\\n            \\n            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){\\n                $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $purchase->package_name . \'\\/model\\/\';\\n                $modx->addPackage( $purchase->package_name, $modelpath );\\n            }\\n            \\n            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );\\n            if( $product ){\\n                \\n                $p_data = $product->toArray();\\n                \\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u044d\\u0442\\u043e \\u043f\\u043e\\u043b\\u0435 \\u043e\\u0441\\u043d\\u043e\\u0432\\u043d\\u043e\\u0439 \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n                if( isset( $p_data[ $inventory_fieldname ] ) ){\\n                    \\n                    $current_inventory = $p_data[ $inventory_fieldname ];\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    $product->set( $inventory_fieldname, $new_inventory );\\n                    $product->save();\\n                    \\n                }\\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0437\\u043d\\u0430\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0445\\u0440\\u0430\\u043d\\u0438\\u0442\\u0441\\u044f \\u0432 TV \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0435\\n                else{\\n                    \\n                    $table_name = \'\';\\n                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {\\n                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';\\n                    }\\n                    if( $table_name != \'site_content\' ) continue;\\n                    \\n                    $context = $p_data[\'context_key\'];\\n                    \\n                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));\\n                    if( !$tv ) continue;\\n                    \\n                    $current_inventory = $tv->getValue( $p_data[\'id\'] );\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    \\/\\/$tv->setValue( $p_data[\'id\'], $new_inventory );\\n                    \\n                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(\\n                        \'tmplvarid\' => $tv->get(\'id\'),\\n                        \'contentid\' => $p_data[\'id\'],\\n                    ),true);\\n                    \\n                    if( $templateVarResource ){\\n                        $templateVarResource->set( \'value\', $new_inventory );\\n                        $templateVarResource->save();\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\n\\n\\/\\/\\u041e\\u0447\\u0438\\u0441\\u0442\\u043a\\u0430 \\u043a\\u044d\\u0448\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0430\\nif( $context ){\\n    $modx->cacheManager->refresh(array(\\n        \'resource\' => array( \'contexts\' => array( $context ) ),\\n    ));\\n}\\n\\nreturn \'\';","locked":0,"properties":"a:3:{s:13:\\"plugin_status\\";a:7:{s:4:\\"name\\";s:13:\\"plugin_status\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"2\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:19:\\"inventory_fieldname\\";a:7:{s:4:\\"name\\";s:19:\\"inventory_fieldname\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:9:\\"inventory\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:7:\\"context\\";a:7:{s:4:\\"name\\";s:7:\\"context\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:3:\\"web\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}}","disabled":1,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * shk_updateInventory\\n * \\n * \\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043d\\u043e\\u0432\\u043b\\u044f\\u0435\\u0442 \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430 \\u043d\\u0430 \\u0441\\u043a\\u043b\\u0430\\u0434\\u0435 \\u043f\\u0440\\u0438 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434\\u0435 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430 \\u0432 \\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u043b\\u0435\\u043d\\" (\\u0438\\u043b\\u0438 \\u0434\\u0440.)\\n * \\n * OnSHKChangeStatus\\n *\\/\\n\\n$eventName = $modx->event->name;\\n\\n$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );\\n$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );\\n$context = $modx->getOption( \'context\', $scriptProperties, \'\' );\\n$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );\\nif( !is_array( $order_ids ) ){\\n    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();\\n}\\n$status = $modx->getOption( \'status\', $scriptProperties, \'\' );\\n\\nif( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';\\n\\n$modelpath = $modx->getOption(\'core_path\') . \'components\\/shopkeeper3\\/model\\/\';\\n$modx->addPackage( \'shopkeeper3\', $modelpath );\\n\\nforeach( $order_ids as $order_id ){\\n    \\n    $query = $modx->newQuery( \'shk_purchases\' );\\n    $query->where( array( \'order_id\' => $order_id ) );\\n    $purchases = $modx->getIterator( \'shk_purchases\', $query );\\n    \\n    if( $purchases ){\\n        \\n        foreach( $purchases as $purchase ){\\n            \\n            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){\\n                $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $purchase->package_name . \'\\/model\\/\';\\n                $modx->addPackage( $purchase->package_name, $modelpath );\\n            }\\n            \\n            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );\\n            if( $product ){\\n                \\n                $p_data = $product->toArray();\\n                \\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u044d\\u0442\\u043e \\u043f\\u043e\\u043b\\u0435 \\u043e\\u0441\\u043d\\u043e\\u0432\\u043d\\u043e\\u0439 \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n                if( isset( $p_data[ $inventory_fieldname ] ) ){\\n                    \\n                    $current_inventory = $p_data[ $inventory_fieldname ];\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    $product->set( $inventory_fieldname, $new_inventory );\\n                    $product->save();\\n                    \\n                }\\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0437\\u043d\\u0430\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0445\\u0440\\u0430\\u043d\\u0438\\u0442\\u0441\\u044f \\u0432 TV \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0435\\n                else{\\n                    \\n                    $table_name = \'\';\\n                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {\\n                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';\\n                    }\\n                    if( $table_name != \'site_content\' ) continue;\\n                    \\n                    $context = $p_data[\'context_key\'];\\n                    \\n                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));\\n                    if( !$tv ) continue;\\n                    \\n                    $current_inventory = $tv->getValue( $p_data[\'id\'] );\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    \\/\\/$tv->setValue( $p_data[\'id\'], $new_inventory );\\n                    \\n                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(\\n                        \'tmplvarid\' => $tv->get(\'id\'),\\n                        \'contentid\' => $p_data[\'id\'],\\n                    ),true);\\n                    \\n                    if( $templateVarResource ){\\n                        $templateVarResource->set( \'value\', $new_inventory );\\n                        $templateVarResource->save();\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\n\\n\\/\\/\\u041e\\u0447\\u0438\\u0441\\u0442\\u043a\\u0430 \\u043a\\u044d\\u0448\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0430\\nif( $context ){\\n    $modx->cacheManager->refresh(array(\\n        \'resource\' => array( \'contexts\' => array( $context ) ),\\n    ));\\n}\\n\\nreturn \'\';"}',
        'guid' => '868905a7f5ab4169ced21d631c46e81d',
        'native_key' => 1,
        'signature' => '4e764e635aa5a2db9bf0570e645b069b',
      ),
      '16082ba8121ab93227287c0bd4bc9eb2' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '0fb7934ab0e168cf358ce60c3f42f283' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVInputRenderList","priority":0,"propertyset":0}',
              'guid' => 'e83a374de7e5c38ea31eef5cc108f12c',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVInputRenderList',
              ),
              'signature' => '3da40c3a4ef40e6163fb94b027319fa6',
            ),
            'efb3c919c454298cea717a3a90236a37' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVInputPropertiesList","priority":0,"propertyset":0}',
              'guid' => '6d7795b32166bb9fab26dd676eacf6a8',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVInputPropertiesList',
              ),
              'signature' => '2b992c4de7c2273a7d3c7b2211274bc4',
            ),
            'c82e4c5d84ab20df595e7029e192cdf8' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVOutputRenderList","priority":0,"propertyset":0}',
              'guid' => '074bb1310693477a4af48d3a870d80f6',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVOutputRenderList',
              ),
              'signature' => '6c0444b1008f4b913a44e60ddd976749',
            ),
            'bc4431bff1f302426219f98abfaaf212' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVOutputRenderPropertiesList","priority":0,"propertyset":0}',
              'guid' => 'b5331d6a112fdf52ea9c7dc18fefdbeb',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVOutputRenderPropertiesList',
              ),
              'signature' => 'd5766a71b1230bebdd5f9ecd42089d3b',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_tv_input_output","description":"Print Shopkeeper`s input and output types for TV.","editor_type":0,"category":0,"cache_type":0,"plugincode":"$corePath = MODX_CORE_PATH.\'components\\/shopkeeper3\\/\';\\n\\nswitch ($modx->event->name) {\\n    \\/\\/tv input\\n    case \'OnTVInputRenderList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/shk_mgr.js\');\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/widgets\\/shk.grid.js\');\\n        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/css\\/mgr.css\');\\n        $modx->event->output($corePath.\'elements\\/tv\\/input\\/\');\\n    break;\\n    case \'OnTVInputPropertiesList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->event->output($corePath.\'elements\\/tv\\/inputproperties\\/\');\\n    break;\\n    \\/\\/tv output\\n    case \'OnTVOutputRenderList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/output\\/\');\\n    break;\\n    case \'OnTVOutputRenderPropertiesList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/outputproperties\\/\');\\n    break;\\n}\\n\\nreturn;","locked":0,"properties":null,"disabled":0,"moduleguid":"","static":0,"static_file":"","content":"$corePath = MODX_CORE_PATH.\'components\\/shopkeeper3\\/\';\\n\\nswitch ($modx->event->name) {\\n    \\/\\/tv input\\n    case \'OnTVInputRenderList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/shk_mgr.js\');\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/widgets\\/shk.grid.js\');\\n        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/css\\/mgr.css\');\\n        $modx->event->output($corePath.\'elements\\/tv\\/input\\/\');\\n    break;\\n    case \'OnTVInputPropertiesList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->event->output($corePath.\'elements\\/tv\\/inputproperties\\/\');\\n    break;\\n    \\/\\/tv output\\n    case \'OnTVOutputRenderList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/output\\/\');\\n    break;\\n    case \'OnTVOutputRenderPropertiesList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/outputproperties\\/\');\\n    break;\\n}\\n\\nreturn;"}',
        'guid' => 'ea3cb869261a479ba8d80a39a97e0761',
        'native_key' => 1,
        'signature' => '2840fa153be7675383d6164ebec83ebc',
      ),
      '7b57e1504fe67ddcd2828063d9b3079b' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '3bb8d1569221e9abf1cb202ad150516f' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnLoadWebDocument","priority":0,"propertyset":0}',
              'guid' => '1da930ea48d641482c0a40d1a14288fc',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnLoadWebDocument',
              ),
              'signature' => 'dd54dc39084598dc53063ae7d3d70e7a',
            ),
            'a24bc25d9243b5ba3b2db6144dc3635b' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetProductPrice","priority":0,"propertyset":0}',
              'guid' => '6e894b6a1680a7e079fa0bc3a643f59a',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetProductPrice',
              ),
              'signature' => 'ba3fc6865137cd75bfb61f651c2a71aa',
            ),
            'a2fd2736551ae4c25d36dffce6fc24dd' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetProductAdditParamPrice","priority":0,"propertyset":0}',
              'guid' => '5aee2db2ccbccba03f620b4fbc3094fe',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetProductAdditParamPrice',
              ),
              'signature' => 'b772595b495926b337d73992dff4a81d',
            ),
            'aa305288c44fe5a6ba52732990238519' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetDeliveryPrice","priority":0,"propertyset":0}',
              'guid' => '6a369334b89cebbbc68ec42a59f46d9a',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetDeliveryPrice',
              ),
              'signature' => '0fd5b00266831dd4a9f8bec4bc24eda2',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_multicurrency","description":"Multicurrency in store.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n plugin shk_multicurrency\\n System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice\\n\\n<div>\\n    \\u0412\\u0430\\u043b\\u044e\\u0442\\u0430:\\n    <select id=\\"site_currency\\" name=\\"curency\\">\\n        <option value=\\"1\\">\\u0440\\u0443\\u0431.<\\/option>\\n        <option value=\\"2\\">\\u0433\\u0440\\u043d.<\\/option>\\n        <option value=\\"3\\">USD<\\/option>\\n        <option value=\\"4\\">euro<\\/option>\\n    <\\/select>\\n<\\/div>\\n\\n*\\/\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\nswitch($modx->event->name){\\n    \\n    case \'OnLoadWebDocument\':\\n        \\n        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';\\n        \\n        if(empty($scriptProperties[\'noScript\'])){\\n            \\n            $script_str = \'\\n            <script type=\\"text\\/javascript\\">\\n                var shk_cindex = document.cookie.indexOf(\\"shk_currency=\\") > -1 ? document.cookie.indexOf(\\"shk_currency=\\") + new String(\\"shk_currency=\\").length : -1;\\n                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;\\n                jQuery(\\"#site_currency\\")\\n                .val(shk_currency)\\n                .bind(\\"change\\",function(){\\n                    var loc_href = window.location.pathname+document.location.search;\\n                    window.location.href = loc_href+(loc_href.indexOf(\\"?\\") > -1 ? \\"&\\" : \\"?\\") + \\"scurr=\\" + this.value;\\n                });\\n            <\\/script>\\n            \';\\n            $modx->regClientScript( $script_str, true );\\n        }\\n        \\n        if( isset( $_GET[\'scurr\'] ) ){\\n            \\n            if( $currency_id != $shk_currency ){\\n                \\n                require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                \\n                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );\\n                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                $conf_delivery = $config[\'delivery\'];\\n                \\n            }\\n            \\n            $_SESSION[\'shk_curr_rate\'] = null;\\n            unset($_SESSION[\'shk_curr_rate\']);\\n            \\n            \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n            if( !empty( $conf_delivery ) ){\\n                \\n                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';\\n                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;\\n                $_SESSION[\'shk_delivery\'] = array();\\n                \\n                foreach( $conf_delivery as $opt ){\\n                    \\n                    if( $opt[\'label\'] == $delivery_label ){\\n                        \\n                        $_SESSION[\'shk_delivery\'] = array(\\n                            \'label\' => $opt[\'label\'],\\n                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,\\n                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),\\n                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),\\n                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )\\n                        );\\n                        \\n                        break;\\n                    }\\n                    \\n                }\\n                \\n                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );\\n                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];\\n                }\\n                \\n            }\\n            \\n            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();\\n            \\n            if( !empty( $scriptProperties[\'currency_rate\'] ) ){\\n                \\n                \\/\\/\\u0418\\u0437\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u0446\\u0435\\u043d\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432 \\u0432 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0435\\n                if( !empty( $purchases ) ){\\n                    \\n                    foreach( $purchases as $key => &$purchase ){\\n                        \\n                        if( isset( $purchase[\'old_price\'] ) ){\\n                            $base_price = $purchase[\'old_price\'];\\n                        }\\n                        else if( !isset( $purchase[\'old_price\'] ) ) {\\n                            $purchase[\'old_price\'] = $purchase[\'price\'];\\n                            $base_price = $purchase[\'price\'];\\n                        }\\n                        \\n                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );\\n                        \\n                        \\/\\/\\u0414\\u043e\\u043f. \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n                        if( !empty( $purchase[\'options\'] ) ){\\n                            foreach( $purchase[\'options\'] as &$addit_param ){\\n                                \\n                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];\\n                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );\\n                                \\n                            }\\n                        }\\n                        \\n                    }\\n                    \\n                    $_SESSION[\'shk_order\'] = $purchases;\\n                    \\n                }else{\\n                    \\n                    \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0435\\u0442 \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432, \\u043f\\u0440\\u043e\\u0441\\u0442\\u043e \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\n                    shk_currency_calc( $scriptProperties, 0, $currency_id );\\n                    \\n                }\\n                \\n                $shk_currency = $currency_id;\\n                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, \\"\\/\\" );\\n                \\n                \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u0435 \\u0432\\u0430\\u043b\\u044e\\u0442\\u044b\\n                $currency_name = \'\';\\n                foreach( $scriptProperties[\'currency_rate\'] as $rt ){\\n                    if( $rt[\'id\'] == $currency_id ){\\n                        $currency_name = $rt[\'label\'];\\n                        break;\\n                    }\\n                }\\n                $_SESSION[\'shk_currency_name\'] = $currency_name;\\n                \\n            }\\n            \\n            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');\\n            if( $modx->config[\'friendly_urls\'] ){\\n                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );\\n            }\\n            \\n            $modx->sendRedirect( $back_url, 0 );\\n            \\n        }\\n        \\n        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';\\n        if( !$currency_name ){\\n            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');\\n        }\\n        $modx->setPlaceholder( \'shk_currency\', $currency_name );\\n        \\n    break;\\n    case \'OnSHKgetProductAdditParamPrice\':\\n    case \'OnSHKgetDeliveryPrice\':\\n    case \'OnSHKgetProductPrice\':\\n        \\n        $output = $modx->getOption( \'price\', $scriptProperties, 0 );\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        $output = shk_currency_calc( $scriptProperties, $output, $currency_id );\\n        \\n        $modx->event->_output = \'\';\\n        $modx->event->output( $output );\\n        \\n    break;\\n    \\n}\\n\\nreturn \'\';","locked":0,"properties":null,"disabled":1,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n plugin shk_multicurrency\\n System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice\\n\\n<div>\\n    \\u0412\\u0430\\u043b\\u044e\\u0442\\u0430:\\n    <select id=\\"site_currency\\" name=\\"curency\\">\\n        <option value=\\"1\\">\\u0440\\u0443\\u0431.<\\/option>\\n        <option value=\\"2\\">\\u0433\\u0440\\u043d.<\\/option>\\n        <option value=\\"3\\">USD<\\/option>\\n        <option value=\\"4\\">euro<\\/option>\\n    <\\/select>\\n<\\/div>\\n\\n*\\/\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\nswitch($modx->event->name){\\n    \\n    case \'OnLoadWebDocument\':\\n        \\n        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';\\n        \\n        if(empty($scriptProperties[\'noScript\'])){\\n            \\n            $script_str = \'\\n            <script type=\\"text\\/javascript\\">\\n                var shk_cindex = document.cookie.indexOf(\\"shk_currency=\\") > -1 ? document.cookie.indexOf(\\"shk_currency=\\") + new String(\\"shk_currency=\\").length : -1;\\n                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;\\n                jQuery(\\"#site_currency\\")\\n                .val(shk_currency)\\n                .bind(\\"change\\",function(){\\n                    var loc_href = window.location.pathname+document.location.search;\\n                    window.location.href = loc_href+(loc_href.indexOf(\\"?\\") > -1 ? \\"&\\" : \\"?\\") + \\"scurr=\\" + this.value;\\n                });\\n            <\\/script>\\n            \';\\n            $modx->regClientScript( $script_str, true );\\n        }\\n        \\n        if( isset( $_GET[\'scurr\'] ) ){\\n            \\n            if( $currency_id != $shk_currency ){\\n                \\n                require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                \\n                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );\\n                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                $conf_delivery = $config[\'delivery\'];\\n                \\n            }\\n            \\n            $_SESSION[\'shk_curr_rate\'] = null;\\n            unset($_SESSION[\'shk_curr_rate\']);\\n            \\n            \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n            if( !empty( $conf_delivery ) ){\\n                \\n                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';\\n                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;\\n                $_SESSION[\'shk_delivery\'] = array();\\n                \\n                foreach( $conf_delivery as $opt ){\\n                    \\n                    if( $opt[\'label\'] == $delivery_label ){\\n                        \\n                        $_SESSION[\'shk_delivery\'] = array(\\n                            \'label\' => $opt[\'label\'],\\n                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,\\n                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),\\n                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),\\n                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )\\n                        );\\n                        \\n                        break;\\n                    }\\n                    \\n                }\\n                \\n                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );\\n                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];\\n                }\\n                \\n            }\\n            \\n            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();\\n            \\n            if( !empty( $scriptProperties[\'currency_rate\'] ) ){\\n                \\n                \\/\\/\\u0418\\u0437\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u0446\\u0435\\u043d\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432 \\u0432 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0435\\n                if( !empty( $purchases ) ){\\n                    \\n                    foreach( $purchases as $key => &$purchase ){\\n                        \\n                        if( isset( $purchase[\'old_price\'] ) ){\\n                            $base_price = $purchase[\'old_price\'];\\n                        }\\n                        else if( !isset( $purchase[\'old_price\'] ) ) {\\n                            $purchase[\'old_price\'] = $purchase[\'price\'];\\n                            $base_price = $purchase[\'price\'];\\n                        }\\n                        \\n                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );\\n                        \\n                        \\/\\/\\u0414\\u043e\\u043f. \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n                        if( !empty( $purchase[\'options\'] ) ){\\n                            foreach( $purchase[\'options\'] as &$addit_param ){\\n                                \\n                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];\\n                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );\\n                                \\n                            }\\n                        }\\n                        \\n                    }\\n                    \\n                    $_SESSION[\'shk_order\'] = $purchases;\\n                    \\n                }else{\\n                    \\n                    \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0435\\u0442 \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432, \\u043f\\u0440\\u043e\\u0441\\u0442\\u043e \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\n                    shk_currency_calc( $scriptProperties, 0, $currency_id );\\n                    \\n                }\\n                \\n                $shk_currency = $currency_id;\\n                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, \\"\\/\\" );\\n                \\n                \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u0435 \\u0432\\u0430\\u043b\\u044e\\u0442\\u044b\\n                $currency_name = \'\';\\n                foreach( $scriptProperties[\'currency_rate\'] as $rt ){\\n                    if( $rt[\'id\'] == $currency_id ){\\n                        $currency_name = $rt[\'label\'];\\n                        break;\\n                    }\\n                }\\n                $_SESSION[\'shk_currency_name\'] = $currency_name;\\n                \\n            }\\n            \\n            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');\\n            if( $modx->config[\'friendly_urls\'] ){\\n                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );\\n            }\\n            \\n            $modx->sendRedirect( $back_url, 0 );\\n            \\n        }\\n        \\n        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';\\n        if( !$currency_name ){\\n            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');\\n        }\\n        $modx->setPlaceholder( \'shk_currency\', $currency_name );\\n        \\n    break;\\n    case \'OnSHKgetProductAdditParamPrice\':\\n    case \'OnSHKgetDeliveryPrice\':\\n    case \'OnSHKgetProductPrice\':\\n        \\n        $output = $modx->getOption( \'price\', $scriptProperties, 0 );\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        $output = shk_currency_calc( $scriptProperties, $output, $currency_id );\\n        \\n        $modx->event->_output = \'\';\\n        $modx->event->output( $output );\\n        \\n    break;\\n    \\n}\\n\\nreturn \'\';"}',
        'guid' => 'e55ea9b6703a63b6b6934e9b0531b691',
        'native_key' => 1,
        'signature' => '5fc50401a642bbcbee395a52f3147659',
      ),
    ),
  ),
  'related_object_attributes' => 
  array (
    'Snippets' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Chunks' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'TemplateVars' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Plugins' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
      'related_objects' => true,
      'related_object_attributes' => 
      array (
        'PluginEvents' => 
        array (
          'preserve_keys' => true,
          'update_object' => false,
          'unique_key' => 
          array (
            0 => 'pluginid',
            1 => 'event',
          ),
        ),
      ),
    ),
  ),
  'namespace' => 'shopkeeper3',
  'resolve' => 
  array (
    0 => 
    array (
      'type' => 'file',
      'body' => '{"source":"shopkeeper3-3.0.0-pl3\\/modCategory\\/99a116e40db21580bfc8e625e9dcf7fd\\/0\\/","target":"return MODX_CORE_PATH . \'components\\/\';","name":"shopkeeper3"}',
    ),
    1 => 
    array (
      'type' => 'file',
      'body' => '{"source":"shopkeeper3-3.0.0-pl3\\/modCategory\\/99a116e40db21580bfc8e625e9dcf7fd\\/1\\/","target":"return MODX_ASSETS_PATH . \'components\\/\';","name":"shopkeeper3"}',
    ),
    2 => 
    array (
      'type' => 'php',
      'body' => '{"source":"shopkeeper3-3.0.0-pl3\\/modCategory\\/99a116e40db21580bfc8e625e9dcf7fd.resolve.tables.resolver","type":"php","name":"resolve.tables"}',
    ),
  ),
  'validate' => NULL,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '17691509784e70e58edbb49d15a22b4b',
  'package' => 'modx',
  'class' => 'modCategory',
  'signature' => '99a116e40db21580bfc8e625e9dcf7fd',
  'native_key' => 1,
  'object' => '{"id":1,"parent":0,"category":"Shopkeeper3"}',
);